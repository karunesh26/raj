webpackJsonp([1],{233:function(e,t,i){"use strict";var s=i(2),o=i(44);e.exports={ServerModuleName:"AdminPanelWebclient",HashModuleName:"admin",EntitiesData:[{Type:"User",ScreenHash:"users",LinkTextKey:"ADMINPANELWEBCLIENT/HEADING_USERS_SETTINGS_TABNAME"}],EntitiesPerPage:20,TabsOrder:["licensing","admin-security","admin-db","logs-viewer","system","common","modules","mail","mail-domains","mail-accounts","mail-servers","contacts","calendar","files","mobilesync","outlooksync","helpdesk","openpgp","about"],init:function(e){var t=e.Core;s.isEmpty(t)||(this.EntitiesPerPage=o.pPositiveInt(t.EntitiesPerPage,this.EntitiesPerPage),this.TabsOrder=o.pArray(t.TabsOrder,this.TabsOrder))}}},234:function(e,t,i){"use strict";function s(e){this.sServerModule=e?e:"Core",this.isSaving=n.observable(!1),this.visible=n.observable(!0),this.sSavedState="",this.bShown=!1}var o=i(2),n=i(46),r=i(43),a=i(189),l=i(181),h=i(183),u=i(184),c=i(185);s.prototype.ViewTemplate="",s.prototype.onRoute=function(e){this.bShown=!0,this.revert(),o.isFunction(this.onRouteChild)&&this.onRouteChild(e)},s.prototype.hide=function(e,t){this.getCurrentState()!==this.sSavedState?u.showPopup(c,[r.i18n("COREWEBCLIENT/CONFIRM_DISCARD_CHANGES"),o.bind(function(i){i?(this.bShown=!1,e(),this.revert()):o.isFunction(t)&&t()},this)]):(this.bShown=!1,e())},s.prototype.getCurrentValues=function(){return[]},s.prototype.getCurrentState=function(){var e=this.getCurrentValues();return e.join(":")},s.prototype.updateSavedState=function(){this.sSavedState=this.getCurrentState()},s.prototype.revertGlobalValues=function(){},s.prototype.revert=function(){this.revertGlobalValues(),this.updateSavedState()},s.prototype.getParametersForSave=function(){return{}},s.prototype.save=function(){o.isFunction(this.validateBeforeSave)&&!this.validateBeforeSave()||(this.isSaving(!0),a.send(this.sServerModule,"UpdateSettings",this.getParametersForSave(),this.onResponse,this))},s.prototype.applySavedValues=function(e){},s.prototype.onResponse=function(e,t){if(this.isSaving(!1),e.Result){var i=t.Parameters;this.updateSavedState(),this.applySavedValues(i),h.showReport(r.i18n("COREWEBCLIENT/REPORT_SETTINGS_UPDATE_SUCCESS"))}else l.showErrorByCode(e,r.i18n("COREWEBCLIENT/ERROR_SAVING_SETTINGS_FAILED"))},s.prototype.setAccessLevel=function(e,t){},e.exports=s},235:function(e,t,i){"use strict";function s(){d.call(this,"AdminPanelWebclient"),this.aScreens=[{sHash:c.buildHashFromArray(p.get("")),sLinkText:l.i18n("ADMINPANELWEBCLIENT/HEADING_SYSTEM_SETTINGS_TABNAME"),sType:"",oView:null}],o.each(m.EntitiesData,o.bind(function(e){var t=new g(e.Type),i=o.bind(function(e,t,i){"create"===i?this.createEntity():e===this.currentEntityType()&&this.changeEntity(e,t,i||"")},this);t.setChangeEntityHandler(i),this.aScreens.push({sHash:c.buildHashFromArray(p.get(e.Type)),sLinkText:l.i18n(e.LinkTextKey),sType:e.Type,oView:t})},this)),this.currentEntityType=r.observable(""),this.currentEntitiesId=r.observable({}),this.currentEntitiesView=r.computed(function(){var e=this.currentEntityType(),t=o.find(this.aScreens,function(t){return t.sType===e});return t?t.oView:null},this),this.currentEntitiesView.subscribe(function(){this.currentEntitiesView()&&this.currentEntitiesView().onShow()},this),this.showModulesTabs=r.computed(function(){return""===this.currentEntityType()||this.currentEntitiesView().hasSelectedEntity()},this),this.tabs=r.observableArray([]),this.currentTab=r.observable(null),this.aStartErrors=[],h.broadcastEvent("AdminPanelWebclient::ConstructView::after",{Name:this.ViewConstructorName,View:this})}var o=i(2),n=i(1),r=i(46),a=i(3),l=i(43),h=i(179),u=i(183),c=i(191),d=i(194),p=i(236),m=i(233),g=i(237);o.extendOwn(s.prototype,d.prototype),s.prototype.ViewTemplate="AdminPanelWebclient_SettingsView",s.prototype.ViewConstructorName="CSettingsView",s.prototype.registerTab=function(e,t,i){if(o.isFunction(e)){var s=this.tabs;return new a(e).then(function(e){s.push({view:e,name:t,title:i})})}return!1},s.prototype.sortRegisterTabs=function(){this.tabs(o.sortBy(this.tabs(),function(e){var t=o.indexOf(m.TabsOrder,e.name);return t!==-1?t:m.TabsOrder.length}))},s.prototype.cancelCreatingEntity=function(){c.setHash(p.get(this.currentEntityType(),{},""))},s.prototype.createEntity=function(){c.setHash(p.get(this.currentEntityType(),{},"create"))},s.prototype.changeEntity=function(e,t,i){var s=o.clone(this.currentEntitiesId()),n=!!o.find(this.tabs(),function(e){return e.name===i}),r=this.currentTab()?this.currentTab().name:"";s[e]=t,c.setHash(p.get(e,s,n?i:r))},s.prototype.onBind=function(){o.each(this.tabs(),o.bind(function(e){if(e.view&&o.isFunction(e.view.getStartError)){var t=e.view.getStartError();o.isFunction(t)&&(t.subscribe(function(){this.showStartError()},this),this.aStartErrors.push(t))}},this)),this.showStartError()},s.prototype.showStartError=function(){var e=[];o.each(this.aStartErrors,function(t){var i=t();""!==i&&e.push(i)}),u.showError(e.join("<br /><br />"),!0)},s.prototype.onRoute=function(e){var t=p.parse(e),i=e.slice(1),s=this.currentEntityType()===t.CurrentType,r=this.currentEntitiesId()[t.CurrentType]===t.Entities[t.CurrentType],a=this.currentTab()&&this.currentTab().name===t.Last,l=this.currentTab(),h=o.bind(function(){this.showNewScreenView(t),this.showNewTabView(t.Last,i)},this),u=o.bind(function(){l&&c.replaceHashDirectly(p.get(this.currentEntityType(),this.currentEntitiesId(),this.currentTab()?this.currentTab().name:""))},this);s&&r&&a?l&&l.view.onRoute(i):l&&n.isFunction(l.view.hide)?l.view.hide(h,u):h()},s.prototype.showNewScreenView=function(e){var t=o.find(this.aScreens,function(t){return t.sType===e.CurrentType});this.currentEntityType(e.CurrentType),this.currentEntitiesId(e.Entities),t&&t.oView&&("create"===e.Last?t.oView.openCreateForm():t.oView.cancelCreatingEntity(),t.oView.changeEntity(e.Entities[e.CurrentType]))},s.prototype.showNewTabView=function(e,t){o.each(this.tabs(),o.bind(function(e){e.view&&o.isFunction(e.view.setAccessLevel)&&e.view.setAccessLevel(this.currentEntityType(),this.currentEntitiesId()[this.currentEntityType()])},this));var i=o.find(this.tabs(),function(t){return t.name===e});i&&i.view&&i.view.visible()||(i=o.find(this.tabs(),function(e){return e.view&&e.view.visible()})),i&&(n.isFunction(i.view.onRoute)&&i.view.onRoute(t),this.currentTab(i))},s.prototype.changeTab=function(e){c.setHash(p.get(this.currentEntityType(),this.currentEntitiesId(),e))},s.prototype.logout=function(){h.logout()},s.prototype.deleteCurrentEntity=function(){this.currentEntitiesView()&&this.currentEntitiesView().deleteCurrentEntity()},s.prototype.setAddHash=function(e){c.setHash(o.union([m.HashModuleName,this.currentTab()?this.currentTab().name:""],e))},e.exports=new s},236:function(e,t,i){"use strict";function s(e){return h===e.substr(0,1)&&/^[1-9][\d]*$/.test(e.substr(h.length))}function o(e){return l===e.substr(0,l.length)}var n=i(2),r=i(44),a=i(233),l="s.",h="p.",u={};u.get=function(e,t,i,s,o){var u=[a.HashModuleName];return t=t||[],n.each(a.EntitiesData,function(i){r.isPositiveNumber(t[i.Type])?u.push(i.ScreenHash.substr(0,1)+t[i.Type]):e===i.Type&&u.push(i.ScreenHash)}),r.isPositiveNumber(s)&&s>1&&u.push(h+s),r.isNonEmptyString(o)&&u.push(l+o),r.isNonEmptyString(i)&&u.push(i),u},u.parse=function(e){var t=0,i={},u="",c=1,d="",p="";return n.each(a.EntitiesData,function(n){e[t]&&n.ScreenHash===e[t]&&(u=n.Type,t++),e[t]&&n.ScreenHash.substr(0,1)===e[t].substr(0,1)&&r.pInt(e[t].substr(1))>0&&(i[n.Type]=r.pInt(e[t].substr(1)),u=n.Type,t++),e.length>t&&(p=r.pString(e[t]),s(p)&&(c=r.pInt(p.substr(h.length)),c<=0&&(c=1),t++)),e.length>t&&(p=r.pString(e[t]),o(p)&&(d=p.substr(l.length),t++))}),{Entities:i,CurrentType:u,Last:r.isNonEmptyString(e[t])?e[t]:"",Page:c,Search:d}},e.exports=u},237:function(e,t,i){"use strict";function s(e){this.sType=e,this.oEntityCreateView=this.getEntityCreateView(),this.entities=n.observableArray([]),this.totalEntitiesCount=n.observable(0),this.current=n.observable(0),this.showCreateForm=n.observable(!1),this.isCreating=n.observable(!1),this.hasSelectedEntity=n.computed(function(){var e=o.map(this.entities(),function(e){return e.Id});return o.indexOf(e,this.current())!==-1},this),this.justCreatedId=n.observable(0),this.fChangeEntityHandler=function(){},n.computed(function(){0===this.justCreatedId()&&!this.showCreateForm()&&!this.hasSelectedEntity()&&this.entities().length>0&&this.fChangeEntityHandler(this.sType,this.entities()[0].Id)},this).extend({throttle:1}),this.checkedEntities=n.computed(function(){return o.filter(this.entities(),function(e){return e.checked()},this)},this),this.hasCheckedEntities=n.computed(function(){return this.checkedEntities().length>0},this),this.deleteCommand=l.createCommand(this,this.deleteCheckedEntities,this.hasCheckedEntities),this.deactivateCommand=l.createCommand(this,function(){},this.hasCheckedEntities),this.selectedCount=n.computed(function(){return this.checkedEntities().length},this),this.searchValue=n.observable(""),this.newSearchValue=n.observable(""),this.isSearchFocused=n.observable(!1),this.loading=n.observable(!1),this.searchText=n.computed(function(){return r.i18n("ADMINPANELWEBCLIENT/INFO_SEARCH_RESULT",{SEARCH:this.searchValue()})},this),this.oPageSwitcher=new c(0,g.EntitiesPerPage),this.oPageSwitcher.currentPage.subscribe(function(){this.loading(!0),this.requestEntities()},this),this.totalEntitiesCount.subscribe(function(){this.oPageSwitcher.setCount(this.totalEntitiesCount())},this),this.aIdListDeleteProcess=[]}var o=i(2),n=i(46),r=i(43),a=i(44),l=i(213),h=i(181),u=i(183),c=i(238),d=i(184),p=i(185),m=i(239),g=i(233);s.prototype.ViewTemplate="AdminPanelWebclient_EntitiesView",s.prototype.CreateFormViewTemplate="AdminPanelWebclient_EntityCreateFormView",s.prototype.getEntityCreateView=function(){switch(this.sType){case"Tenant":return i(240);case"User":return i(241)}},s.prototype.onShow=function(){this.requestEntities()},s.prototype.search=function(){this.loading(!0),this.oPageSwitcher.setPage(1,g.EntitiesPerPage),this.requestEntities()},s.prototype.clearSearch=function(){this.newSearchValue(""),this.loading(!0),this.requestEntities()},s.prototype.requestEntities=function(){var e={Type:this.sType,Offset:(this.oPageSwitcher.currentPage()-1)*g.EntitiesPerPage,Limit:g.EntitiesPerPage,Search:this.newSearchValue()};this.searchValue(this.newSearchValue()),m.send("GetEntityList",e,function(e){this.loading(!1),e.Result&&o.isArray(e.Result.Items)&&(o.each(e.Result.Items,function(e){e.Id=a.pInt(e.Id),e.checked=n.observable(!1),e.trottleChecked=function(e,t){t.stopPropagation(),this.checked(!this.checked())}}),this.entities(e.Result.Items),this.totalEntitiesCount(a.pInt(e.Result.Count)),0===this.entities().length?this.fChangeEntityHandler(this.sType,void 0,"create"):0!==this.justCreatedId()&&this.fChangeEntityHandler(this.sType,this.justCreatedId()),this.aIdListDeleteProcess=[])},this)},s.prototype.setChangeEntityHandler=function(e){this.fChangeEntityHandler=e},s.prototype.changeEntity=function(e){this.current(a.pInt(e)),this.justCreatedId(0)},s.prototype.openCreateForm=function(){this.showCreateForm(!0),this.oEntityCreateView.clearFields()},s.prototype.cancelCreatingEntity=function(){this.showCreateForm(!1)},s.prototype.createEntity=function(){!this.oEntityCreateView||o.isFunction(this.oEntityCreateView.isValidSaveData)&&!this.oEntityCreateView.isValidSaveData()||(this.isCreating(!0),m.send("Tenant"===this.sType?"CreateTenant":"CreateUser",this.oEntityCreateView.getParametersForSave(),function(e){e.Result?(u.showReport(r.i18n("ADMINPANELWEBCLIENT/REPORT_CREATE_ENTITY_"+this.sType.toUpperCase())),this.justCreatedId(a.pInt(e.Result)),this.cancelCreatingEntity()):h.showErrorByCode(e,r.i18n("ADMINPANELWEBCLIENT/ERROR_CREATE_ENTITY_"+this.sType.toUpperCase())),this.requestEntities(),this.isCreating(!1)},this),this.oEntityCreateView.clearFields())},s.prototype.deleteCurrentEntity=function(){this.deleteEntities([this.current()])},s.prototype.deleteCheckedEntities=function(){var e=o.map(this.checkedEntities(),function(e){return e.Id});this.deleteEntities(e)},s.prototype.deleteEntities=function(e){a.isNonEmptyArray(this.aIdListDeleteProcess)?(e=o.difference(e,this.aIdListDeleteProcess),this.aIdListDeleteProcess=o.union(e,this.aIdListDeleteProcess)):this.aIdListDeleteProcess=e,e.length>0&&d.showPopup(p,[r.i18n("ADMINPANELWEBCLIENT/CONFIRM_DELETE_"+this.sType.toUpperCase()+"_PLURAL",{},null,e.length),o.bind(this.confirmedDeleteEntities,this,e),"",r.i18n("COREWEBCLIENT/ACTION_DELETE")])},s.prototype.confirmedDeleteEntities=function(e,t){t?m.send("DeleteEntities",{Type:this.sType,IdList:e},function(t){t.Result?u.showReport(r.i18n("ADMINPANELWEBCLIENT/REPORT_DELETE_ENTITIES_"+this.sType.toUpperCase()+"_PLURAL",{},null,e.length)):u.showError(r.i18n("ADMINPANELWEBCLIENT/ERROR_DELETE_ENTITIES_"+this.sType.toUpperCase()+"_PLURAL",{},null,e.length)),this.requestEntities()},this):this.aIdListDeleteProcess=[]},s.prototype.groupCheck=function(){var e=!this.hasCheckedEntities();o.each(this.entities(),function(t){t.checked(e)})},e.exports=s},238:function(e,t,i){"use strict";function s(e,t){this.bShown=!1,this.currentPage=r.observable(1),this.count=r.observable(e),this.perPage=r.observable(t),this.firstPage=r.observable(1),this.lastPage=r.observable(1),this.pagesCount=r.computed(function(){var e=this.perPage()>0?Math.ceil(this.count()/this.perPage()):0;return e>0?e:1},this),r.computed(function(){var e=20,t=4,i=this.pagesCount(),s=this.currentPage(),o=s,n=s;if(i>1)for(;;){if(e--,1<o&&(o--,t--),0===t)break;if(i>n&&(n++,t--),0===t)break;if(0===e)break}this.firstPage(o),this.lastPage(n)},this),this.visibleFirst=r.computed(function(){return this.firstPage()>1},this),this.visibleLast=r.computed(function(){return this.lastPage()<this.pagesCount()},this),this.clickPage=o.bind(this.clickPage,this),this.pages=r.computed(function(){var e=this.firstPage(),t=[];if(this.firstPage()<this.lastPage())for(;e<=this.lastPage();e++)t.push({number:e,current:e===this.currentPage(),clickFunc:this.clickPage});return t},this),l.isMobile()||this.hotKeysBind()}var o=i(2),n=i(1),r=i(46),a=i(213),l=i(179);s.prototype.ViewTemplate="CoreWebclient_PageSwitcherView",s.prototype.hotKeysBind=function(){n(document).on("keydown",n.proxy(function(e){if(this.bShown&&!a.isTextFieldFocused()){var t=e.keyCode;e.ctrlKey&&t===Enums.Key.Left?this.clickPreviousPage():e.ctrlKey&&t===Enums.Key.Right&&this.clickNextPage()}},this))},s.prototype.hide=function(){this.bShown=!1},s.prototype.show=function(){this.bShown=!0},s.prototype.clear=function(){this.currentPage(1),this.count(0)},s.prototype.setCount=function(e){this.count(e),this.currentPage()>this.pagesCount()&&this.currentPage(this.pagesCount())},s.prototype.setPage=function(e,t){this.perPage(t),e>this.pagesCount()?this.currentPage(this.pagesCount()):this.currentPage(e)},s.prototype.clickPage=function(e){var t=e.number;t<1&&(t=1),t>this.pagesCount()&&(t=this.pagesCount()),this.currentPage(t)},s.prototype.clickFirstPage=function(){this.currentPage(1)},s.prototype.clickPreviousPage=function(){var e=this.currentPage()-1;e<1&&(e=1),this.currentPage(e)},s.prototype.clickNextPage=function(){var e=this.currentPage()+1;e>this.pagesCount()&&(e=this.pagesCount()),this.currentPage(e)},s.prototype.clickLastPage=function(){this.currentPage(this.pagesCount())},e.exports=s},239:function(e,t,i){"use strict";var s=i(189),o=i(233);e.exports={send:function(e,t,i,n){s.send(o.ServerModuleName,e,t,i,n)}}},240:function(e,t,i){"use strict";function s(){this.sHeading=n.i18n("ADMINPANELWEBCLIENT/HEADING_CREATE_TENANT"),this.id=o.observable(0),this.name=o.observable(""),this.description=o.observable("")}var o=i(46),n=i(43);s.prototype.ViewTemplate="AdminPanelWebclient_EditTenantView",s.prototype.getCurrentValues=function(){return[this.id(),this.name(),this.description()]},s.prototype.clearFields=function(){this.id(0),this.name(""),this.description("")},s.prototype.parse=function(e,t){t?(this.id(e),this.name(t.Name),this.description(t.Description)):this.clearFields()},s.prototype.getParametersForSave=function(){return{Id:this.id(),Name:this.name(),Description:this.description()}},e.exports=new s},241:function(e,t,i){"use strict";function s(){this.sHeading=a.i18n("ADMINPANELWEBCLIENT/HEADING_CREATE_USER"),this.id=r.observable(0),this.publicId=r.observable(""),this.aRoles=[{text:a.i18n("ADMINPANELWEBCLIENT/LABEL_ADMINISTRATOR"),value:Enums.UserRole.SuperAdmin},{text:a.i18n("ADMINPANELWEBCLIENT/LABEL_USER"),value:Enums.UserRole.NormalUser},{text:a.i18n("ADMINPANELWEBCLIENT/LABEL_GUEST"),value:Enums.UserRole.Customer}],this.role=r.observable(Enums.UserRole.NormalUser),this.writeSeparateLog=r.observable(!1),h.broadcastEvent("AdminPanelWebclient::ConstructView::after",{Name:this.ViewConstructorName,View:this})}var o=i(2),n=i(1),r=i(46),a=i(43),l=i(183),h=i(179);s.prototype.ViewTemplate="AdminPanelWebclient_EditUserView",s.prototype.ViewConstructorName="CEditUserView",s.prototype.getCurrentValues=function(){return[this.id(),this.publicId(),this.role(),this.writeSeparateLog()]},s.prototype.clearFields=function(){this.id(0),this.publicId(""),this.role(Enums.UserRole.NormalUser),this.writeSeparateLog(!1)},s.prototype.parse=function(e,t){t?(this.id(e),this.publicId(t.PublicId),this.role(t.Role),this.writeSeparateLog(!!t.WriteSeparateLog)):this.clearFields()},s.prototype.isValidSaveData=function(){var e=""!==n.trim(this.publicId());return e||l.showError(a.i18n("ADMINPANELWEBCLIENT/ERROR_USER_NAME_EMPTY")),e},s.prototype.getParametersForSave=function(){return{Id:this.id(),PublicId:n.trim(this.publicId()),Role:this.role(),WriteSeparateLog:this.writeSeparateLog()}},s.prototype.saveEntity=function(e,t){o.each(e,function(e){"CEntitiesView"===e.constructor.name&&o.isFunction(e.createEntity)&&e.createEntity(),"CCommonSettingsPaneView"===e.constructor.name&&o.isFunction(e.save)&&e.save(t)})},e.exports=new s},242:function(e,t,i){"use strict";function s(){c.call(this,h.ServerModuleName),this.sFakePass="xxxxxxxxxx",this.dbLogin=r.observable(h.DbLogin),this.dbPassword=r.observable(this.sFakePass),this.dbName=r.observable(h.DbName),this.dbHost=r.observable(h.DbHost),this.startError=r.observable(""),this.setStartError()}var o=i(2),n=i(1),r=i(46),a=i(43),l=i(183),h=i(45),u=i(239),c=i(234),d=i(184),p=i(185);o.extendOwn(s.prototype,c.prototype),s.prototype.ViewTemplate="AdminPanelWebclient_DbAdminSettingsView",s.prototype.setStartError=function(){this.startError(""===h.DbLogin||""===h.DbName||""===h.DbHost?a.i18n("ADMINPANELWEBCLIENT/ERROR_DB_ACCESS"):"")},s.prototype.getStartError=function(){return this.startError},s.prototype.getCurrentValues=function(){return[this.dbLogin(),this.dbPassword(),this.dbName(),this.dbHost()]},s.prototype.revertGlobalValues=function(){this.dbLogin(h.DbLogin),this.dbPassword(this.sFakePass),this.dbName(h.DbName),this.dbHost(h.DbHost)},s.prototype.getParametersForSave=function(){return this.dbPassword()===this.sFakePass?{DbLogin:n.trim(this.dbLogin()),DbName:n.trim(this.dbName()),DbHost:n.trim(this.dbHost())}:{DbLogin:n.trim(this.dbLogin()),DbPassword:n.trim(this.dbPassword()),DbName:n.trim(this.dbName()),DbHost:n.trim(this.dbHost())}},s.prototype.applySavedValues=function(e){h.updateDb(e.DbLogin,e.DbName,e.DbHost),this.setStartError()},s.prototype.setAccessLevel=function(e,t){this.visible(""===e)},s.prototype.testConnection=function(){u.send("TestDbConnection",this.getParametersForSave(),function(e){e.Result?l.showReport(a.i18n("ADMINPANELWEBCLIENT/REPORT_DB_CONNECT_SUCCESSFUL")):l.showError(a.i18n("ADMINPANELWEBCLIENT/ERROR_DB_CONNECT_FAILED"))},this)},s.prototype.createTables=function(){var e=function(){u.send("CreateTables",null,function(e){e.Result?l.showReport(a.i18n("ADMINPANELWEBCLIENT/REPORT_CREATE_TABLES_SUCCESSFUL")):l.showError(a.i18n("ADMINPANELWEBCLIENT/ERROR_CREATE_TABLES_FAILED"))})};this.sSavedState!==this.getCurrentState()?d.showPopup(p,[a.i18n("ADMINPANELWEBCLIENT/CONFIRM_SAVE_CHANGES_BEFORE_CREATE_TABLES"),o.bind(function(t){if(t){var i=this.isSaving.subscribe(function(t){t||(e(),i.dispose())},this);this.save()}},this)]):e()},e.exports=new s},243:function(e,t,i){"use strict";function s(){c.call(this,u.ServerModuleName),this.aLanguages=u.LanguageList,this.login=r.observable(u.AdminLogin),this.pass=r.observable(""),this.newPass=r.observable(""),this.confirmPass=r.observable(""),this.selectedLanguage=r.observable(u.AdminLanguage),this.passFocused=r.observable(!1),this.newPassFocused=r.observable(!1),this.startError=r.observable(""),this.setStartError()}var o=i(2),n=i(1),r=i(46),a=i(43),l=i(181),h=i(183),u=i(45),c=i(234);o.extendOwn(s.prototype,c.prototype),s.prototype.ViewTemplate="AdminPanelWebclient_SecurityAdminSettingsView",s.prototype.setStartError=function(){var e=[];u.AdminHasPassword||e.push(a.i18n("ADMINPANELWEBCLIENT/ERROR_ADMIN_EMPTY_PASSWORD")),u.SaltNotEmpty||e.push(a.i18n("ADMINPANELWEBCLIENT/ERROR_SALT_EMPTY")),this.startError(e.join("<br /><br />"))},s.prototype.getStartError=function(){return this.startError},s.prototype.getCurrentValues=function(){return[this.login(),this.pass(),this.newPass(),this.confirmPass(),this.selectedLanguage()]},s.prototype.revertGlobalValues=function(){this.login(u.AdminLogin),this.pass(""),this.newPass(""),this.confirmPass(""),this.selectedLanguage(u.AdminLanguage)},s.prototype.getParametersForSave=function(){var e={AdminLogin:n.trim(this.login()),Password:n.trim(this.pass()),NewPassword:n.trim(this.newPass())};return this.selectedLanguage()!==u.AdminLanguage&&(e.AdminLanguage=this.selectedLanguage()),e},s.prototype.applySavedValues=function(e){this.selectedLanguage()!==u.AdminLanguage&&window.location.reload(),u.updateSecurity(e.AdminLogin,u.AdminHasPassword||""!==e.NewPassword),this.setStartError()},s.prototype.setAccessLevel=function(e,t){this.visible(""===e)},s.prototype.validateBeforeSave=function(){var e=n.trim(this.pass()),t=n.trim(this.newPass()),i=n.trim(this.confirmPass());return u.AdminHasPassword&&""===e&&""!==t?(h.showError(a.i18n("ADMINPANELWEBCLIENT/ERROR_CURRENT_PASSWORD_EMPTY")),this.passFocused(!0),!1):""!==e&&""===t?(h.showError(a.i18n("ADMINPANELWEBCLIENT/ERROR_NEW_PASSWORD_EMPTY")),this.newPassFocused(!0),!1):""===e||t===i||(h.showError(a.i18n("COREWEBCLIENT/ERROR_PASSWORDS_DO_NOT_MATCH")),this.newPassFocused(!0),!1)},s.prototype.onResponse=function(e,t){if(this.isSaving(!1),e.Result){var i=t.Parameters;this.pass(""),this.newPass(""),this.confirmPass(""),this.updateSavedState(),this.applySavedValues(i),h.showReport(a.i18n("COREWEBCLIENT/REPORT_SETTINGS_UPDATE_SUCCESS"))}else l.showErrorByCode(e,a.i18n("COREWEBCLIENT/ERROR_SAVING_SETTINGS_FAILED"))},e.exports=new s},244:function(e,t,i){"use strict";function s(){c.call(this),this.type=n.observable("User"),this.id=n.observable(0),this.entityCreateView=n.computed(function(){switch(this.type()){case"Tenant":return i(240);case"User":return i(241)}},this),this.entityCreateView.subscribe(function(){this.updateSavedState()},this),this.updateSavedState()}var o=i(2),n=i(46),r=i(44),a=i(43),l=i(179),h=i(183),u=i(239),c=i(234);o.extendOwn(s.prototype,c.prototype),s.prototype.ViewTemplate="AdminPanelWebclient_CommonSettingsPaneView",s.prototype.getCurrentValues=function(){return this.entityCreateView()?this.entityCreateView().getCurrentValues():[]},s.prototype.revertGlobalValues=function(){this.entityCreateView()&&this.entityCreateView().clearFields(),this.updateSavedState()},s.prototype.save=function(e){!this.entityCreateView()||o.isFunction(this.entityCreateView().isValidSaveData)&&!this.entityCreateView().isValidSaveData()||u.send("UpdateEntity",{Type:this.type(),Data:this.entityCreateView()?this.entityCreateView().getParametersForSave():{}},function(t){t.Result?h.showReport(a.i18n("ADMINPANELWEBCLIENT/REPORT_UPDATE_ENTITY_"+this.type().toUpperCase())):h.showError(a.i18n("ADMINPANELWEBCLIENT/ERROR_UPDATE_ENTITY_"+this.type().toUpperCase())),e&&o.isFunction(e.currentEntitiesView)&&o.isFunction(e.currentEntitiesView().requestEntities)&&e.currentEntitiesView().requestEntities(),this.updateSavedState()},this)},s.prototype.setAccessLevel=function(e,t){this.visible(""!==e),this.type(e),this.id(r.pInt(t)),r.isPositiveNumber(this.id())?u.send("GetEntity",{Type:this.type(),Id:this.id()},function(e,t){this.id()===t.Parameters.Id&&(this.entityCreateView()&&this.entityCreateView().parse(this.id(),e.Result),this.updateSavedState())},this):this.updateSavedState()},s.prototype.onRoute=function(){l.broadcastEvent("CCommonSettingsPaneView::onRoute::after",{View:this.entityCreateView(),Id:this.id()})},e.exports=new s},245:function(e,t,i){"use strict";function s(){a.call(this,r.ServerModuleName),this.sVersion=n.pString(r.Version),this.sProductName=n.pString(r.ProductName)}var o=i(2),n=i(44),r=i(45),a=i(234);o.extendOwn(s.prototype,a.prototype),s.prototype.ViewTemplate="AdminPanelWebclient_AboutAdminSettingsView",s.prototype.setAccessLevel=function(e,t){this.visible(""===e)},e.exports=new s},258:function(e,t,i){"use strict";function s(){this.iTimeStampInUTC=0,this.oMoment=null}var o=i(51),n=i(43),r=i(213),a=i(45);s.prototype.parse=function(e){this.iTimeStampInUTC=e,this.oMoment=o.unix(this.iTimeStampInUTC)},s.prototype.setDate=function(e,t,i){this.oMoment=o([e,t,i])},s.prototype.getTimeFormat=function(){return a.timeFormat()===window.Enums.TimeFormat.F24?"HH:mm":"hh:mm A"},s.prototype.getFullDate=function(){return this.getDate()+" "+this.getTime()},s.prototype.getMidDate=function(){return this.getShortDate(!0)},s.prototype.getShortDate=function(e){var t="",i=null;return this.oMoment&&(i=o(),i.format("L")===this.oMoment.format("L")?t=this.oMoment.format(this.getTimeFormat()):(t=i.clone().subtract(1,"days").format("L")===this.oMoment.format("L")?n.i18n("COREWEBCLIENT/LABEL_YESTERDAY"):a.UserSelectsDateFormat?this.oMoment.format(r.getDateFormatForMoment(a.dateFormat())):i.year()===this.oMoment.year()?this.oMoment.format("MMM D"):this.oMoment.format("MMM D, YYYY"),e&&(t+=", "+this.oMoment.format(this.getTimeFormat())))),t},s.prototype.getDate=function(){var e="ddd, MMM D, YYYY";return a.UserSelectsDateFormat&&(e="ddd, "+r.getDateFormatForMoment(a.dateFormat())),this.oMoment?this.oMoment.format(e):""},s.prototype.getTime=function(){return this.oMoment?this.oMoment.format(this.getTimeFormat()):""},s.prototype.getTimeStampInUTC=function(){return this.iTimeStampInUTC},e.exports=s},269:function(e,t,i){var s,o=o||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,i=function(){return e.URL||e.webkitURL||e},s=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in s,n=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},r=/constructor/i.test(e.HTMLElement)||e.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent),l=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},h="application/octet-stream",u=4e4,c=function(e){var t=function(){"string"==typeof e?i().revokeObjectURL(e):e.remove()};setTimeout(t,u)},d=function(e,t,i){t=[].concat(t);for(var s=t.length;s--;){var o=e["on"+t[s]];if("function"==typeof o)try{o.call(e,i||e)}catch(e){l(e)}}},p=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},m=function(t,l,u){u||(t=p(t));var m,g=this,f=t.type,b=f===h,v=function(){d(g,"writestart progress write writeend".split(" "))},y=function(){if((a||b&&r)&&e.FileReader){var s=new FileReader;return s.onloadend=function(){var t=a?s.result:s.result.replace(/^data:[^;]*;/,"data:attachment/file;"),i=e.open(t,"_blank");i||(e.location.href=t),t=void 0,g.readyState=g.DONE,v()},s.readAsDataURL(t),void(g.readyState=g.INIT)}if(m||(m=i().createObjectURL(t)),b)e.location.href=m;else{var o=e.open(m,"_blank");o||(e.location.href=m)}g.readyState=g.DONE,v(),c(m)};return g.readyState=g.INIT,o?(m=i().createObjectURL(t),void setTimeout(function(){s.href=m,s.download=l,n(s),v(),c(m),g.readyState=g.DONE})):void y()},g=m.prototype,f=function(e,t,i){return new m(e,t||e.name||"download",i)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,i){return t=t||e.name||"download",i||(e=p(e)),navigator.msSaveOrOpenBlob(e,t)}:(g.abort=function(){},g.readyState=g.INIT=0,g.WRITING=1,g.DONE=2,g.error=g.onwritestart=g.onprogress=g.onwrite=g.onabort=g.onerror=g.onwriteend=null,f)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);void 0!==e&&e.exports?e.exports.saveAs=o:null!==i(48)&&null!==i(270)&&(s=function(){return o}.call(t,i,t,e),!(void 0!==s&&(e.exports=s)))},270:function(e,t){(function(t){e.exports=t}).call(t,{})},271:function(e,t,i){"use strict";function s(e){return void 0===e}function o(e,t){var i=!1;return e&&t&&(i=e===t||(e.contains?e.contains(t):!!t.compareDocumentPosition&&!!(8&t.compareDocumentPosition(e)))),i}function n(e){0<e&&clearTimeout(e),e=0}function r(e){return e=e&&(e.originalEvent?e.originalEvent:e)||window.event,e.dataTransfer?e:null}function a(e,t,i){return e&&t&&!s(e[t])?e[t]:i}function l(e,t,i){e[t]=i}function h(e,t){return function(){return e.apply(s(t)?null:t,Array.prototype.slice.call(arguments))}}function u(e){var t="",i="0123456789abcdefghijklmnopqrstuvwxyz";for(e=s(e)?32:L.pInt(e);t.length<e;)t+=i.substr(Math.round(Math.random()*i.length),1);return t}function c(){return"jua-uid-"+u(16)+"-"+(new Date).getTime()}function d(e,t){var i=s(e.fileName)?s(e.name)?null:e.name:e.fileName,o=s(e.fileSize)?s(e.size)?null:e.size:e.fileSize,n=s(e.type)?null:e.type;return{FileName:i,Size:o,Type:n,Folder:s(t)?"":t,File:e}}function p(e,t,i,o,n,r){var a=0,l=0,h=0,u=null,c=null,p=!1,m=!1,g=function(e,t,i,l){if(e&&!s(e.name))if(t=t||"",e.isFile)e.file(function(e){!p||0<=--n?i(d(e,t)):p&&!m&&0>n&&r&&(m=!0,r(a))});else if(o&&e.isDirectory&&e.createReader){var h=e.createReader(),u=0,c=0;h&&h.readEntries&&h.readEntries(function(s){if(s&&L.isNonEmptyArray(s))for(u=0,c=s.length;u<c;u++)g(s[u],t+e.name+"/",i,l)})}};if(o=!!s(o)||!!o,i=!s(i)&&!!i,n=s(n)?M:L.pInt(n),a=n,p=0<n,e=e&&0<e.length?e:null)for(h=0,l=e.length;h<l;h++)u=e[h],u&&(i?"file"===u.kind&&u.webkitGetAsEntry&&(c=u.webkitGetAsEntry(),c&&g(c,"",t,r)):!p||0<=--n?t(d(u)):p&&!m&&0>n&&r&&(m=!0,r(a)))}function m(e,t,i,s){var o=e&&e.files&&0<e.files.length?e.files:null;o?p(o,t,!1,!1,i,s):t({FileName:e.value.split("\\").pop().split("/").pop(),Size:null,Type:null,Folder:"",File:null})}function g(e){var t=!1;if(e&&e.dataTransfer&&e.dataTransfer.types&&e.dataTransfer.types.length)for(var i=0,s=e.dataTransfer.types.length;i<s;i++)if("files"===e.dataTransfer.types[i].toLowerCase()){t=!0;break}return t}function f(e,t,i,s,o){var n=null,l=null;e=r(e),e&&(n=(e.dataTransfer?a(e.dataTransfer,"items",null):null)||a(e,"items",null),n&&0<n.length&&n[0]&&n[0].webkitGetAsEntry?p(n,t,!0,o,i,s):g(e)&&(l=a(e,"files",null)||(e.dataTransfer?a(e.dataTransfer,"files",null):null),l&&0<l.length&&p(l,t,!1,!1,i,s)))}function b(){return F('<label style="position: absolute; background-color:#fff; right: 0px; top: 0px; left: 0px; bottom: 0px; margin: 0px; padding: 0px; cursor: pointer;"></label>').css({opacity:0})}function v(e,t){return""!==t&&(t=' accept="'+t+'"'),F('<input type="file" tabindex="-1" hidefocus="hidefocus" style="position: absolute; '+e+': -9999px;"'+t+" />")}function y(e,t,i,o){e=s(e)?"":""+e,i=s(i)?"left":""+i,o=s(o)?"":""+o;var n=v(i,o);return 0<e.length&&n.attr("name",e),!s(t)&&!t||n.prop("multiple",!0),n}function E(e,t){return L.pString(I.isFunction(e)?e.apply(null,I.isArray(t)?t:[]):e)}function S(e,t){this.oXhrs={},this.oUids={},this.oJua=e,this.oOptions=t}function A(e,t){this.oUids={},this.oForms={},this.oJua=e,this.oOptions=t}function C(e){e=s(e)?{}:e;var t=this;t.bEnableDnD=!0,t.bEnableButton=!0,t.oEvents={onDialog:null,onSelect:null,onStart:null,onComplete:null,onCompleteAll:null,onProgress:null,onDragEnter:null,onDragLeave:null,onDrop:null,onBodyDragEnter:null,onBodyDragLeave:null,onLimitReached:null},t.oOptions=I.extend({action:"",name:"",hidden:{},queueSize:10,clickElement:!1,dragAndDropElement:!1,
dragAndDropBodyElement:!1,disableAjaxUpload:!1,disableFolderDragAndDrop:!0,disableDragAndDrop:!1,disableMultiple:!1,disableDocumentDropPrevent:!1,disableAutoUploadOnDrop:!1,multipleSizeLimit:50,hiddenElementsPosition:"left"},e),t.oQueue=T(L.pInt(a(t.oOptions,"queueSize",10))),t.runEvent("onCompleteAll")&&t.oQueue.await(function(){t.runEvent("onCompleteAll")}),t.oDriver=t.isAjaxUploaderSupported()&&!a(t.oOptions,"disableAjaxUpload",!1)?new S(t,t.oOptions):new A(t,t.oOptions),t.oClickElement=a(t.oOptions,"clickElement",null),t.oClickElement&&(F(t.oClickElement).css({position:"relative",overflow:"hidden"}),"inline"===F(this.oClickElement).css("display")&&F(this.oClickElement).css("display","inline-block"),this.oDriver.generateNewInput(this.oClickElement)),this.oDriver.isDragAndDropSupported()&&a(this.oOptions,"dragAndDropElement",!1)&&!a(this.oOptions,"disableAjaxUpload",!1)?!function(e){var t=F(document),i=F(a(e.oOptions,"dragAndDropBodyElement",!1)||t),s=a(e.oOptions,"dragAndDropElement",!1),l=function(t){if(e.bEnableDnD&&t&&(t=r(t),t&&t.dataTransfer&&g(t)))try{var s=t.dataTransfer.effectAllowed;n(e.iDocTimer),t.dataTransfer.dropEffect="move"===s||"linkMove"===s?"move":"copy",t.stopPropagation(),t.preventDefault(),i.trigger("dragover",t)}catch(e){}},h=function(t){e.bEnableDnD&&t&&(t=r(t),t&&g(t)&&(t.preventDefault(),f(t,function(i){i&&(a(e.oOptions,"disableAutoUploadOnDrop",!1)?e.runEvent("onDrop",[i,t,function(){e.addNewFile(i),n(e.iDocTimer)}]):(e.runEvent("onDrop",[i,t]),e.addNewFile(i),n(e.iDocTimer)))},a(e.oOptions,"multipleSizeLimit",M),e.getEvent("onLimitReached"),!a(e.oOptions,"disableFolderDragAndDrop",!0)))),e.runEvent("onDragLeave",[t])},u=function(t){e.bEnableDnD&&t&&(t=r(t),t&&g(t)&&(n(e.iDocTimer),t.preventDefault(),e.runEvent("onDragEnter",[s,t])))},c=function(t){if(e.bEnableDnD&&t){if(t=r(t)){var i=document.elementFromPoint?document.elementFromPoint(t.clientX,t.clientY):null;if(i&&o(this,i))return;n(e.iDocTimer),e.runEvent("onDragLeave",[s,t])}}else;};s&&(a(e.oOptions,"disableDocumentDropPrevent",!1)||t.on("dragover",function(t){if(e.bEnableDnD&&t&&(t=r(t),t&&t.dataTransfer&&g(t)))try{t.dataTransfer.dropEffect="none",t.preventDefault()}catch(e){}}),i&&i[0]&&i.on("dragover",function(t){e.bEnableDnD&&t&&n(e.iDocTimer)}).on("dragenter",function(t){e.bEnableDnD&&t&&(t=r(t),t&&g(t)&&(n(e.iDocTimer),t.preventDefault(),e.runEvent("onBodyDragEnter",[t])))}).on("dragleave",function(t){e.bEnableDnD&&t&&(t=r(t),t&&(n(e.iDocTimer),e.iDocTimer=setTimeout(function(){e.runEvent("onBodyDragLeave",[t])},200)))}).on("drop",function(t){if(e.bEnableDnD&&t&&(t=r(t))){var i=g(t);return i&&t.preventDefault(),e.runEvent("onBodyDragLeave",[t]),!i}return!1}),F(s).bind("dragenter",u).bind("dragover",l).bind("dragleave",c).bind("drop",h))}(t):t.bEnableDnD=!1,l(t,"on",t.on),l(t,"cancel",t.cancel),l(t,"isDragAndDropSupported",t.isDragAndDropSupported),l(t,"isAjaxUploaderSupported",t.isAjaxUploaderSupported),l(t,"setDragAndDropEnabledStatus",t.setDragAndDropEnabledStatus)}var F=i(1),I=i(2),T=i(272),L=i(44),w=i(179),M=20;S.prototype.oXhrs={},S.prototype.oUids={},S.prototype.oJua=null,S.prototype.oOptions={},S.prototype.isDragAndDropSupported=function(){return!0},S.prototype.regTaskUid=function(e){this.oUids[e]=!0},S.prototype.uploadTask=function(e,t,i,o,n,r){if(!1===this.oUids[e]||!t||!t.File)return i(null,e),!1;try{var l=this,h=new XMLHttpRequest,u=new FormData,c=a(this.oOptions,"action",""),d=a(this.oOptions,"hidden",{}),p=this.oJua.getEvent("onStart"),m=this.oJua.getEvent("onComplete"),g=this.oJua.getEvent("onProgress"),f=null,b=d.Parameters;return h.open("POST",c,!0),h.setRequestHeader("Authorization","Bearer "+F.cookie("AuthToken")),g&&h.upload&&(h.upload.onprogress=function(i){i&&i.lengthComputable&&!s(i.loaded)&&!s(i.total)&&(void 0===r?g(e,i.loaded,i.total):g(e,r+i.loaded>t.Size?t.Size:r+i.loaded,t.Size))}),h.onreadystatechange=function(){if(4===h.readyState&&200===h.status){if(m&&!o){var t=!1,r=null;try{r=F.parseJSON(h.responseText),t=!0}catch(e){r=null}m(e,t,r)}s(l.oXhrs[e])||(l.oXhrs[e]=null),n?i(h.responseText,e):i(null,e)}else 4===h.readyState&&(m(e,!1,null),i(null,e))},p&&p(e),u.append("jua-post-type","ajax"),u.append(a(this.oOptions,"name","juaFile"),t.File,t.FileName),f=JSON.parse(E(d.Parameters,[t])),f=I.extend(f,t.Hidden||{}),d.Parameters=JSON.stringify(f),F.each(d,function(e,i){u.append(e,E(i,[t]))}),d.Parameters=b,h.send(u),this.oXhrs[e]=h,!0}catch(e){window.console&&window.console.error(e)}return i(null,e),!1},S.prototype.generateNewInput=function(e){var t=this,i=null,s=null;e&&(s=y("",!a(this.oOptions,"disableMultiple",!1),a(this.oOptions,"hiddenElementsPosition","left"),a(this.oOptions,"accept","")),i=b(),i.append(s),F(e).append(i),s.on("click",function(e){if(!t.oJua.bEnableButton)return void e.preventDefault();var i=t.oJua.getEvent("onDialog");i&&i()}).on("change",function(){m(this,function(s){t.oJua.addNewFile(s),t.generateNewInput(e),setTimeout(function(){i.remove()},10)},a(t.oOptions,"multipleSizeLimit",M),t.oJua.getEvent("onLimitReached"))}))},S.prototype.cancel=function(e){if(this.oUids[e]=!1,this.oXhrs[e]){try{this.oXhrs[e].abort&&this.oXhrs[e].abort()}catch(e){}this.oXhrs[e]=null}},A.prototype.oUids={},A.prototype.oForms={},A.prototype.oJua=null,A.prototype.oOptions={},A.prototype.isDragAndDropSupported=function(){return!1},A.prototype.regTaskUid=function(e){this.oUids[e]=!0},A.prototype.uploadTask=function(e,t,i,s,o,n){if(!1===this.oUids[e])return i(null,e),!1;var r=this.oForms[e],l=a(this.oOptions,"hidden",{}),h=this.oJua.getEvent("onStart"),u=this.oJua.getEvent("onComplete");return r?(r.append(F('<input type="hidden" />').attr("name","jua-post-type").val("iframe")),F.each(l,function(e,i){r.append(F('<input type="hidden" />').attr("name",e).val(E(i,[t])))}),r.trigger("submit"),h&&h(e),r.find("iframe").on("load",function(t){var s=!1,o=null,n={};if(u){try{o=this.contentDocument?this.contentDocument:this.contentWindow.document,n=F.parseJSON(o.body.innerHTML),s=!0}catch(e){n={}}u(e,s,n)}i(null,e),window.setTimeout(function(){r.remove()},100)})):i(null,e),!0},A.prototype.generateNewInput=function(e){var t=this,i="",s=null,o=null,n=a(this.oOptions,"action",""),r=null,l=a(this.oOptions,"hiddenElementsPosition","left");e&&(i=c(),s=y(a(this.oOptions,"name","juaFile"),!a(this.oOptions,"disableMultiple",!1),a(this.oOptions,"hiddenElementsPosition","left"),a(this.oOptions,"accept","")),r=F('<form action="'+n+'" target="iframe-'+i+'"  method="POST" enctype="multipart/form-data" style="display: block; cursor: pointer;"></form>'),o=F('<iframe name="iframe-'+i+'" tabindex="-1" src="javascript:void(0);"  style="position: absolute; top: -1000px; '+l+': -1000px; cursor: pointer;" />').css({opacity:0}),r.append(b().append(s)).append(o),F(e).append(r),this.oForms[i]=r,s.on("click",function(e){if(!t.oJua.bEnableButton)return void e.preventDefault();var i=t.oJua.getEvent("onDialog");i&&i()}).on("change",function(){m(this,function(s){if(s){var o=a(t.oOptions,"hiddenElementsPosition","left");r.css({position:"absolute",top:-1e3}),r.css(o,-1e3),t.oJua.addFile(i,s),t.generateNewInput(e)}},a(t.oOptions,"multipleSizeLimit",M),t.oJua.getEvent("onLimitReached"))}))},A.prototype.cancel=function(e){this.oUids[e]=!1,this.oForms[e]&&(this.oForms[e].remove(),this.oForms[e]=!1)},C.prototype.bEnableDnD=!0,C.prototype.iDocTimer=0,C.prototype.oOptions={},C.prototype.oEvents={},C.prototype.oQueue=null,C.prototype.oDriver=null,C.prototype.on=function(e,t){return this.oEvents[e]=t,this},C.prototype.runEvent=function(e,t){this.oEvents[e]&&this.oEvents[e].apply(null,t||[])},C.prototype.getEvent=function(e){return this.oEvents[e]||null},C.prototype.cancel=function(e){this.oDriver.cancel(e)},C.prototype.isAjaxUploaderSupported=function(){return function(){var e=document.createElement("input");return e.type="file",!!("XMLHttpRequest"in window&&"multiple"in e&&"FormData"in window&&(new XMLHttpRequest).upload)}()},C.prototype.setDragAndDropEnabledStatus=function(e){this.bEnableDnD=!!e},C.prototype.isDragAndDropSupported=function(){return this.oDriver.isDragAndDropSupported()},C.prototype.addNewFile=function(e){this.addFile(c(),e)},C.prototype.addFile=function(e,t){var i=this.getEvent("onSelect"),s=null,o=!1,n=a(this.oOptions,"hidden",{}),r=this.getEvent("onComplete"),l=I.bind(function(e,t){this.oDriver.regTaskUid(e),this.oQueue.defer(h(this.oDriver.uploadTask,this.oDriver),e,t)},this),u=this.getEvent("onCancel");!t||i&&!1===i(e,t)?this.oDriver.cancel(e):(s=I.bind(function(e,t,i,o,n,a){var l=null;l=function(t,o){var n=null;try{n=F.parseJSON(t)}catch(e){}n&&n.Result&&!n.Result.Error&&!n.ErrorCode?i(e,s):n&&n.Result&&n.Result.Error?(w.broadcastEvent("Jua::FileUploadingError"),r(o,!1,{ErrorCode:n.Result.Error})):n&&n.ErrorCode?(w.broadcastEvent("Jua::FileUploadingError"),r(o,!1,{ErrorCode:n.ErrorCode})):(w.broadcastEvent("Jua::FileUploadingError"),r(o,!1))},this.oDriver.regTaskUid(e),this.oDriver.uploadTask(e,t,l,o<n,!0,a)},this),o=w.broadcastEvent("Jua::FileUpload::before",{sUid:e,oFileInfo:t,fOnChunkReadyCallback:s,sModuleName:n.Module,fRegularUploadFileCallback:l,fCancelFunction:u}),o===!1&&l(e,t))},C.prototype.setOption=function(e,t){this.oOptions[e]=t},e.exports=C},272:function(e,t,i){var s;!function(){function o(e){function t(){for(;a=u<h.length&&e>c;){var t=u++,s=h[t],o=r.call(s,1);o.push(i(t)),++c,s[0].apply(null,o)}}function i(e){return function(i,o){--c,null==p&&(null!=i?(p=i,u=d=NaN,s()):(h[e]=o,--d?a||t():s()))}}function s(){null!=p?m(p):l?m(p,h):m.apply(null,[p].concat(h))}var o,a,l,h=[],u=0,c=0,d=0,p=null,m=n;return e||(e=1/0),o={defer:function(){return p||(h.push(arguments),++d,t()),o},await:function(e){return m=e,l=!1,d||s(),o},awaitAll:function(e){return m=e,l=!0,d||s(),o}}}function n(){}var r=[].slice;o.version="1.0.7",s=function(){return o}.call(t,i,t,e),!(void 0!==s&&(e.exports=s))}()},279:function(e,t,i){"use strict";var s=i(2),o=i(46),n=i(44);e.exports={ServerModuleName:"Dropbox",HashModuleName:"dropbox",Connected:!1,EnableModule:!1,Id:"",Secret:"",Scopes:[],init:function(e){var t=e.Dropbox;s.isEmpty(t)||(this.Connected=n.pBool(t.Connected,this.Connected),this.EnableModule=n.pBool(t.EnableModule,this.EnableModule),this.Id=n.pString(t.Id,this.Id),this.Secret=n.pString(t.Secret,this.Secret),this.Scopes=n.pArray(t.Scopes,this.Scopes))},getScopesCopy:function(){var e=[];return s.each(this.Scopes,function(t){e.push({Description:t.Description,Name:t.Name,Value:o.observable(t.Value)})}),e},updateScopes:function(e,t){var i=[];s.each(t,function(e){i.push({Description:e.Description,Name:e.Name,Value:e.Value()})}),this.Connected=e,this.Scopes=i},updateAdmin:function(e,t,i,s){this.EnableModule=e,this.Id=t,this.Secret=i,this.Scopes=s}}},281:function(e,t,i){"use strict";function s(){h.call(this,u.ServerModuleName),this.enable=n.observable(u.EnableModule),this.id=n.observable(u.Id),this.secret=n.observable(u.Secret),this.scopes=n.observable(u.getScopesCopy())}var o=i(2),n=i(46),r=i(43),a=i(42),l=i(183),h=a.run("AdminPanelWebclient","getAbstractSettingsFormViewClass"),u=i(279);o.extendOwn(s.prototype,h.prototype),s.prototype.ViewTemplate="Dropbox_AdminSettingsView",s.prototype.getCurrentValues=function(){var e=o.map(this.scopes(),function(e){return e.Name+e.Value()});return[this.enable(),this.id(),this.secret(),e]},s.prototype.revertGlobalValues=function(){this.enable(u.EnableModule),this.id(u.Id),this.secret(u.Secret),this.scopes(u.getScopesCopy())},s.prototype.validateBeforeSave=function(){return!this.enable()||""!==this.id()&&""!==this.secret()||(l.showError(r.i18n("COREWEBCLIENT/ERROR_REQUIRED_FIELDS_EMPTY")),!1)},s.prototype.getParametersForSave=function(){return{EnableModule:this.enable(),Id:this.id(),Secret:this.secret(),Scopes:o.map(this.scopes(),function(e){return{Name:e.Name,Description:e.Description,Value:e.Value()}})}},s.prototype.applySavedValues=function(e){u.updateAdmin(e.EnableModule,e.Id,e.Secret,e.Scopes)},s.prototype.setAccessLevel=function(e,t){this.visible(""===e)},e.exports=new s},283:function(e,t,i){"use strict";var s=i(2),o=i(46),n=i(44);e.exports={ServerModuleName:"Facebook",HashModuleName:"facebook",Connected:!1,EnableModule:!1,Id:"",Secret:"",Scopes:[],init:function(e){var t=e.Facebook;s.isEmpty(t)||(this.Connected=n.pBool(t.Connected,this.Connected),this.EnableModule=n.pBool(t.EnableModule,this.EnableModule),this.Id=n.pString(t.Id,this.Id),this.Secret=n.pString(t.Secret,this.Secret),this.Scopes=n.pArray(t.Scopes,this.Scopes))},getScopesCopy:function(){var e=[];return s.each(this.Scopes,function(t){e.push({Description:t.Description,Name:t.Name,Value:o.observable(t.Value)})}),e},updateScopes:function(e,t){var i=[];s.each(t,function(e){i.push({Description:e.Description,Name:e.Name,Value:e.Value()})}),this.Connected=e,this.Scopes=i},updateAdmin:function(e,t,i,s){this.EnableModule=e,this.Id=t,this.Secret=i,this.Scopes=s}}},285:function(e,t,i){"use strict";function s(){h.call(this,u.ServerModuleName),this.enable=n.observable(u.EnableModule),this.id=n.observable(u.Id),this.secret=n.observable(u.Secret),this.scopes=n.observable(u.getScopesCopy())}var o=i(2),n=i(46),r=i(43),a=i(42),l=i(183),h=a.run("AdminPanelWebclient","getAbstractSettingsFormViewClass"),u=i(283);o.extendOwn(s.prototype,h.prototype),s.prototype.ViewTemplate="Facebook_AdminSettingsView",s.prototype.getCurrentValues=function(){var e=o.map(this.scopes(),function(e){return e.Name+e.Value()});return[this.enable(),this.id(),this.secret(),e]},s.prototype.revertGlobalValues=function(){this.enable(u.EnableModule),this.id(u.Id),this.secret(u.Secret),this.scopes(u.getScopesCopy())},s.prototype.validateBeforeSave=function(){return!this.enable()||""!==this.id()&&""!==this.secret()||(l.showError(r.i18n("COREWEBCLIENT/ERROR_REQUIRED_FIELDS_EMPTY")),!1)},s.prototype.getParametersForSave=function(){return{EnableModule:this.enable(),Id:this.id(),Secret:this.secret(),Scopes:o.map(this.scopes(),function(e){return{Name:e.Name,Description:e.Description,Value:e.Value()}})}},s.prototype.applySavedValues=function(e){u.updateAdmin(e.EnableModule,e.Id,e.Secret,e.Scopes)},s.prototype.setAccessLevel=function(e,t){this.visible(""===e)},e.exports=new s},287:function(e,t,i){"use strict";var s=i(2),o=i(46),n=i(44);e.exports={ServerModuleName:"Google",HashModuleName:"google",Connected:!1,EnableModule:!1,Id:"",Secret:"",Key:"",Scopes:[],init:function(e){var t=s.extend({},e[this.ServerModuleName]||{},e.Google||{});s.isEmpty(t)||(this.Connected=n.pBool(t.Connected,this.Connected),this.EnableModule=n.pBool(t.EnableModule,this.EnableModule),this.Id=n.pString(t.Id,this.Id),this.Secret=n.pString(t.Secret,this.Secret),this.Key=n.pString(t.Key,this.Key),this.Scopes=n.pArray(t.Scopes,this.Scopes))},getScopesCopy:function(){var e=[];return s.each(this.Scopes,function(t){e.push({Description:t.Description,Name:t.Name,Value:o.observable(t.Value)})}),e},updateScopes:function(e,t){var i=[];s.each(t,function(e){i.push({Description:e.Description,Name:e.Name,Value:e.Value()})}),this.Connected=e,this.Scopes=i},updateAdmin:function(e,t,i,s,o){this.EnableModule=e,this.Id=t,this.Secret=i,this.Key=s,this.Scopes=o}}},289:function(e,t,i){"use strict";function s(){h.call(this,u.ServerModuleName),this.enable=n.observable(u.EnableModule),this.id=n.observable(u.Id),this.secret=n.observable(u.Secret),this.key=n.observable(u.Key),this.scopes=n.observable(u.getScopesCopy())}var o=i(2),n=i(46),r=i(43),a=i(42),l=i(183),h=a.run("AdminPanelWebclient","getAbstractSettingsFormViewClass"),u=i(287);o.extendOwn(s.prototype,h.prototype),s.prototype.ViewTemplate="Google_AdminSettingsView",s.prototype.getCurrentValues=function(){var e=o.map(this.scopes(),function(e){return e.Name+e.Value()});return[this.enable(),this.id(),this.secret(),this.key(),e]},s.prototype.revertGlobalValues=function(){this.enable(u.EnableModule),this.id(u.Id),this.secret(u.Secret),this.key(u.Key),this.scopes(u.getScopesCopy())},s.prototype.validateBeforeSave=function(){return!this.enable()||""!==this.id()&&""!==this.secret()&&""!==this.key()||(l.showError(r.i18n("COREWEBCLIENT/ERROR_REQUIRED_FIELDS_EMPTY")),!1)},s.prototype.getParametersForSave=function(){return{EnableModule:this.enable(),Id:this.id(),Secret:this.secret(),Key:this.key(),Scopes:o.map(this.scopes(),function(e){return{Name:e.Name,Description:e.Description,Value:e.Value()}})}},s.prototype.applySavedValues=function(e){u.updateAdmin(e.EnableModule,e.Id,e.Secret,e.Key,e.Scopes)},s.prototype.setAccessLevel=function(e,t){this.visible(""===e)},e.exports=new s},291:function(e,t,i){"use strict";var s=i(2),o=i(44);e.exports={ServerModuleName:"LogsViewerWebclient",HashModuleName:"logs-viewer",EnableLogging:!1,EnableEventLogging:!1,LoggingLevel:0,LogSizeBytes:0,EventLogSizeBytes:0,LogFileName:"",EventLogFileName:"",init:function(e){var t=e.Core;s.isEmpty(t)||(this.ELogLevel=o.pObject(t.ELogLevel),this.EnableLogging=o.pBool(t.EnableLogging),this.EnableEventLogging=o.pBool(t.EnableEventLogging),this.LoggingLevel=o.pEnum(t.LoggingLevel,this.ELogLevel,this.LoggingLevel),this.updateLogsData(o.pObject(t.LogFilesData)))},updateLogging:function(e,t,i){this.EnableLogging=!!e,this.EnableEventLogging=!!t,this.LoggingLevel=o.pInt(i)},updateLogsData:function(e){this.LogSizeBytes=o.pInt(e.LogSizeBytes),this.EventLogSizeBytes=o.pInt(e.EventLogSizeBytes),this.LogFileName=o.pString(e.LogFileName),this.EventLogFileName=o.pString(e.EventLogFileName)}}},293:function(e,t,i){"use strict";function s(){m.call(this,"Core"),this.iViewLogSizeBytes=10240,this.aLevelOptions=[{text:l.i18n("LOGSVIEWERWEBCLIENT/LABEL_LOGGING_DEBUG"),value:Enums.LogLevel.Full},{text:l.i18n("LOGSVIEWERWEBCLIENT/LABEL_LOGGING_WARNINGS"),value:Enums.LogLevel.Warning},{text:l.i18n("LOGSVIEWERWEBCLIENT/LABEL_LOGGING_ERRORS"),value:Enums.LogLevel.Error}],this.logSize=r.observable(d.LogSizeBytes),this.downloadLogText=r.computed(function(){return l.i18n("LOGSVIEWERWEBCLIENT/BUTTON_LOGGING_DOWNLOAD",{SIZE:l.getFriendlySize(this.logSize())})},this),this.viewLogText=r.computed(function(){return this.logSize()<this.iViewLogSizeBytes?l.i18n("LOGSVIEWERWEBCLIENT/BUTTON_LOGGING_VIEW"):l.i18n("LOGSVIEWERWEBCLIENT/BUTTON_LOGGING_VIEW_LAST",{SIZE:l.getFriendlySize(this.iViewLogSizeBytes)})},this),this.eventsLogSize=r.observable(d.EventLogSizeBytes),this.downloadEventsLogText=r.computed(function(){return l.i18n("LOGSVIEWERWEBCLIENT/BUTTON_LOGGING_DOWNLOAD_EVENTS",{SIZE:l.getFriendlySize(this.eventsLogSize())})},this),this.viewEventsLogText=r.computed(function(){return this.eventsLogSize()<this.iViewLogSizeBytes?l.i18n("LOGSVIEWERWEBCLIENT/BUTTON_LOGGING_VIEW"):l.i18n("LOGSVIEWERWEBCLIENT/BUTTON_LOGGING_VIEW_LAST",{SIZE:l.getFriendlySize(this.iViewLogSizeBytes)})},this),this.usersWithSeparateLog=r.observableArray([]),this.enableLogging=r.observable(d.EnableLogging),this.enableEventLogging=r.observable(d.EnableEventLogging),this.loggingLevel=r.observable(d.LoggingLevel)}var o=i(2),n=i(1),r=i(46),a=i(269),l=i(43),h=i(44),u=i(189),c=i(196),d=i(291),p=i(42),m=p.run("AdminPanelWebclient","getAbstractSettingsFormViewClass");o.extendOwn(s.prototype,m.prototype),s.prototype.ViewTemplate="LogsViewerWebclient_AdminSettingsView",s.prototype.onRouteChild=function(){this.setUpdateStatusTimer(),u.send(d.ServerModuleName,"GetUsersWithSeparateLog",null,function(e){e.Result&&o.isArray(e.Result)&&this.usersWithSeparateLog(e.Result)},this)},s.prototype.turnOffSeparateLogs=function(){this.usersWithSeparateLog([]),u.send(d.ServerModuleName,"TurnOffSeparateLogs")},s.prototype.clearSeparateLogs=function(){u.send(d.ServerModuleName,"ClearSeparateLogs")},s.prototype.setUpdateStatusTimer=function(){this.bShown&&setTimeout(o.bind(function(){u.send(d.ServerModuleName,"GetLogFilesData",null,function(e){e.Result&&(d.updateLogsData(e.Result),this.logSize(d.LogSizeBytes),this.eventsLogSize(d.EventLogSizeBytes)),this.setUpdateStatusTimer()},this)},this),5e3)},s.prototype.getCurrentValues=function(){return[this.enableLogging(),this.enableEventLogging(),h.pInt(this.loggingLevel())]},s.prototype.revertGlobalValues=function(){this.enableLogging(d.EnableLogging),this.enableEventLogging(d.EnableEventLogging),this.loggingLevel(d.LoggingLevel)},s.prototype.getParametersForSave=function(){return{EnableLogging:this.enableLogging(),EnableEventLogging:this.enableEventLogging(),LoggingLevel:h.pInt(this.loggingLevel())}},s.prototype.applySavedValues=function(e){d.updateLogging(e.EnableLogging,e.EnableEventLogging,e.LoggingLevel)},s.prototype.setAccessLevel=function(e,t){this.visible(""===e)},s.prototype.downloadLog=function(e,t){u.send(d.ServerModuleName,"GetLogFile",{EventsLog:e,PublicId:t||""},function(i){var s=new Blob([i.ResponseText],{type:"text/plain;charset=utf-8"}),o=""!==h.pString(t)?t+"-":"";a.saveAs(s,e?d.EventLogFileName:o+d.LogFileName)},this,void 0,{Format:"Raw"})},s.prototype.viewLog=function(e){u.send(d.ServerModuleName,"GetLog",{EventsLog:e},function(e){if(e.Result){var t=c.open("","view-log");t&&n(t.document.body).html("<pre>"+e.Result+"</pre>")}},this)},s.prototype.clearLog=function(e){u.send(d.ServerModuleName,"ClearLog",{EventsLog:e},function(t){t.Result&&(e?this.eventsLogSize(0):this.logSize(0))},this)},e.exports=new s},295:function(e,t,i){"use strict";var s=i(2),o=i(44);e.exports={ServerModuleName:"MailChangePasswordPoppassdPlugin",HashModuleName:"mail-poppassd-plugin",Disabled:!1,SupportedServers:"",Host:"",Port:0,init:function(e){var t=e.MailChangePasswordPoppassdPlugin;s.isEmpty(t)||(this.Disabled=o.pBool(t.Disabled,this.Disabled),this.SupportedServers=o.pString(t.SupportedServers,this.SupportedServers),this.Host=o.pString(t.Host,this.Host),this.Port=o.pNonNegativeInt(t.Port,this.Port))},updateAdmin:function(e,t,i){this.SupportedServers=o.pString(e,this.SupportedServers),this.Host=o.pString(t,this.Host),this.Port=o.pNonNegativeInt(i,this.Port)}}},296:function(e,t,i){"use strict";function s(){h.call(this,"MailChangePasswordPoppassdPlugin"),this.supportedServers=n.observable(a.SupportedServers),this.host=n.observable(a.Host),this.port=n.observable(a.Port)}var o=i(2),n=i(46),r=i(44),a=i(295),l=i(42),h=l.run("AdminPanelWebclient","getAbstractSettingsFormViewClass");o.extendOwn(s.prototype,h.prototype),s.prototype.ViewTemplate="MailChangePasswordPoppassdPlugin_AdminSettingsView",s.prototype.getCurrentValues=function(){return[r.pString(this.supportedServers()),r.pString(this.host()),r.pInt(this.port())]},s.prototype.revertGlobalValues=function(){this.supportedServers(a.SupportedServers),this.host(a.Host),this.port(a.Port)},s.prototype.getParametersForSave=function(){return{SupportedServers:r.pString(this.supportedServers()),Host:r.pString(this.host()),Port:r.pInt(this.port())}},s.prototype.applySavedValues=function(e){a.updateAdmin(e.SupportedServers,e.Host,e.Port)},s.prototype.setAccessLevel=function(e,t){this.visible(""===e)},e.exports=new s},306:function(e,t,i){"use strict";var s=i(46),o=i(2),n=i(44),r=i(179);e.exports={ServerModuleName:"Mail",HashModuleName:"mail",AllowAddAccounts:!1,AllowAutoresponder:!1,AllowAutosaveInDrafts:!0,AllowDefaultAccountForUser:!0,AllowFetchers:!0,AllowFilters:!1,AllowForward:!1,AllowIdentities:!1,AllowInsertImage:!0,AllowMultiAccounts:!1,AutoSaveIntervalSeconds:60,ImageUploadSizeLimit:0,AllowAppRegisterMailto:!1,AllowChangeInputDirection:!0,AllowExpandFolders:!1,AllowSpamFolder:!0,AllowAddNewFolderOnMainScreen:!1,ComposeToolbarOrder:["back","send","save","importance","MailSensitivity","confirmation","OpenPgp"],DefaultFontName:"Tahoma",DefaultFontSize:3,JoinReplyPrefixes:!0,MailsPerPage:20,MaxMessagesBodiesSizeToPrefetch:5e4,ShowEmailAsTabName:!0,userMailAccountsCount:s.observable(0),mailAccountsEmails:s.observableArray([]),init:function(e){var t=e[this.ServerModuleName],i=e.MailWebclient;o.isEmpty(t)||(this.AllowAddAccounts=n.pBool(t.AllowAddAccounts,this.AllowAddAccounts),this.AllowAutoresponder=n.pBool(t.AllowAutoresponder,this.AllowAutoresponder),this.AllowAutosaveInDrafts=n.pBool(t.AllowAutosaveInDrafts,this.AllowAutosaveInDrafts),this.AllowDefaultAccountForUser=n.pBool(t.AllowDefaultAccountForUser,this.AllowDefaultAccountForUser),this.AllowFetchers=n.pBool(t.AllowFetchers,this.AllowFetchers),this.AllowFilters=n.pBool(t.AllowFilters,this.AllowFilters),this.AllowForward=n.pBool(t.AllowForward,this.AllowForward),this.AllowIdentities=n.pBool(t.AllowIdentities,this.AllowIdentities),this.AllowInsertImage=n.pBool(t.AllowInsertImage,this.AllowInsertImage),this.AllowMultiAccounts=n.pBool(t.AllowMultiAccounts,this.AllowMultiAccounts),this.AutoSaveIntervalSeconds=n.pNonNegativeInt(t.AutoSaveIntervalSeconds,this.AutoSaveIntervalSeconds),this.ImageUploadSizeLimit=n.pNonNegativeInt(t.ImageUploadSizeLimit,this.ImageUploadSizeLimit),window.Enums.SmtpAuthType=n.pObject(t.SmtpAuthType)),o.isEmpty(i)||(this.AllowAppRegisterMailto=n.pBool(i.AllowAppRegisterMailto,this.AllowAppRegisterMailto),this.AllowChangeInputDirection=n.pBool(i.AllowChangeInputDirection,this.AllowChangeInputDirection),this.AllowExpandFolders=n.pBool(i.AllowExpandFolders,this.AllowExpandFolders),this.AllowSpamFolder=n.pBool(i.AllowSpamFolder,this.AllowSpamFolder),this.AllowAddNewFolderOnMainScreen=n.pBool(i.AllowAddNewFolderOnMainScreen,this.AllowAddNewFolderOnMainScreen),this.ComposeToolbarOrder=n.pArray(i.ComposeToolbarOrder,this.ComposeToolbarOrder),this.DefaultFontName=n.pString(i.DefaultFontName,this.DefaultFontName),this.DefaultFontSize=n.pPositiveInt(i.DefaultFontSize,this.DefaultFontSize),this.JoinReplyPrefixes=n.pBool(i.JoinReplyPrefixes,this.JoinReplyPrefixes),this.MailsPerPage=n.pPositiveInt(i.MailsPerPage,this.MailsPerPage),this.MaxMessagesBodiesSizeToPrefetch=n.pNonNegativeInt(i.MaxMessagesBodiesSizeToPrefetch,this.MaxMessagesBodiesSizeToPrefetch),this.ShowEmailAsTabName=n.pBool(i.ShowEmailAsTabName,this.ShowEmailAsTabName)),r.registerUserAccountsCount(this.userMailAccountsCount),r.registerAccountsWithPass(this.mailAccountsEmails)},update:function(e,t,i){this.AllowAutosaveInDrafts=n.pBool(t,this.AllowAutosaveInDrafts),this.AllowChangeInputDirection=n.pBool(i,this.AllowChangeInputDirection),this.MailsPerPage=n.pPositiveInt(e,this.MailsPerPage)}}},307:function(e,t,i){"use strict";function s(){this.collection=n.observableArray([])}var o=i(2),n=i(46),r=i(44),a=i(179),l=a.isNewTab()&&window.opener?window.opener.MainTabMailMethods:null,h=i(191),u=i(308),c=i(311),d=i(306),p=i(336),m=i(340),g=i(342);s.prototype.getAccountByHash=function(e){return o.find(this.collection(),function(t){return t.hash()===e},this)},s.prototype.changeCurrentAccountByHash=function(e){var t=this.getAccountByHash(e);t&&t.id()!==this.currentId()&&this.changeCurrentAccount(t.id(),!1)},s.prototype.changeCurrentAccount=function(e,t){var i=this.getCurrent(),s=this.getAccount(e);s&&this.currentId()!==e?(i&&i.isCurrent(!1),this.currentId(e),s.isCurrent(!0)):i||this.currentId(0),t&&h.setHash(c.getMailbox())},s.prototype.changeEditedAccountByHash=function(e){var t=this.getAccountByHash(e);t&&t.id()!==this.editedId()&&this.changeEditedAccount(t.id())},s.prototype.changeEditedAccount=function(e){var t=this.getEdited(),i=this.getAccount(e);i&&this.editedId()!==e?(t&&t.isEdited(!1),this.editedId(e),i.isEdited(!0)):t||this.editedId(0)},s.prototype.getDefaultFriendlyName=function(){var e=this.getCurrent(),t=o.find(e&&e.identities()||[],function(e){return e.isDefault()})||e;return t?t.friendlyName()||t.email():""},s.prototype.getIdentityByHash=function(e){var t=null;return o.each(this.collection(),function(i){t||(t=o.find(i.identities()||[],function(t){return t.hash()===e}))},this),t},s.prototype.getFetcherByHash=function(e){var t=null;return o.each(this.collection(),function(i){t||(t=o.find(i.fetchers()||[],function(t){return t.hash()===e}))},this),t},s.prototype.parse=function(e){o.isArray(e)&&(this.collection(o.map(e,function(e){return new p(e)})),this.initObservables(this.collection().length>0?this.collection()[0].id():0))},s.prototype.initObservables=function(e){var t=this.getAccount(e);t&&(t.isCurrent(!0),t.isEdited(!0)),this.currentId=n.observable(e),this.editedId=n.observable(e)},s.prototype.hasAccount=function(){return this.collection().length>0},s.prototype.getAccount=function(e){var t=o.find(this.collection(),function(t){return t.id()===e},this);return t},s.prototype.getCurrent=function(){return this.getAccount(this.currentId())},s.prototype.getEdited=function(){return this.getAccount(this.editedId())},s.prototype.getEmail=function(e){e=e||this.currentId();var t="",i=this.getAccount(e);return i&&(t=i.email()),t},s.prototype.addAccount=function(e){this.collection.push(e)},s.prototype.deleteAccount=function(e){this.collection.remove(function(t){return t.id()===e});var t=this.collection().length>0?this.collection()[0].id():0;this.changeCurrentAccount(t,!1),this.changeEditedAccount(t)},s.prototype.hasAccountWithId=function(e){var t=o.find(this.collection(),function(t){return t.id()===e},this);return!!t},s.prototype.populateFetchersIdentities=function(){this.populateFetchers(),this.populateIdentities()},s.prototype.populateFetchers=function(){d.AllowFetchers&&u.send("GetFetchers",{AccountID:this.editedId()},this.onGetFetchersResponse,this)},s.prototype.onGetFetchersResponse=function(e,t){var i=null,s=this.getEdited();r.isNonEmptyArray(e.Result)&&(i=new m,i.parse(e.Result)),s&&s.fetchers(i)},s.prototype.populateIdentities=function(){d.AllowIdentities&&this.collection().length>=1&&u.send("GetIdentities",null,this.onGetIdentitiesResponse,this)},s.prototype.onGetIdentitiesResponse=function(e,t){var i={};r.isNonEmptyArray(e.Result)&&o.each(e.Result,function(e){var t=new g,s=-1;t.parse(e),s=t.accountId(),i[s]||(i[s]=[]),i[s].push(t)}),o.each(this.collection(),function(e){var t=i[e.id()],s=new g;r.isNonEmptyArray(t)||(t=[]),s.parse({"@Object":"Object/Aurora\\Modules\\Mail\\Classes\\Identity",AccountPart:!0,Default:!o.find(t,function(e){return e.isDefault()}),Email:e.email(),FriendlyName:e.friendlyName(),IdAccount:e.id(),EntityId:1e5*e.id(),Signature:e.signature(),UseSignature:e.useSignature()}),t.unshift(s),e.identities(t)})},s.prototype.populateIdentitiesFromSourceAccount=function(e){e&&o.each(this.collection(),function(t){var i=e.getAccount(t.id());i&&(t.fetchers(i.fetchers()),t.identities(i.identities()),t.signature(i.signature()),t.useSignature(i.useSignature()))})},s.prototype.getAccountsEmails=function(){return o.uniq(o.map(this.collection(),function(e){return e.email()}))},s.prototype.getAllFullEmails=function(){var e=[];return o.each(this.collection(),function(t){t&&(r.isNonEmptyArray(t.identities())?o.each(t.identities(),function(t){e.push(t.fullEmail())}):e.push(t.fullEmail()),t.fetchers()&&r.isNonEmptyArray(t.fetchers().collection())&&o.each(t.fetchers().collection(),function(t){t.isOutgoingEnabled()&&""!==t.fullEmail()&&e.push(t.fullEmail())}))}),e},s.prototype.getCurrentFetchersAndFiltersFolderNames=function(){var e=this.getCurrent(),t=[];return e&&(e.filters()&&o.each(e.filters().collection(),function(e){t.push(e.folder())},this),e.fetchers()&&o.each(e.fetchers().collection(),function(e){t.push(e.folder())},this)),t},s.prototype.getAttendee=function(e){var t=[],i="";return o.each(this.collection(),function(e){t=e.isCurrent()?o.union([e.email()],e.getFetchersIdentitiesEmails(),t):o.union(t,[e.email()],e.getFetchersIdentitiesEmails())}),t=o.uniq(t),o.each(t,o.bind(function(t){if(""===i){var s=o.find(e,function(e){return e===t});s===t&&(i=t)}},this)),i};var f=new s;window.auroraAppData.Mail&&o.isArray(window.auroraAppData.Mail.Accounts)?f.parse(window.auroraAppData.Mail.Accounts):f.parse([]),l&&f.populateIdentitiesFromSourceAccount(l.getAccountList()),e.exports=f},308:function(e,t,i){"use strict";var s=i(189),o=i(306);s.registerAbortRequestHandler(o.ServerModuleName,function(e,t){var i=e.Parameters,s=t.Parameters;switch(e.Method){case"MoveMessages":case"DeleteMessages":return"GetMessage"===t.Method||"GetMessages"===t.Method&&s.Folder===i.Folder;case"GetMessages":case"SetMessagesSeen":case"SetMessageFlagged":return"GetMessages"===t.Method&&s.Folder===i.Folder;case"SetAllMessagesSeen":return("GetMessages"===t.Method||"GetMessages"===t.Method)&&s.Folder===i.Folder;
case"ClearFolder":return"GetRelevantFoldersInformation"===t.Method||"GetMessages"===t.Method&&s.Folder===i.Folder;case"GetRelevantFoldersInformation":return"GetRelevantFoldersInformation"===t.Method&&i.AccountID===s.AccountID;case"GetMessagesFlags":return"GetMessagesFlags"===t.Method}return!1}),e.exports={getOpenedRequest:function(e){s.getOpenedRequest("Mail",e)},hasOpenedRequests:function(e){s.hasOpenedRequests("Mail",e)},registerOnAllRequestsClosedHandler:s.registerOnAllRequestsClosedHandler,send:function(e,t,n,r){var a=i(309),l="GetMessagesBodies"===e?1e5:void 0;t&&!t.AccountID&&(t.AccountID=a.currentAccountId()),s.send(o.ServerModuleName,e,t,n,r,l)}}},309:function(e,t,i){"use strict";function s(){this.currentAccountId=E.currentId,this.currentAccountId.subscribe(function(e){var t=E.getAccount(e),i=this.oFolderListItems[e];t?(t.quotaRecieved(!1),this.messagesLoadingError(!1),i?this.folderList(i):(this.messagesLoading(!0),this.folderList(new F),this.messages([]),this.currentMessage(null),this.getFolderList(e))):this.folderList(new F)},this),this.editedAccountId=E.editedId,this.editedAccountId.subscribe(function(e){var t=this.oFolderListItems[e];t?this.editedFolderList(t):this.currentAccountId()!==e&&(this.editedFolderList(new F),this.getFolderList(e))},this),this.oFolderListItems={},this.quotaChangeTrigger=r.observable(!1),this.checkMailStarted=r.observable(!1),this.checkMailStartedAccountId=r.observable(0),this.folderList=r.observable(new F),this.folderListLoading=r.observableArray([]),this.editedFolderList=r.observable(new F),this.newMessagesCount=r.computed(function(){var e=this.folderList().inboxFolder();return e?e.unseenMessageCount():0},this),this.messages=r.observableArray([]),this.messages.subscribe(function(){this.messages().length>0&&this.messagesLoadingError(!1)},this),this.uidList=r.observable(new I),this.page=r.observable(1),this.messagesLoading=r.observable(!1),this.messagesLoadingError=r.observable(!1),this.currentMessage=r.observable(null),this.nextMessageUid=r.observable(""),this.prevMessageUid=r.observable(""),this.savingDraftUid=r.observable(""),this.editedDraftUid=r.observable(""),this.disableComposeAutosave=r.observable(!1),this.aResponseHandlers=[],this.iAutoCheckMailTimer=-1,this.waitForUnseenMessages=r.observable(!0),this.iSetMessagesSeenCount=0,d.subscribeEvent("ReceiveAjaxResponse::after",o.bind(function(e){!this.checkMailStarted()&&"Ping"===e.Response.Method&&"Core"===e.Response.Module&&e.Response.Result&&this.setAutocheckmailTimer()},this))}var o=i(2),n=i(1),r=i(46),a=i(51),l=i(43),h=i(44),u=i(213),c=i(181),d=i(179),p=i(310),m=i(191),g=i(45),f=i(196),b=i(184),v=i(185),y=i(311),E=i(307),S=i(308),A=null,C=i(306),F=i(312),I=i(321),T=d.isNewTab()&&window.opener&&window.opener.MainTabMailMethods;s.prototype.requirePrefetcher=function(){A=i(322)},s.prototype.init=function(){if(S.registerOnAllRequestsClosedHandler(function(){o.delay(function(){S.hasOpenedRequests()||(L.checkMailStarted(!1),L.folderListLoading.removeAll())},10)}),T){if(this.oFolderListItems=T.getFolderListItems(),this.uidList(T.getUidList()),window.name){var e=h.pInt(window.name);0===e&&(e=T.getComposedMessageAccountId(window.name)),0!==e&&this.currentAccountId(e)}this.currentAccountId.valueHasMutated(),this.initPrevNextSubscribes()}else this.currentAccountId.valueHasMutated()},s.prototype.initPrevNextSubscribes=function(){this.bInThreadLevel=!1,this.currentMessage.subscribe(this.calcNextMessageUid,this),this.uidList.subscribe(this.calcNextMessageUid,this),this.currentMessage.subscribe(this.calcPrevMessageUid,this),this.uidList.subscribe(this.calcPrevMessageUid,this)},s.prototype.calcNextMessageUid=function(){var e="",t="",i=null,s=null,n=!1;this.currentMessage()&&(n=this.currentMessage().threadPart()&&""!==this.currentMessage().threadParentUid(),i=this.folderList().getFolderByFullName(this.currentMessage().folder()),e=this.currentMessage().uid(),this.bInThreadLevel||n?(this.bInThreadLevel=!0,n&&(s=i.getMessageByUid(this.currentMessage().threadParentUid()),s&&(o.each(s.threadUids(),function(i,s,o){i===e&&s>0&&(t=o[s-1])}),h.isNonEmptyString(t)||(t=s.uid())))):(o.each(this.uidList().collection(),function(i,s,o){i===e&&s>0&&(t=o[s-1]||"")}),""===t&&T&&(this.requirePrefetcher(),A.prefetchNextPage(e)))),this.nextMessageUid(t)},s.prototype.calcPrevMessageUid=function(){var e=this.currentMessage()?this.currentMessage().uid():"",t="",i=null,s=null,n=!1;this.currentMessage()&&(n=this.currentMessage().threadPart()&&""!==this.currentMessage().threadParentUid(),i=this.folderList().getFolderByFullName(this.currentMessage().folder()),e=this.currentMessage().uid(),this.bInThreadLevel||n?(this.bInThreadLevel=!0,n?(s=i.getMessageByUid(this.currentMessage().threadParentUid()),s&&o.each(s.threadUids(),function(i,s,o){i===e&&s+1<o.length&&(t=o[s+1]||"")})):this.currentMessage().threadCount()>0&&(t=this.currentMessage().threadUids()[0])):(o.each(this.uidList().collection(),function(i,s,o){i===e&&s+1<o.length&&(t=o[s+1]||"")}),""===t&&T&&(this.requirePrefetcher(),A.prefetchPrevPage(e)))),this.prevMessageUid(t)},s.prototype.getCurrentFolder=function(){return this.folderList().currentFolder()},s.prototype.getFolderByFullName=function(e,t){var i=this.oFolderListItems[e];return i?i.getFolderByFullName(t):null},s.prototype.checkCurrentFolderList=function(){var e=E.getCurrent(),t=e?this.oFolderListItems[e.id()]:null;!e||t||this.messagesLoading()||(this.messagesLoading(!0),this.messagesLoadingError(!1),this.getFolderList(e.id()))},s.prototype.getFolderList=function(e){var t=E.getAccount(e);t?(this.folderListLoading.push(e),S.send("GetFolders",{AccountID:e},this.onGetFoldersResponse,this)):e===this.currentAccountId()&&this.messagesLoading(!1)},s.prototype.markMessageReplied=function(e,t,i,s){var o=this.oFolderListItems[e],n=null;o&&(n=o.getFolderByFullName(t),n&&n.markMessageReplied(i,s))},s.prototype.hideThreads=function(e){var t=E.getCurrent();t&&t.threadingIsAvailable()&&e.folder()===this.folderList().currentFolderFullName()&&!e.threadOpened()&&this.folderList().currentFolder().hideThreadMessages(e)},s.prototype.showOpenedThreads=function(e){this.messages(this.getMessagesWithThreads(e,this.uidList(),this.messages()))},s.prototype.useThreadingInCurrentList=function(e){e=e||this.uidList();var t=E.getCurrent(),i=this.folderList().currentFolder(),s=i&&i.withoutThreads(),o=""===e.search()&&""===e.filters();return t&&t.threadingIsAvailable()&&!s&&o},s.prototype.getMessagesWithThreads=function(e,t,i){var s=[],n=[],r=this.folderList().currentFolder();return r&&e===r.fullName()&&this.useThreadingInCurrentList(t)?(n=o.filter(i,function(e){return!e.threadPart()}),o.each(n,function(e){var t=[];s.push(e),e.threadCount()>0&&(e.threadOpened()&&(t=this.folderList().currentFolder().getThreadMessages(e),s=o.union(s,t)),r.computeThreadData(e))},this),s):i},s.prototype.setMessagesFromUidList=function(e,t,i,s){var n=e.getUidsForOffset(t,i),r=o.map(n,function(e){return i[e]},this),a=r.length;return s&&(this.messages(this.getMessagesWithThreads(this.folderList().currentFolderFullName(),e,r)),t+a<e.resultCount()&&a<C.MailsPerPage&&(e.filters()!==Enums.FolderFilter.Unseen||this.waitForUnseenMessages())&&this.messagesLoading(!0),this.currentMessage()&&(this.currentMessage().deleted()||this.currentMessage().folder()!==this.folderList().currentFolderFullName())&&this.currentMessage(null)),n},s.prototype.executeCheckMail=function(e){var t=this.oFolderListItems[this.currentAccountId()],i=E.getCurrentFetchersAndFiltersFolderNames(),s=t?[t.inboxFolderFullName(),t.spamFolderFullName(),t.currentFolderFullName()]:[],n=t?t.iAccountId:0,r=this.checkMailStarted()&&this.checkMailStartedAccountId()===n,a=null;d.getUserRole()!==Enums.UserRole.Anonymous&&(e||!S.hasOpenedRequests("GetRelevantFoldersInformation")||!r)&&s.length>0&&(s=o.uniq(o.compact(o.union(s,i))),a={Folders:s,AccountID:n},this.checkMailStarted(!0),this.checkMailStartedAccountId(n),E.getAccount(n)&&S.send("GetRelevantFoldersInformation",a,this.onGetRelevantFoldersInformationResponse,this))},s.prototype.setAutocheckmailTimer=function(){clearTimeout(this.iAutoCheckMailTimer),!d.isNewTab()&&g.AutoRefreshIntervalMinutes>0&&(this.iAutoCheckMailTimer=setTimeout(function(){L.isSearchExecuting()||(L.checkMessageFlags(),L.executeCheckMail(!1))},60*g.AutoRefreshIntervalMinutes*1e3))},s.prototype.isSearchExecuting=function(){var e=S.getOpenedRequest("GetMessages"),t=e&&e.Parameters;return t&&""!==t.Search},s.prototype.checkMessageFlags=function(){var e=this.folderList().inboxFolder(),t=e?e.getFlaggedMessageUids():[],i={Folder:this.folderList().inboxFolderFullName(),Uids:t};t.length>0&&S.send("GetMessagesFlags",i,this.onGetMessagesFlagsResponse,this)},s.prototype.onGetMessagesFlagsResponse=function(e,t){var i=t.Parameters,s=this.oFolderListItems[i.AccountID],n=s?s.inboxFolder():null;n&&(e.Result&&o.each(e.Result,function(e,t){o.indexOf(e,"\\flagged")===-1&&n.setMessageUnflaggedByUid(t)}),n.removeFlaggedMessageListsFromCache(),this.requirePrefetcher(),A.prefetchStarredMessageList())},s.prototype.changeCurrentMessageList=function(e,t,i,s){this.requestCurrentMessageList(e,t,i,s,!0)},s.prototype.requestCurrentMessageList=function(e,t,i,s,o){var n=this.requestMessageList(e,t,i,s||"",!0,o||!1),r=60*g.AutoRefreshIntervalMinutes*1e3,l=n.Folder.relevantInformationLastMoment?a().diff(n.Folder.relevantInformationLastMoment):r+1;this.uidList(n.UidList),this.page(t),this.messagesLoading(n.RequestStarted),this.messagesLoadingError(!1),!n.RequestStarted&&r>0&&l>r&&this.executeCheckMail(!0)},s.prototype.requestMessageList=function(e,t,i,s,o,n){var r=this.oFolderListItems[this.currentAccountId()],a=r?r.getFolderByFullName(e):null,l=a&&a.withoutThreads(),h=E.getCurrent(),u=h&&h.threadingIsAvailable()&&!l&&""===i&&""===s,c=a?a.getUidList(i,s):null,d=c&&c.resultCount()===-1,p=(t-1)*C.MailsPerPage,m={Folder:e,Offset:p,Limit:C.MailsPerPage,Search:i,Filters:s,UseThreading:u},g=!1,f=!1,b=o?this.onCurrentGetMessagesResponse:this.onGetMessagesResponse,v=[];return a.type()===Enums.FolderTypes.Inbox&&""===s?m.InboxUidnext=a.sUidNext:m.InboxUidnext="",d&&c.search()===this.uidList().search()&&c.filters()===this.uidList().filters()&&(c=this.uidList()),c&&(v=this.setMessagesFromUidList(c,p,a.oMessages,n)),c&&(f=d||p+v.length<c.resultCount()&&v.length<C.MailsPerPage,g=a.hasChanges()||f),g?S.send("GetMessages",m,b,this):this.waitForUnseenMessages(!1),{UidList:c,RequestStarted:g,DataExpected:f,Folder:a}},s.prototype.executeEmptyTrash=function(){var e=this.folderList().trashFolder();e&&e.emptyFolder()},s.prototype.executeEmptySpam=function(){var e=this.folderList().spamFolder();e&&e.emptyFolder()},s.prototype.onClearFolder=function(e){if(e&&e.selected()){this.messages.removeAll(),this.currentMessage(null);var t=e?e.getUidList(this.uidList().search(),this.uidList().filters()):null;t?this.uidList(t):this.uidList(new I),this.checkMailStarted(!1),this.setAutocheckmailTimer()}},s.prototype.getOpenedDraftUids=function(){var e=f.getOpenedWindows(),t=o.map(e,function(e){return e.SlaveTabMailMethods&&window.location.origin===e.location.origin?e.SlaveTabMailMethods.getEditedDraftUid():""});return b.hasOpenedMinimizedPopups()&&t.push(this.editedDraftUid()),o.uniq(o.compact(t))},s.prototype.closeComposesWithDraftUids=function(e){var t=f.getOpenedWindows();if(o.each(t,function(t){t.SlaveTabMailMethods&&window.location.origin===t.location.origin&&-1!==n.inArray(t.SlaveTabMailMethods.getEditedDraftUid(),e)&&t.close()}),-1!==n.inArray(this.editedDraftUid(),e)){var s=i(323);o.isFunction(s.closeComposePopup)&&s.closeComposePopup()}},s.prototype.moveMessagesToFolder=function(e,t){if(t.length>0){var i=this.folderList().currentFolder(),s=i&&i.type()===Enums.FolderTypes.Drafts,r=s&&this.getOpenedDraftUids(),a=s&&o.find(t,o.bind(function(e){return-1!==n.inArray(e,r)},this)),h=this.folderList().getFolderByFullName(e),u={Folder:i?i.fullName():"",ToFolder:e,Uids:t.join(",")},c=null,d=o.bind(function(){this.uidList().filters()===Enums.FolderFilter.Unseen&&this.uidList().resultCount()>C.MailsPerPage&&this.waitForUnseenMessages(!0),c=i.markDeletedByUids(t),h.addMessagesCountsDiff(c.MinusDiff,c.UnseenMinusDiff),h.recivedAnim(!0),this.excludeDeletedMessages(),h.markHasChanges(),S.send("MoveMessages",u,this.onMoveMessagesResponse,this)},this);i&&h&&(a?(this.disableComposeAutosave(!0),b.showPopup(v,[l.i18n("MAILWEBCLIENT/CONFIRM_MESSAGE_FOR_DELETE_IS_EDITED"),o.bind(function(e){e&&(this.closeComposesWithDraftUids(t),d()),this.disableComposeAutosave(!1)},this),"",l.i18n("MAILWEBCLIENT/ACTION_CLOSE_DELETE_DRAFT")])):d())}},s.prototype.copyMessagesToFolder=function(e,t){if(t.length>0){var i=this.folderList().currentFolder(),s=this.folderList().getFolderByFullName(e),o={Folder:i?i.fullName():"",ToFolder:e,Uids:t.join(",")};i&&s&&(s.recivedAnim(!0),s.markHasChanges(),S.send("CopyMessages",o,this.onCopyMessagesResponse,this))}},s.prototype.excludeDeletedMessages=function(){o.delay(o.bind(function(){var e=this.folderList().currentFolder(),t=(this.page()-1)*C.MailsPerPage;this.setMessagesFromUidList(this.uidList(),t,e.oMessages,!0)},this),500)},s.prototype.removeOneMessageFromCacheForFolder=function(e,t,i){var s=this.oFolderListItems[e],o=s?s.getFolderByFullName(t):null;o&&o.type()===Enums.FolderTypes.Drafts&&(o.markDeletedByUids([i]),o.commitDeleted([i]))},s.prototype.startMessagesLoadingWhenDraftSaving=function(e,t){var i=this.oFolderListItems[e],s=i?i.getFolderByFullName(t):null;s&&s.type()===Enums.FolderTypes.Drafts&&s.selected()&&this.messagesLoading(!0)},s.prototype.removeMessagesFromCacheForFolder=function(e,t){var i=this.oFolderListItems[e],s=i?i.getFolderByFullName(t):null,o=i?i.currentFolderFullName():null;s&&(s.markHasChanges(),this.currentAccountId()===e&&t===o&&this.requestCurrentMessageList(o,this.page(),this.uidList().search(),"",!0))},s.prototype.deleteMessages=function(e){var t=this.folderList().currentFolder();t&&this.deleteMessagesFromFolder(t,e)},s.prototype.deleteMessagesFromFolder=function(e,t){var i={Folder:e.fullName(),Uids:t.join(",")};e.markDeletedByUids(t),this.excludeDeletedMessages(),S.send("DeleteMessages",i,this.onMoveMessagesResponse,this)},s.prototype.showExternalPictures=function(e){var t=[],i=null;this.currentMessage()&&(t=this.currentMessage().oFrom.aCollection,i=this.folderList().getFolderByFullName(this.currentMessage().folder()),e&&t.length>0?i.alwaysShowExternalPicturesForSender(t[0].sEmail):i.showExternalPictures(this.currentMessage().uid()))},s.prototype.setCurrentMessage=function(e,t){var i=this.folderList().currentFolder(),s=null;!d.isNewTab()||i&&i.fullName()===t||(this.folderList().setCurrentFolder(t,""),i=this.folderList().currentFolder()),i&&e&&(s=i.oMessages[e]),s&&!s.deleted()?(this.currentMessage(s),this.currentMessage().seen()||this.executeGroupOperation("SetMessagesSeen",[this.currentMessage().uid()],"seen",!0),i.getCompletelyFilledMessage(e,this.onCurrentMessageResponse,this)):(this.currentMessage(null),d.isNewTab()&&i&&i.getCompletelyFilledMessage(e,this.onCurrentMessageResponse,this))},s.prototype.onCurrentMessageResponse=function(e,t){var i=this.currentMessage()?this.currentMessage().uid():"";null===e&&i===t?this.currentMessage(null):e&&i===t?this.currentMessage.valueHasMutated():d.isNewTab()&&e&&null===this.currentMessage()&&this.currentMessage(e)},s.prototype.getMessage=function(e,t,i,s){var o=this.folderList().getFolderByFullName(e);o&&o.getCompletelyFilledMessage(t,i,s)},s.prototype.executeGroupOperation=function(e,t,i,s){var o=this.folderList().currentFolder(),n={Folder:o?o.fullName():"",Uids:t.join(","),SetAction:s},r=(this.page()-1)*C.MailsPerPage,a=t.length,l=this.folderList().oStarredFolder?this.folderList().oStarredFolder.messageCount():0,h=o?o.getUidList("",Enums.FolderFilter.Flagged):null,u="SetMessagesSeen"===e?this.onSetMessagesSeenResponse:function(){};o&&("SetMessagesSeen"===e&&this.iSetMessagesSeenCount++,S.send(e,n,u,this),o.executeGroupOperation(i,t,s),o.type()===Enums.FolderTypes.Inbox&&"flagged"===i&&(this.uidList().filters()===Enums.FolderFilter.Flagged?s||(this.uidList().deleteUids(t),this.folderList().oStarredFolder&&this.folderList().oStarredFolder.messageCount(h.resultCount())):(o.removeFlaggedMessageListsFromCache(),""===this.uidList().search()&&this.folderList().oStarredFolder&&(s?this.folderList().oStarredFolder.messageCount(l+a):this.folderList().oStarredFolder.messageCount(l-a>0?l-a:0)))),"seen"===i&&o.removeUnseenMessageListsFromCache(),(this.uidList().filters()!==Enums.FolderFilter.Unseen||this.waitForUnseenMessages())&&this.setMessagesFromUidList(this.uidList(),r,o.oMessages,!0))},s.prototype.onSetMessagesSeenResponse=function(e,t){this.iSetMessagesSeenCount--,this.iSetMessagesSeenCount<0&&(this.iSetMessagesSeenCount=0),this.folderList().currentFolder()&&0===this.iSetMessagesSeenCount&&(this.uidList().filters()!==Enums.FolderFilter.Unseen||this.waitForUnseenMessages())&&this.requestCurrentMessageList(this.folderList().currentFolder().fullName(),this.page(),this.uidList().search(),this.uidList().filters(),!1)},s.prototype.onGetFoldersResponse=function(e,t){var i=t.Parameters,s=new F,n=i.AccountID,r=this.oFolderListItems[n],a=r?r.oNamedCollection:{};e.Result===!1?(c.showErrorByCode(e),i.AccountID===this.currentAccountId()&&0===this.messages().length&&(this.messagesLoading(!1),this.messagesLoadingError(!0))):(s.parse(n,e.Result,a),r&&s.oStarredFolder.messageCount(r.oStarredFolder.messageCount()),this.oFolderListItems[n]=s,setTimeout(o.bind(this.getAllFoldersRelevantInformation,this,n),2e3),this.currentAccountId()===n&&this.folderList(s),this.editedAccountId()===n&&this.editedFolderList(s)),this.folderListLoading.remove(n)},s.prototype.getAllFoldersRelevantInformation=function(e){var t=this.oFolderListItems[e],i=t?t.getFoldersWithoutCountInfo():[],s={Folders:i,AccountID:e};i.length>0&&E.getAccount(e)&&S.send("GetRelevantFoldersInformation",s,this.onGetRelevantFoldersInformationResponse,this)},s.prototype.onGetRelevantFoldersInformationResponse=function(e,t){var i=!1,s=t.Parameters,n=s.AccountID,r=this.oFolderListItems[n],a=this.folderList().currentFolderFullName(),l=this.currentAccountId()===n;e.Result===!1?(c.showErrorByCode(e),S.hasOpenedRequests("GetRelevantFoldersInformation")&&(i=!0)):r&&(o.each(e.Result&&e.Result.Counts,function(e,t){if(o.isArray(e)&&e.length>3){var s=e[0],n=e[1],h=e[2],u=e[3],c=!1,d=!1,p=null;p=r.getFolderByFullName(t),p&&(d=l&&p.fullName()===a,c=p.setRelevantInformation(h,u,s,n,d),d&&c&&this.uidList().filters()!==Enums.FolderFilter.Unseen&&(this.requestCurrentMessageList(p.fullName(),this.page(),this.uidList().search(),this.uidList().filters(),!1),i=!0))}},this),r.countsCompletelyFilled(!0)),this.checkMailStarted(i),this.checkMailStarted()||this.setAutocheckmailTimer()},s.prototype.showNotificationsForNewMessages=function(e){var t=this.folderList().currentFolderFullName(),i=0,s="",n={},r="",a=[];e.Result.New&&e.Result.New.length>0&&(i=e.Result.New.length,s=e.Result.New[0].Uid,n={action:"show",icon:"static/styles/images/logo_140x140.png",title:l.i18n("MAILWEBCLIENT/INFO_NEW_MESSAGES_PLURAL",{COUNT:i},null,i),timeout:5e3,callback:function(){window.focus(),m.setHash(y.getMailbox(t,1,s,"",""))}},1===i&&(h.isNonEmptyString(e.Result.New[0].Subject)&&a.push(l.i18n("MAILWEBCLIENT/LABEL_SUBJECT")+": "+e.Result.New[0].Subject),r=o.map(e.Result.New[0].From,function(e){return""!==e.DisplayName?e.DisplayName:e.Email}).join(", "),h.isNonEmptyString(r)&&a.push(l.i18n("MAILWEBCLIENT/LABEL_FROM")+": "+r),n.body=a.join("\r\n")),u.desktopNotify(n))},s.prototype.onCurrentGetMessagesResponse=function(e,t){this.checkMailStarted(!1),e.Result?(this.messagesLoadingError(!1),this.parseMessageList(e,t)):(c.showErrorByCode(e),this.messagesLoading()!==!0||0!==this.messages().length&&e.ErrorCode===Enums.Errors.NotDisplayedError||this.messagesLoadingError(!0),this.messagesLoading(!1),this.setAutocheckmailTimer())},s.prototype.onGetMessagesResponse=function(e,t){e&&e.Result&&this.parseMessageList(e,t)},s.prototype.parseMessageList=function(e,t){var i=e.Result,s=t.Parameters,n=s.AccountID,r=this.oFolderListItems[n],a=null,l=null,h=s.UseThreading,u=!1,c=this.currentAccountId()===n&&this.folderList().currentFolderFullName()===i.FolderName,d=c&&this.uidList().search()===i.Search&&this.uidList().filters()===i.Filters,p=this.page()===i.Offset/C.MailsPerPage+1,m=[];this.showNotificationsForNewMessages(e),i!==!1&&"Collection/MessageCollection"===i["@Object"]&&(a=r.getFolderByFullName(i.FolderName),a.setRelevantInformation(""+i.UidNext,i.FolderHash,i.MessageCount,i.MessageUnseenCount,c&&!d),u=a.hasChanges(),a.removeAllMessageListsFromCacheIfHasChanges(),l=a.getUidList(i.Search,i.Filters),l.setUidsAndCount(i),o.each(i["@Collection"],function(e){var t=a.parseAndCacheMessage(e,!1,h);m.push(t)},this),d&&(this.uidList(l),p&&(l.filters()!==Enums.FolderFilter.Unseen||this.waitForUnseenMessages())&&(this.messagesLoading(!1),this.waitForUnseenMessages(!1),this.setMessagesFromUidList(l,i.Offset,a.oMessages,!0),this.messagesLoading()||this.setAutocheckmailTimer())),!u||!c||d&&p||this.uidList().filters()===Enums.FolderFilter.Unseen||this.requestCurrentMessageList(this.folderList().currentFolderFullName(),this.page(),this.uidList().search(),this.uidList().filters(),!1),a.type()===Enums.FolderTypes.Inbox&&l.filters()===Enums.FolderFilter.Flagged&&""===l.search()&&this.folderList().oStarredFolder&&(this.folderList().oStarredFolder.messageCount(l.resultCount()),this.folderList().oStarredFolder.hasExtendedInfo(!0)))},s.prototype.increaseStarredCount=function(){this.folderList().oStarredFolder&&this.folderList().oStarredFolder.increaseCountIfHasNotInfo()},s.prototype.onMoveMessagesResponse=function(e,t){var i=e.Result,s=t.Parameters,n=this.folderList().getFolderByFullName(s.Folder),r=this.folderList().getFolderByFullName(s.ToFolder),a=r&&r.type()===Enums.FolderTypes.Trash,u=r&&r.type()===Enums.FolderTypes.Spam,d=null,p=a?l.i18n("MAILWEBCLIENT/CONFIRM_MESSAGES_DELETE_WITHOUT_TRASH"):l.i18n("MAILWEBCLIENT/CONFIRM_MESSAGES_MARK_SPAM_WITHOUT_SPAM"),g=o.bind(function(e){e&&n&&this.deleteMessagesFromFolder(n,s.Uids.split(","))},this),f=this.folderList().currentFolder(),y=f.fullName(),E=!1;if(i===!1?(d=n.revertDeleted(s.Uids.split(",")),r?(r.addMessagesCountsDiff(-d.PlusDiff,-d.UnseenPlusDiff),e.ErrorCode===Enums.MailErrors.CannotMoveMessageQuota&&(a||u)?(h.isNonEmptyString(e.ErrorMessage)&&(p+=" ("+e.ErrorMessage+")"),b.showPopup(v,[p,g])):c.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_MOVING_MESSAGES"))):c.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_DELETING_MESSAGES")),E=!0):(n.commitDeleted(s.Uids.split(",")),o.each(s.Uids.split(","),function(e){m.replaceHashWithoutMessageUid(e)})),y===n.fullName()||r&&y===r.fullName())switch(f.markHasChanges(),this.uidList().filters()){case Enums.FolderFilter.Flagged:break;case Enums.FolderFilter.Unseen:this.waitForUnseenMessages()&&this.requestCurrentMessageList(y,this.page(),this.uidList().search(),this.uidList().filters(),E);break;default:this.requestCurrentMessageList(y,this.page(),this.uidList().search(),this.uidList().filters(),E)}else y!==n.fullName()?(this.requirePrefetcher(),A.startFolderPrefetch(n)):r&&y!==r.fullName()&&(this.requirePrefetcher(),A.startFolderPrefetch(r))},s.prototype.onCopyMessagesResponse=function(e,t){var i=e.Result,s=t.Parameters,o=this.folderList().getFolderByFullName(s.Folder),n=this.folderList().getFolderByFullName(s.ToFolder),r=this.folderList().currentFolder(),a=r.fullName();i===!1&&c.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_COPYING_MESSAGES")),a===o.fullName()||n&&a===n.fullName()?(r.markHasChanges(),this.requestCurrentMessageList(a,this.page(),this.uidList().search(),"",!1)):a!==o.fullName()?(this.requirePrefetcher(),A.startFolderPrefetch(o)):n&&a!==n.fullName()&&(this.requirePrefetcher(),A.startFolderPrefetch(n))},s.prototype.searchMessagesInCurrentFolder=function(e){var t=this.folderList().currentFolderFullName()||"INBOX",i=this.currentMessage()?this.currentMessage().uid():"",s=this.uidList().filters();m.setHash(y.getMailbox(t,1,i,e,s))},s.prototype.searchMessagesInInbox=function(e){m.setHash(y.getMailbox(this.folderList().inboxFolderFullName()||"INBOX",1,"",e,""))},s.prototype.getFolderHash=function(e){return m.buildHashFromArray(y.getMailbox(e,1,"","",""))},s.prototype.countMessages=function(e){var t=[],i=function(e){o.each(e.subfolders(),function(e,s){e.subscribed()&&(t.push(e.unseenMessageCount()),e.subfolders().length&&e.subscribed()&&i(e))},this)};e.expanded()||e.bNamespace?e.subfoldersMessagesCount(0):(i(e),e.subfoldersMessagesCount(o.reduce(t,function(e,t){return e+t},0)))},s.prototype.changeDatesInMessages=function(){o.each(this.oFolderListItems,function(e){o.each(e.oNamedCollection,function(e){o.each(e.oMessages,function(e){e.updateMomentDate()},this)})})},s.prototype.clearMessagesCache=function(e){var t=this.oFolderListItems[e];o.each(t.collection(),function(e){e.markHasChanges(),e.removeAllMessageListsFromCacheIfHasChanges()},this),e===this.currentAccountId()&&this.messages([])};var L=new s;p.registerDayOfMonthFunction(o.bind(L.changeDatesInMessages,L)),g.timeFormat.subscribe(L.changeDatesInMessages,L),g.dateFormat.subscribe(L.changeDatesInMessages,L),e.exports=L},310:function(e,t,i){"use strict";var s=i(2),o=i(1),n=i(46),r=i(51),a=[],l=[],h=n.observable(r().date());window.setInterval(function(){s.each(a,function(e){e()}),h(r().date())},6e4),h.subscribe(function(){s.each(l,function(e){e()})},this),e.exports={registerEveryMinuteFunction:function(e){o.isFunction(e)&&a.push(e)},registerDayOfMonthFunction:function(e){o.isFunction(e)&&l.push(e)}}},311:function(e,t,i){"use strict";function s(e){return"p"===e.substr(0,1)&&/^[1-9][\d]*$/.test(e.substr(1))}function o(e){return"msg"===e.substr(0,3)&&/^[1-9][\d]*$/.test(e.substr(3))}var n=i(2),r=i(44),a=i(306),l={};l.getMailbox=function(e,t,s,o,n,l){var h=i(307),u=h.getCurrent(),c=[a.HashModuleName,u?u.hash():""];return t=r.pInt(t,1),s=r.pString(s),o=r.pString(o),n=r.pString(n),e&&""!==e&&c.push(e),n&&""!==n&&c.push("filter:"+n),1<t&&c.push("p"+t),s&&""!==s&&c.push("msg"+s),o&&""!==o&&c.push(o),l&&""!==l&&c.push("custom:"+l),c},l.parseMailbox=function(e){var t="",i="INBOX",n=1,a="",l="",h="",u="",c="",d=0;return r.isNonEmptyArray(e)&&(t=r.pString(e[d]),d++),r.isNonEmptyArray(e)&&(i=r.pString(e[d]),d++,e.length>d&&(c=r.pString(e[d]),c==="filter:"+Enums.FolderFilter.Flagged&&(h=Enums.FolderFilter.Flagged,d++),c==="filter:"+Enums.FolderFilter.Unseen&&(h=Enums.FolderFilter.Unseen,d++)),e.length>d&&(c=r.pString(e[d]),s(c)&&(n=r.pInt(c.substr(1)),n<=0&&(n=1),d++)),e.length>d&&(c=r.pString(e[d]),o(c)&&(a=c.substr(3),d++)),e.length>d&&(c=r.pString(e[d]),"custom:"!==c.substr(0,7)&&(l=c,d++)),e.length>d&&(c=r.pString(e[d]),"custom:"===c.substr(0,7)&&(u=c.substr(7)))),{AccountHash:t,Folder:i,Page:n,Uid:a,Search:l,Filters:h,Custom:u}},l.getViewMessage=function(e,t){var s=i(307),o=s.getCurrent(),n=o?o.hash():"";return[a.HashModuleName+"-view",n,e,"msg"+t]},l.getCompose=function(){var e=i(307),t=e.getCurrent(),s=t?t.hash():"";return[a.HashModuleName+"-compose",s]},l.getComposeFromMessage=function(e,t,s){var o=i(307),n=o.getCurrent(),r=n?n.hash():"";return[a.HashModuleName+"-compose",r,e,t,s]},l.getComposeWithToField=function(e){var t=i(307),s=t.getCurrent(),o=s?s.hash():"";return[a.HashModuleName+"-compose",o,"to",e]},l.getComposeWithObject=function(e,t){var s=i(307),o=s.getCurrent(),n=o?o.hash():"";return[a.HashModuleName+"-compose",n,e,t]},l.getComposeWithEmlObject=function(e,t,s){var o=i(307),n=o.getCurrent(),r=n?n.hash():"";return[a.HashModuleName+"-compose",r,Enums.ReplyType.ForwardAsAttach,e,t,s]},l.parseCompose=function(e){var t=e.length>0?e[0]:"",i=e.length>1?e[1]:"",s=("vcard"===i||i===Enums.ReplyType.ForwardAsAttach||"attachments"===i)&&e.length>2?i===Enums.ReplyType.ForwardAsAttach?e[4]:e[2]:null,o="to"===i&&e.length>2?l.parseToAddr(e[2]):null,n=(i===Enums.ReplyType.Reply||i===Enums.ReplyType.ReplyAll||i===Enums.ReplyType.Resend||i===Enums.ReplyType.Forward||"drafts"===i||i===Enums.ReplyType.ForwardAsAttach)&&e.length>2,r=n?e[2]:"",a=n?e[3]:"";return{AccountHash:t,RouteType:i,ToAddr:o,Object:s,MessageFolderName:r,MessageUid:a}},l.parseToAddr=function(e){var t=decodeURI(r.pString(e)),i=t.indexOf("mailto:")!==-1,s=[],o=[],a="",l="",h="",u="";return i&&(s=t.replace(/^mailto:/,"").split("?"),t=s[0],2===s.length&&(o=s[1].split("&"),n.each(o,function(e){var t=e.split("=");if(2===t.length)switch(t[0].toLowerCase()){case"subject":a=t[1];break;case"cc":l=t[1];break;case"bcc":h=t[1];break;case"body":u=t[1]}}))),{to:t,hasMailto:i,subject:a,cc:l,bcc:h,body:u}},e.exports=l},312:function(e,t,i){"use strict";function s(){this.iAccountId=0,this.initialized=n.observable(!1),this.bExpandFolders=!1,this.expandNames=n.observableArray([]),this.collection=n.observableArray([]),this.options=n.observableArray([]),this.sNamespaceFolder="",this.oStarredFolder=null,this.oNamedCollection={},this.aLinedCollection=[];var e=this,t=function(e){return function(t){t&&t.type(e)}},i=function(t){return{read:function(){return this.collection(),t()?t().fullName():""},write:function(e){t(this.getFolderByFullName(e))},owner:e}};this.currentFolder=n.observable(null),this.inboxFolder=n.observable(null),this.sentFolder=n.observable(null),this.draftsFolder=n.observable(null),this.spamFolder=n.observable(null),this.trashFolder=n.observable(null),this.countsCompletelyFilled=n.observable(!1),this.inboxFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.sentFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.draftsFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.spamFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.trashFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.inboxFolder.subscribe(t(Enums.FolderTypes.Inbox)),this.sentFolder.subscribe(t(Enums.FolderTypes.Sent)),this.draftsFolder.subscribe(t(Enums.FolderTypes.Drafts)),this.spamFolder.subscribe(t(Enums.FolderTypes.Spam)),this.trashFolder.subscribe(t(Enums.FolderTypes.Trash)),this.inboxFolderFullName=n.computed(i(this.inboxFolder)),this.sentFolderFullName=n.computed(i(this.sentFolder)),this.draftsFolderFullName=n.computed(i(this.draftsFolder)),this.spamFolderFullName=n.computed(i(this.spamFolder)),this.trashFolderFullName=n.computed(i(this.trashFolder)),this.currentFolderFullName=n.computed(i(this.currentFolder)),this.currentFolderType=n.computed(function(){return this.currentFolder()?this.currentFolder().type():Enums.FolderTypes.User},this),this.sDelimiter=""}var o=i(2),n=i(46),r=i(44),a=i(217),l=i(306),h=i(313);s.prototype.getTotalMessageCount=function(){var e=0;return o.each(this.oNamedCollection,function(t){e+=t.messageCount()},this),e},s.prototype.getFoldersWithoutCountInfo=function(){var e=o.compact(o.map(this.oNamedCollection,function(e,t){return e.bCanBeSelected&&!e.hasExtendedInfo()?t:null}));return e},s.prototype.setCurrentFolder=function(e,t){var i=this.getFolderByFullName(e);null===i&&(i=this.inboxFolder()),null!==i&&(this.currentFolder()&&(this.currentFolder().selected(!1),this.oStarredFolder&&this.oStarredFolder.selected(!1)),this.currentFolder(i),t===Enums.FolderFilter.Flagged?this.oStarredFolder&&this.oStarredFolder.selected(!0):this.currentFolder().selected(!0))},s.prototype.getFolderByFullName=function(e){var t=this.oNamedCollection[e];return t?t:null},s.prototype.renameFolder=function(e,t,i){var s=this.oNamedCollection[e];s.fullName(t),s.fullNameHash(i),this.oNamedCollection[t]=s,this.oNamedCollection[e]=void 0},s.prototype.parse=function(e,t,i){var s=r.pString(t.Namespace),o=t.Folders["@Collection"];s.length>0&&(this.sNamespaceFolder=s.substring(0,s.length-1)),this.iAccountId=e,this.initialized(!0),this.bExpandFolders=l.AllowExpandFolders&&!a.hasData("folderAccordion"),a.hasData("folderAccordion")||a.setData("folderAccordion",[]),this.oNamedCollection={},this.aLinedCollection=[],this.collection(this.parseRecursively(o,i))},s.prototype.parseRecursively=function(e,t,i,s){var n=[],l=0,u=0,c=null,d=null,p="",m=null,g=[];
if(s=s||"",void 0===i&&(i=-1),i++,o.isArray(e)){for(u=e.length;l<u;l++){switch(p=r.pString(e[l].FullNameRaw),d=t[p],c=new h(this.iAccountId),m=c.parse(e[l],s,this.sNamespaceFolder),d&&d.hasExtendedInfo()&&!c.hasExtendedInfo()&&c.setRelevantInformation(d.sUidNext,d.sHash,d.messageCount(),d.unseenMessageCount(),!1),this.bExpandFolders&&null!==m&&(c.expanded(!0),this.expandNames().push(r.pString(e[l].Name))),c.setLevel(i),c.type()){case Enums.FolderTypes.Inbox:this.inboxFolder(c),this.sDelimiter=c.sDelimiter;break;case Enums.FolderTypes.Sent:this.sentFolder(c);break;case Enums.FolderTypes.Drafts:this.draftsFolder(c);break;case Enums.FolderTypes.Trash:this.trashFolder(c);break;case Enums.FolderTypes.Spam:this.spamFolder(c)}this.oNamedCollection[c.fullName()]=c,this.aLinedCollection.push(c),n.push(c),null===m&&c.type()===Enums.FolderTypes.Inbox?(this.createStarredFolder(c.fullName(),i),this.oStarredFolder&&n.push(this.oStarredFolder)):null!==m&&(g=this.parseRecursively(m["@Collection"],t,i,c.fullName()),c.type()===Enums.FolderTypes.Inbox&&(c.bNamespace?(this.createStarredFolder(c.fullName(),i+1),this.oStarredFolder&&g.unshift(this.oStarredFolder)):(this.createStarredFolder(c.fullName(),i),this.oStarredFolder&&n.push(this.oStarredFolder))),c.subfolders(g))}this.bExpandFolders&&a.setData("folderAccordion",this.expandNames())}return n},s.prototype.createStarredFolder=function(e,t){this.oStarredFolder=new h(this.iAccountId),this.oStarredFolder.initStarredFolder(t,e)},s.prototype.repopulateLinedCollection=function(){function e(i){o.each(i,function(i){t.aLinedCollection.push(i),i.subfolders().length>0&&e(i.subfolders())})}var t=this;return this.aLinedCollection=[],e(this.collection()),this.aLinedCollection},s.prototype.getOptions=function(e,t,i,s,n){t=!!t,i=!!i,s=!!s,n=!!n;var r="    ",a=[];return o.each(this.aLinedCollection,function(e){if(e&&!e.bVirtual&&(!i||Enums.FolderTypes.Inbox!==e.type())&&(!n||e.subscribed())){var o=Array(e.iLevel+1).join(r);a.push({name:e.name(),fullName:e.fullName(),displayName:o+e.name(),translatedDisplayName:o+e.displayName(),disable:!t&&e.isSystem()||!s&&!e.bCanBeSelected})}}),""!==e&&a.unshift({name:e,fullName:"",displayName:e,translatedDisplayName:e,disable:!1}),a},e.exports=s},313:function(e,t,i){"use strict";function s(e){this.iAccountId=e,this.bNamespace=!1,this.iLevel=0,this.sDelimiter="",this.bExists=!0,this.sUidNext="",this.sHash="",this.messageCount=r.observable(0),this.unseenMessageCount=r.observable(0),this.sRealUnseenMessageCount=0,this.hasExtendedInfo=r.observable(!1),this.fullName=r.observable(""),this.fullNameHash=r.observable(""),this.bSelectable=!0,this.subscribed=r.observable(!0),this.name=r.observable(""),this.nameForEdit=r.observable(""),this.subfolders=r.observableArray([]),this.subfoldersMessagesCount=r.observable(0),this.type=r.observable(Enums.FolderTypes.User),this.bVirtual=!1,this.selected=r.observable(!1),this.expanded=r.observable(!1),this.recivedAnim=r.observable(!1).extend({autoResetToFalse:500}),this.edited=r.observable(!1),this.oMessages={},this.oUids={},this.aResponseHandlers=[],this.aRequestedUids=[],this.aRequestedThreadUids=[],this.requestedLists=[],this.hasChanges=r.observable(!1),this.relevantInformationLastMoment=null}var o=i(2),n=i(1),r=i(46),a=i(51),l=i(43),h=i(44),u=i(308),c=i(181),d=i(179),p=i(191),m=i(217),g=i(184),f=i(185),b=i(311),v=i(307),y=null,E=i(306),S=i(314),A=i(321);s.prototype.requireMailCache=function(){null===y&&(y=i(309))},s.prototype.setLevel=function(e){this.iLevel=e},s.prototype.getMessageByUid=function(e){return this.oMessages[e]},s.prototype.getFlaggedMessageUids=function(){var e=[];return o.each(this.oMessages,function(t){t.flagged()&&e.push(t.uid())}),e},s.prototype.setMessageUnflaggedByUid=function(e){var t=this.oMessages[e];t&&t.flagged(!1)},s.prototype.hideThreadMessages=function(e){o.each(e.threadUids(),function(e){var t=this.oMessages[e];t&&(t.deleted()||(t.threadShowAnimation(!1),t.threadHideAnimation(!0),setTimeout(function(){t.threadHideAnimation(!1)},1e3)))},this)},s.prototype.getThreadMessages=function(e){var t=[],i=[],s=[],n=0,r=null,a=50;return o.each(e.threadUids(),function(o){if(n<e.threadCountForLoad()){var l=this.oMessages[o];l?l.deleted()||(l.markAsThreadPart(a,e.uid()),t.push(l),s.push(l.uid()),n++,r=l):(i.push(o),s.push(o),n++)}else s.push(o)},this),e.threadLoading()||this.loadThreadMessages(i),e.changeThreadUids(s,t.length),r&&t.length<e.threadUids().length&&r.showNextLoadingLink(o.bind(e.increaseThreadCountForLoad,e)),this.addThreadUidsToUidLists(e.uid(),e.threadUids()),t},s.prototype.computeThreadData=function(e){var t=0,i=!1,s=[],r=[],a=e.oFrom.getFirstEmail();o.each(e.threadUids(),function(e){var o=this.oMessages[e],h="";o&&!o.deleted()&&(o.seen()||t++,o.flagged()&&(i=!0),h=o.oFrom.getFirstEmail(),h!==a&&-1===n.inArray(h,r)&&(r.push(h),h===v.getEmail()?s.push(l.i18n("MAILWEBCLIENT/LABEL_ME_SENDER")):s.push(o.oFrom.getFirstDisplay())))},this),e.threadUnreadCount(t),e.partialFlagged(i)},s.prototype.addThreadUidsToUidLists=function(e,t){o.each(this.oUids,function(i){o.each(i,function(i){i.addThreadUids(e,t)})})},s.prototype.loadThreadMessages=function(e){if(e.length>0){var t={Folder:this.fullName(),Uids:e};u.send("GetMessagesByUids",t,this.onGetMessagesByUidsResponse,this)}},s.prototype.getThreadCheckedUidsFromList=function(e){var t=this,i=[];return o.each(e,function(e){e.threadCount()>0&&!e.threadOpened()&&o.each(e.threadUids(),function(e){var s=t.oMessages[e];s&&!s.deleted()&&s.checked()&&i.push(e)})}),i},s.prototype.parseAndCacheMessage=function(e,t,i){var s=""+e.Uid,o=!this.oMessages[s],n=o?new S:this.oMessages[s];return n.parse(e,this.iAccountId,t,i),this.type()===Enums.FolderTypes.Inbox&&o&&n.flagged()&&(this.requireMailCache(),y.increaseStarredCount()),this.oMessages[n.uid()]=n,n},s.prototype.onGetMessagesByUidsResponse=function(e,t){var i=e.Result;i&&"Collection/MessageCollection"===i["@Object"]&&(o.each(i["@Collection"],function(e){this.parseAndCacheMessage(e,!0,!0)},this),this.requireMailCache(),y.showOpenedThreads(this.fullName()))},s.prototype.addRequestedUids=function(e){this.aRequestedUids=o.union(this.aRequestedUids,e)},s.prototype.hasUidBeenRequested=function(e){return o.indexOf(this.aRequestedUids,e)!==-1},s.prototype.addRequestedThreadUids=function(e){this.aRequestedThreadUids=o.union(this.aRequestedThreadUids,e)},s.prototype.hasThreadUidBeenRequested=function(e){return o.indexOf(this.aRequestedThreadUids,e)!==-1},s.prototype.hasListBeenRequested=function(e){var t=o.where(this.requestedLists,e),i=t.length>0;return i||this.requestedLists.push(e),i},s.prototype.markMessageReplied=function(e,t){var i=this.oMessages[e];if(i)switch(t){case Enums.ReplyType.Reply:case Enums.ReplyType.ReplyAll:i.answered(!0);break;case Enums.ReplyType.Forward:case Enums.ReplyType.ForwardAsAttach:i.forwarded(!0)}},s.prototype.removeAllMessages=function(){var e=null;this.oMessages={},this.oUids={},this.messageCount(0),this.unseenMessageCount(0),this.sRealUnseenMessageCount=0,e=this.getUidList("",""),e.resultCount(0)},s.prototype.removeAllMessageListsFromCacheIfHasChanges=function(){this.hasChanges()&&(this.oUids={},this.requestedLists=[],this.aRequestedThreadUids=[],this.hasChanges(!1))},s.prototype.removeFlaggedMessageListsFromCache=function(){o.each(this.oUids,function(e,t){delete this.oUids[t][Enums.FolderFilter.Flagged]},this)},s.prototype.removeUnseenMessageListsFromCache=function(){o.each(this.oUids,function(e,t){delete this.oUids[t][Enums.FolderFilter.Unseen]},this)},s.prototype.setRelevantInformation=function(e,t,i,s,o){var n=this.hasExtendedInfo()&&(this.sHash!==t||this.sRealUnseenMessageCount!==s);return o||(this.sUidNext=e),this.sHash=t,this.hasExtendedInfo()&&o||(this.messageCount(i),this.unseenMessageCount(s),0===s&&this.unseenMessageCount.valueHasMutated()),this.sRealUnseenMessageCount=s,this.hasExtendedInfo(!0),n&&this.markHasChanges(),this.relevantInformationLastMoment=a(),n},s.prototype.increaseCountIfHasNotInfo=function(){this.hasExtendedInfo()||this.messageCount(this.messageCount()+1)},s.prototype.markHasChanges=function(){this.hasChanges(!0)},s.prototype.addMessagesCountsDiff=function(e,t){var i=this.messageCount()+e,s=this.unseenMessageCount()+t;i<0&&(i=0),this.messageCount(i),s<0&&(s=0),s>i&&(s=i),this.unseenMessageCount(s)},s.prototype.markDeletedByUids=function(e){var t=0,i=0;return o.each(e,function(e){var s=this.oMessages[e];s&&(t++,s.seen()||i++,s.deleted(!0))},this),this.addMessagesCountsDiff(-t,-i),{MinusDiff:t,UnseenMinusDiff:i}},s.prototype.revertDeleted=function(e){var t=0,i=0;return o.each(e,function(e){var s=this.oMessages[e];s&&s.deleted()&&(t++,s.seen()||i++,s.deleted(!1))},this),this.addMessagesCountsDiff(t,i),{PlusDiff:t,UnseenPlusDiff:i}},s.prototype.commitDeleted=function(e){o.each(e,o.bind(function(e){delete this.oMessages[e]},this)),o.each(this.oUids,function(t){o.each(t,function(t){t.deleteUids(e)})})},s.prototype.getUidList=function(e,t){var i=null;return void 0===this.oUids[e]&&(this.oUids[e]={}),void 0===this.oUids[e][t]&&(i=new A,i.search(e),i.filters(t),this.oUids[e][t]=i),this.oUids[e][t]},s.prototype.initStarredFolder=function(e,t){this.bVirtual=!0,this.setLevel(e),this.fullName(t),this.name(l.i18n("MAILWEBCLIENT/LABEL_FOLDER_STARRED")),this.type(Enums.FolderTypes.Starred),this.initSubscriptions(""),this.initComputedFields(!0)},s.prototype.parse=function(e,t,i){var s="",n=Enums.FolderTypes.User,r=m.getData("folderAccordion")||[];return"Object/Folder"===e["@Object"]?(s=h.pString(e.Name),this.name(s),this.nameForEdit(s),this.fullName(h.pString(e.FullNameRaw)),this.fullNameHash(h.pString(e.FullNameHash)),this.sDelimiter=e.Delimiter,n=h.pInt(e.Type),(E.AllowSpamFolder||n!==Enums.FolderTypes.Spam)&&this.type(e.Type),this.bNamespace=i===this.fullName(),this.subscribed(e.IsSubscribed),this.bSelectable=e.IsSelectable,this.bExists=e.Exists,e.Extended&&this.setRelevantInformation(""+e.Extended.UidNext,e.Extended.Hash,e.Extended.MessageCount,e.Extended.MessageUnseenCount,!1),o.find(r,function(e){return e===this.name()},this)&&this.expanded(!0),this.initSubscriptions(t),this.initComputedFields(),e.SubFolders):null},s.prototype.initSubscriptions=function(e){this.requireMailCache(),this.unseenMessageCount.subscribe(function(){o.delay(o.bind(function(){y.countMessages(this)},this),1e3)},this),this.subscribed.subscribe(function(){if(e){var t=y.folderList().getFolderByFullName(e);t&&y.countMessages(t)}},this),this.edited.subscribe(function(e){e===!1&&this.nameForEdit(this.name())},this),this.hasChanges.subscribe(function(){this.requestedLists=[]},this)},s.prototype.initComputedFields=function(){this.routingHash=r.computed(function(){return this.bVirtual?p.buildHashFromArray(b.getMailbox(this.fullName(),1,"","",Enums.FolderFilter.Flagged)):p.buildHashFromArray(b.getMailbox(this.fullName()))},this),this.isSystem=r.computed(function(){return this.type()!==Enums.FolderTypes.User},this),this.showUnseenMessages=r.computed(function(){return this.type()!==Enums.FolderTypes.Drafts},this),this.withoutThreads=r.computed(function(){return this.type()===Enums.FolderTypes.Drafts||this.type()===Enums.FolderTypes.Spam||this.type()===Enums.FolderTypes.Trash},this),this.enableEmptyFolder=r.computed(function(){return(this.type()===Enums.FolderTypes.Spam||this.type()===Enums.FolderTypes.Trash)&&this.messageCount()>0},this),this.virtualEmpty=r.computed(function(){return this.bVirtual&&0===this.messageCount()},this),this.hasSubscribedSubfolders=r.computed(function(){return o.any(this.subfolders(),function(e){return e.subscribed()})},this),this.canExpand=r.computed(function(){return!this.bNamespace&&this.hasSubscribedSubfolders()},this),this.messageCountToShow=r.computed(function(){return!d.isMobile()&&this.canExpand()?this.showUnseenMessages()?this.unseenMessageCount()+this.subfoldersMessagesCount():this.messageCount():this.showUnseenMessages()?this.unseenMessageCount():this.messageCount()},this),this.visible=r.computed(function(){return this.subscribed()||this.isSystem()||this.hasSubscribedSubfolders()&&(!this.bExists||!this.bSelectable)},this),this.bCanBeSelected=this.bExists&&this.bSelectable,this.canSubscribe=r.computed(function(){return!this.isSystem()&&this.bCanBeSelected},this),this.canDelete=r.computed(function(){return!this.isSystem()&&this.hasExtendedInfo()&&0===this.messageCount()&&0===this.subfolders().length},this),this.canRename=r.computed(function(){return this.bCanBeSelected&&!this.isSystem()},this),this.subscribeButtonHint=r.computed(function(){return this.canSubscribe()?this.subscribed()?l.i18n("MAILWEBCLIENT/ACTION_HIDE_FOLDER"):l.i18n("MAILWEBCLIENT/ACTION_SHOW_FOLDER"):""},this),this.deleteButtonHint=r.computed(function(){return this.canDelete()?l.i18n("MAILWEBCLIENT/ACTION_DELETE_FOLDER"):""},this),this.usedAs=r.computed(function(){switch(this.type()){case Enums.FolderTypes.Inbox:return l.i18n("MAILWEBCLIENT/LABEL_USED_AS_INBOX");case Enums.FolderTypes.Sent:return l.i18n("MAILWEBCLIENT/LABEL_USED_AS_SENT");case Enums.FolderTypes.Drafts:return l.i18n("MAILWEBCLIENT/LABEL_USED_AS_DRAFTS");case Enums.FolderTypes.Trash:return l.i18n("MAILWEBCLIENT/LABEL_USED_AS_TRASH");case Enums.FolderTypes.Spam:return l.i18n("MAILWEBCLIENT/LABEL_USED_AS_SPAM")}return""},this),this.displayName=r.computed(function(){switch(this.type()){case Enums.FolderTypes.Inbox:return l.i18n("MAILWEBCLIENT/LABEL_FOLDER_INBOX");case Enums.FolderTypes.Sent:return l.i18n("MAILWEBCLIENT/LABEL_FOLDER_SENT");case Enums.FolderTypes.Drafts:return l.i18n("MAILWEBCLIENT/LABEL_FOLDER_DRAFTS");case Enums.FolderTypes.Trash:return l.i18n("MAILWEBCLIENT/LABEL_FOLDER_TRASH");case Enums.FolderTypes.Spam:return l.i18n("MAILWEBCLIENT/LABEL_FOLDER_SPAM")}return this.name()},this),this.unseenMessagesTitle=r.computed(function(){return this.showUnseenMessages()?l.i18n("MAILWEBCLIENT/ACTION_SHOW_UNREAD_MESSAGES"):""},this)},s.prototype.onGetMessageResponse=function(e,t){var i=e.Result,s=t.Parameters,o=null,n=i?""+i.Uid:""+s.Uid,r=this.oMessages[n],a=!!r&&r.selected();i?r=this.parseAndCacheMessage(i,!1,!1):(a&&(c.showErrorByCode(e,l.i18n("COREWEBCLIENT/ERROR_UNKNOWN")),p.replaceHashWithoutMessageUid(n)),r=null),o=this.aResponseHandlers[n],o&&(o.handler.call(o.context,r,n),delete this.aResponseHandlers[n])},s.prototype.getCompletelyFilledMessage=function(e,t,i){var s=this.oMessages[e],o={AccountID:s?s.accountId():0,Folder:this.fullName(),Uid:e};e.length>0&&(s&&s.completelyFilled()&&!s.trimmed()?t&&i&&t.call(i,s,e):(t&&i&&(this.aResponseHandlers[e]={handler:t,context:i}),u.send("GetMessage",o,this.onGetMessageResponse,this)))},s.prototype.showExternalPictures=function(e){var t=this.oMessages[e];void 0!==t&&t.showExternalPictures()},s.prototype.alwaysShowExternalPicturesForSender=function(e){o.each(this.oMessages,function(t){var i=t.oFrom.aCollection;i.length>0&&i[0].sEmail===e&&t.alwaysShowExternalPicturesForSender()},this)},s.prototype.executeGroupOperation=function(e,t,i){var s=0;o.each(this.oMessages,function(n){t.length>0?o.each(t,function(t){n&&n.uid()===t&&n[e]()!==i&&(n[e](i),s++)}):n[e](i)}),0===t.length&&(s=i?this.unseenMessageCount():this.messageCount()-this.unseenMessageCount()),"seen"===e&&s>0&&(i?this.addMessagesCountsDiff(0,-s):this.addMessagesCountsDiff(0,s),this.markHasChanges())},s.prototype.emptyFolder=function(){var e=l.i18n("MAILWEBCLIENT/CONFIRM_EMPTY_FOLDER"),t=o.bind(this.clearFolder,this);this.enableEmptyFolder()&&g.showPopup(f,[e,t])},s.prototype.clearFolder=function(e){this.enableEmptyFolder()&&e&&(u.send("ClearFolder",{Folder:this.fullName()}),this.removeAllMessages(),this.requireMailCache(),y.onClearFolder(this))},s.prototype.onAccordion=function(e,t){var i=!this.expanded(),s=m.getData("folderAccordion")||[];i?s.push(this.name()):s=o.reject(s,function(e){return e===this.name()},this),m.setData("folderAccordion",s),this.expanded(i),this.requireMailCache(),y.countMessages(this),t&&t.stopPropagation()},s.prototype.executeUnseenFilter=function(){var e=!1;return this.messageCountToShow()>this.unseenMessageCount()&&this.onAccordion(),!(this.showUnseenMessages()&&this.unseenMessageCount()>0)||(this.requireMailCache(),y.waitForUnseenMessages(!0),e=p.setHash(b.getMailbox(this.fullName(),1,"","",Enums.FolderFilter.Unseen)),e&&y.changeCurrentMessageList(this.fullName(),1,"",Enums.FolderFilter.Unseen),!1)},s.prototype.onDeleteClick=function(){var e=l.i18n("MAILWEBCLIENT/CONFIRM_DELETE_FOLDER"),t=o.bind(this.deleteAfterConfirm,this);this.canDelete()?g.showPopup(f,[e,t]):d.broadcastEvent("MailWebclient::AttemptDeleteNonemptyFolder")},s.prototype.deleteAfterConfirm=function(e){if(e){var t=y.editedFolderList(),i=this.fullName(),s=function(e){return i===e.fullName()||(e.subfolders.remove(s),!1)};t.collection.remove(s),u.send("DeleteFolder",{AccountID:v.editedId(),Folder:this.fullName()},function(e){e.Result||(c.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_DELETE_FOLDER")),y.getFolderList(v.editedId()))},this)}},s.prototype.onSubscribeClick=function(){if(this.canSubscribe()){var e={AccountID:v.editedId(),Folder:this.fullName(),SetAction:!this.subscribed()};this.subscribed(!this.subscribed()),u.send("SubscribeFolder",e,function(e){e.Result||(this.subscribed()?c.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_SUBSCRIBE_FOLDER")):c.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_UNSUBSCRIBE_FOLDER")),y.getFolderList(v.editedId()))},this)}},s.prototype.afterMove=function(e){o.each(e,function(e){"CAccountFoldersPaneView"===e.constructor.name&&e.afterMove()})},s.prototype.cancelNameEdit=function(){this.edited(!1)},s.prototype.applyNameEdit=function(){if(this.name()!==this.nameForEdit()){var e={AccountID:v.editedId(),PrevFolderFullNameRaw:this.fullName(),NewFolderNameInUtf8:this.nameForEdit()};u.send("RenameFolder",e,o.bind(this.onResponseFolderRename,this),this),this.name(this.nameForEdit())}this.edited(!1)},s.prototype.onResponseFolderRename=function(e,t){if(e&&e.Result){if(e&&e.Result&&e.Result.FullName){var i=y.editedFolderList();i.renameFolder(this.fullName(),e.Result.FullName,e.Result.FullNameHash)}}else c.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_RENAME_FOLDER")),y.getFolderList(v.editedId())},e.exports=s},314:function(e,t,i){"use strict";function s(){this.accountId=r.observable(g.currentId()),this.folder=r.observable(""),this.uid=r.observable(""),this.sUniq="",this.subject=r.observable(""),this.emptySubject=r.computed(function(){return""===n.trim(this.subject())},this),this.subjectForDisplay=r.computed(function(){return this.emptySubject()?l.i18n("MAILWEBCLIENT/LABEL_NO_SUBJECT"):this.subject()},this),this.messageId=r.observable(""),this.size=r.observable(0),this.friendlySize=r.computed(function(){return l.getFriendlySize(this.size())},this),this.textSize=r.observable(0),this.oDateModel=new p,this.fullDate=r.observable(""),this.oFrom=new d,this.fullFrom=r.observable(""),this.oTo=new d,this.to=r.observable(""),this.fromOrToText=r.observable(""),this.oCc=new d,this.cc=r.observable(""),this.oBcc=new d,this.bcc=r.observable(""),this.oReplyTo=new d,this.seen=r.observable(!1),this.flagged=r.observable(!1),this.partialFlagged=r.observable(!1),this.answered=r.observable(!1),this.forwarded=r.observable(!1),this.hasAttachments=r.observable(!1),this.hasIcalAttachment=r.observable(!1),this.hasVcardAttachment=r.observable(!1),this.folderObject=r.computed(function(){return this.requireMailCache(),f.getFolderByFullName(this.accountId(),this.folder())},this),this.threadsAllowed=r.computed(function(){var e=g.getAccount(this.accountId()),t=this.folderObject(),i=t&&(t.type()===Enums.FolderTypes.Drafts||t.type()===Enums.FolderTypes.Spam||t.type()===Enums.FolderTypes.Trash);return e&&e.threadingIsAvailable()&&!i},this),this.otherSendersAllowed=r.computed(function(){var e=this.folderObject();return e&&e.type()!==Enums.FolderTypes.Drafts&&e.type()!==Enums.FolderTypes.Sent},this),this.threadPart=r.observable(!1),this.threadPart.subscribe(function(){this.threadPart()&&this.partialFlagged(!1)},this),this.threadParentUid=r.observable(""),this.threadUids=r.observableArray([]),this.threadCount=r.computed(function(){return this.threadUids().length},this),this.threadUnreadCount=r.observable(0),this.threadOpened=r.observable(!1),this.threadLoading=r.observable(!1),this.threadLoadingVisible=r.computed(function(){return this.threadsAllowed()&&this.threadOpened()&&this.threadLoading()},this),this.threadCountVisible=r.computed(function(){return this.threadsAllowed()&&this.threadCount()>0&&!this.threadLoading()},this),this.threadCountHint=r.computed(function(){return this.threadCount()>0?this.threadOpened()?l.i18n("MAILWEBCLIENT/ACTION_FOLD_THREAD"):this.threadUnreadCount()>0?l.i18n("MAILWEBCLIENT/ACTION_UNFOLD_THREAD_WITH_UNREAD",{},null,this.threadUnreadCount()):l.i18n("MAILWEBCLIENT/ACTION_UNFOLD_THREAD"):""},this),this.threadCountForLoad=r.observable(5),this.threadNextLoadingVisible=r.observable(!1),this.threadNextLoadingLinkVisible=r.observable(!1),this.threadFunctionLoadNext=null,this.threadShowAnimation=r.observable(!1),this.threadHideAnimation=r.observable(!1),this.importance=r.observable(Enums.Importance.Normal),this.draftInfo=r.observableArray([]),this.hash=r.observable(""),this.sDownloadAsEmlUrl="",this.completelyFilled=r.observable(!1),this.checked=r.observable(!1),this.checked.subscribe(function(e){if(this.requireMailCache(),!this.threadOpened()&&f.useThreadingInCurrentList()){var t=f.folderList().getFolderByFullName(this.folder());o.each(this.threadUids(),function(i){var s=t.oMessages[i];s&&s.checked(e)})}},this),this.selected=r.observable(!1),this.deleted=r.observable(!1),this.trimmed=r.observable(!1),this.trimmedTextSize=r.observable(0),this.inReplyTo=r.observable(""),this.references=r.observable(""),this.readingConfirmationAddressee=r.observable(""),this.sensitivity=r.observable(Enums.Sensitivity.Nothing),this.isPlain=r.observable(!1),this.text=r.observable(""),this.textBodyForNewWindow=r.observable(""),this.$text=null,this.rtl=r.observable(!1),this.hasExternals=r.observable(!1),this.isExternalsShown=r.observable(!1),this.isExternalsAlwaysShown=r.observable(!1),this.foundCids=r.observableArray([]),this.attachments=r.observableArray([]),this.usesAttachmentString=!1,this.safety=r.observable(!1),this.sourceHeaders=r.observable(""),this.date=r.observable(""),this.textRaw=r.observable(""),this.domMessageForPrint=r.observable(null),this.Custom={}}var o=i(2),n=i(1),r=i(46),a=i(51),l=(i(315),i(43)),h=i(44),u=i(177),c=(i(308),i(183)),d=i(316),p=i(258),m=i(318),g=i(307),f=null,b=(i(306),i(319));s.prototype.requireMailCache=function(){null===f&&(f=i(309))},s.prototype.viewMessage=function(e){var t=this.getDomText(u.getAppPath()),i="";this.textBodyForNewWindow(t.html()),i=n(this.domMessageForPrint()).html(),e&&(n(e.document.body).html(i),e.focus(),o.each(this.attachments(),function(t){var i=n(e.document.body).find("[data-hash='download-"+t.hash()+"']");t.hasAction("download")?i.on("click",o.bind(t.executeAction,t,"download")):i.hide(),i=n(e.document.body).find("[data-hash='view-"+t.hash()+"']"),t.hasAction("view")?i.on("click",o.bind(t.executeAction,t,"view")):i.hide()},this))},s.prototype.fillFromOrToText=function(){this.requireMailCache();var e=f.getFolderByFullName(this.accountId(),this.folder()),t=g.getAccount(this.accountId());e.type()===Enums.FolderTypes.Drafts||e.type()===Enums.FolderTypes.Sent?this.fromOrToText(this.oTo.getDisplay(l.i18n("MAILWEBCLIENT/LABEL_ME_RECIPIENT"),t.email())):this.fromOrToText(this.oFrom.getDisplay(l.i18n("MAILWEBCLIENT/LABEL_ME_SENDER"),t.email()))},s.prototype.changeThreadUids=function(e,t){this.threadUids(e),this.threadLoading(t<Math.min(this.threadUids().length,this.threadCountForLoad()))},s.prototype.showNextLoadingLink=function(e){this.threadNextLoadingLinkVisible()&&(this.threadNextLoadingVisible(!0),this.threadFunctionLoadNext=e)},s.prototype.increaseThreadCountForLoad=function(){this.threadCountForLoad(this.threadCountForLoad()+5),this.requireMailCache(),f.showOpenedThreads(this.folder())},s.prototype.loadNextMessages=function(){this.threadFunctionLoadNext&&(this.threadFunctionLoadNext(),this.threadNextLoadingLinkVisible(!1),this.threadFunctionLoadNext=null)},s.prototype.markAsThreadPart=function(e,t){var i=this;this.threadPart(!0),this.threadParentUid(t),this.threadUids([]),this.threadNextLoadingVisible(!1),this.threadNextLoadingLinkVisible(!0),this.threadFunctionLoadNext=null,this.threadHideAnimation(!1),setTimeout(function(){i.threadShowAnimation(!0)},e)},s.prototype.parse=function(e,t,i,s){var n="",r="";s&&this.threadPart(i),this.threadPart()||this.threadParentUid(""),"Object/MessageListItem"===e["@Object"]&&(this.seen(!!e.IsSeen),this.flagged(!!e.IsFlagged),this.answered(!!e.IsAnswered),this.forwarded(!!e.IsForwarded),e.Custom&&(this.Custom=e.Custom)),"Object/Message"!==e["@Object"]&&"Object/MessageListItem"!==e["@Object"]||(this.Custom.Sensitivity=e.Sensitivity,this.accountId(t),this.folder(e.Folder),this.uid(h.pString(e.Uid)),this.sUniq=this.accountId()+this.folder()+this.uid(),this.subject(h.pString(e.Subject)),this.messageId(h.pString(e.MessageId)),this.size(e.Size),this.textSize(e.TextSize),this.oDateModel.parse(e.TimeStampInUTC),this.oFrom.parse(e.From),this.oTo.parse(e.To),this.fillFromOrToText(),this.oCc.parse(e.Cc),this.oBcc.parse(e.Bcc),this.oReplyTo.parse(e.ReplyTo),this.fullDate(this.oDateModel.getFullDate()),this.fullFrom(this.oFrom.getFull()),this.to(this.oTo.getFull()),this.cc(this.oCc.getFull()),this.bcc(this.oBcc.getFull()),this.hasAttachments(!!e.HasAttachments),this.hasIcalAttachment(!!e.HasIcalAttachment),this.hasVcardAttachment(!!e.HasVcardAttachment),"Object/MessageListItem"===e["@Object"]&&s&&this.threadUids(o.map(e.Threads,function(e){return""+e},this)),this.importance(h.pInt(e.Importance)),Enums.has("Importance",this.importance())||this.importance(Enums.Importance.Normal),this.sensitivity(h.pInt(e.Sensitivity)),Enums.has("Sensitivity",this.sensitivity())||this.sensitivity(Enums.Sensitivity.Nothing),o.isArray(e.DraftInfo)&&this.draftInfo(e.DraftInfo),this.hash(h.pString(e.Hash)),this.sDownloadAsEmlUrl=h.pString(e.DownloadAsEmlUrl),"Object/Message"===e["@Object"]&&(this.trimmed(e.Trimmed),this.trimmedTextSize(e.TrimmedTextSize),this.inReplyTo(e.InReplyTo),this.references(e.References),this.readingConfirmationAddressee(h.pString(e.ReadingConfirmationAddressee)),n=h.pString(e.Html),r=h.pString(e.Plain),""!==n?(this.textRaw(e.HtmlRaw),this.text(n),this.isPlain(!1)):(this.textRaw(e.PlainRaw),this.text(""!==r?"<div>"+r+"</div>":""),this.isPlain(!0)),this.$text=null,this.isExternalsShown(!1),this.rtl(e.Rtl),this.hasExternals(!!e.HasExternals),this.foundCids(e.FoundedCIDs),this.parseAttachments(e.Attachments,t),this.safety(e.Safety),this.sourceHeaders(e.Headers),this.aExtend=e.Extend,this.completelyFilled(!0)),this.updateMomentDate())},s.prototype.updateMomentDate=function(){this.date(this.oDateModel.getShortDate(a().clone().subtract(1,"days").format("L")===a.unix(this.oDateModel.getTimeStampInUTC()).format("L")))},s.prototype.getDomText=function(e,t){var i=this.$text;return e=e||"",null!==this.$text&&""===e||(this.completelyFilled()?(this.$text=n(this.text()),this.showInlinePictures(e),this.safety()===!0&&this.alwaysShowExternalPicturesForSender(),t&&this.isExternalsShown()&&this.showExternalPictures(),i=this.$text):i=n("")),i.clone()},s.prototype.getConvertedHtml=function(e,t){var i=this.getDomText(e,t);return i.length>0?i.wrap("<p>").parent().html():""},s.prototype.parseAttachments=function(e,t){var i=e?e["@Collection"]:[];this.attachments([]),h.isNonEmptyArray(i)&&this.attachments(o.map(i,function(e){var t=new b;return t.setMessageData(this.folder(),this.uid()),t.parse(e,this.folder(),this.uid()),t},this))},s.prototype.parseAddressArray=function(e){var t=[];return o.isArray(e)&&(t=o.map(e,function(e){var t=new CAddressModel;return t.parse(e),t})),t},s.prototype.showInlinePictures=function(e){var t=o.map(this.attachments(),function(e){return{CID:e.cid(),ContentLocation:e.contentLocation(),ViewLink:e.getActionUrl("view")}});m.showInlinePictures(this.$text,t,this.foundCids(),e)},s.prototype.showExternalPictures=function(){m.showExternalPictures(this.$text),this.isExternalsShown(!0)},s.prototype.alwaysShowExternalPicturesForSender=function(){this.completelyFilled()&&(this.isExternalsAlwaysShown(!0),this.isExternalsShown()||this.showExternalPictures())},s.prototype.openThread=function(){if(this.threadCountVisible()){var e=this.folder();this.threadOpened(!this.threadOpened()),this.requireMailCache(),this.threadOpened()?f.showOpenedThreads(e):(f.hideThreads(this),setTimeout(function(){f.showOpenedThreads(e)},500))}},s.prototype.getAttachmentsHashes=function(){var e=o.filter(this.attachments(),function(e){return!e.linked()}),t=o.map(e,function(e){return e.hash()});return t},s.prototype.onSaveAttachmentsToFilesResponse=function(e,t){var i=t.Parameters,s=0,n=i.Attachments.length;e.Result&&o.each(i.Attachments,function(t){void 0!==e.Result[t]&&s++}),0===s?c.showError(l.i18n("MAILWEBCLIENT/ERROR_CANT_SAVE_ATTACHMENTS_TO_FILES")):s<n?c.showError(l.i18n("MAILWEBCLIENT/ERROR_SOME_ATTACHMENTS_WERE_NOT_SAVED",{SAVED_COUNT:s,TOTAL_COUNT:n})):c.showReport(l.i18n("MAILWEBCLIENT/REPORT_ATTACHMENTS_SAVED_TO_FILES"))},s.prototype.downloadAllAttachmentsSeparately=function(){o.each(this.attachments(),function(e){e.linked()||e.executeAction("download")})},s.prototype.toJSON=function(){return{uid:this.uid(),accountId:this.accountId(),to:this.to(),subject:this.subject(),threadPart:this.threadPart(),threadUids:this.threadUids(),threadOpened:this.threadOpened()}},e.exports=s},315:function(e,t,i){"use strict";var s=i(43),o=i(184),n=i(190),r=i(45),a={};a.getDownloadLink=function(e,t,i){return t.length>0?"?/Download/"+e+"/DownloadFile/"+t+"/"+(i?"0/"+i:""):""},a.getIframeWrappwer=function(e,t){return"?/Raw/Iframe/"+e+"/"+window.encodeURIComponent(t)+"/"},a.thumbQueue=function(){var e={},t={},i=2;return function(s,o,n){o&&n?!(s in t)||t[s]>0?(s in t||(t[s]=i,e[s]=[]),t[s]--,n(o)):e[s].push({imageSrc:o,imageSrcObserver:n,messageUid:s}):e[s]&&e[s].length&&(e[s][0].imageSrcObserver(e[s][0].imageSrc),e[s].shift())}}(),a.showErrorIfAttachmentSizeLimit=function(e,t){var i=s.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE_DETAILED",{FILENAME:e,MAXSIZE:s.getFriendlySize(r.AttachmentSizeLimit)});return r.AttachmentSizeLimit>0&&t>r.AttachmentSizeLimit&&(o.showPopup(n,[i]),!0)},e.exports=a},316:function(e,t,i){"use strict";function s(){this.aCollection=[]}var o=i(2),n=i(317);s.prototype.parse=function(e){var t=e?e["@Collection"]:[];this.aCollection=[],o.isArray(t)&&(this.aCollection=o.map(t,function(e){var t=new n;return t.parse(e),t}))},s.prototype.addCollection=function(e){o.each(e,function(e){var t=o.find(this.aCollection,function(t){return e.sEmail===t.sEmail});t||this.aCollection.push(e)},this)},s.prototype.excludeCollection=function(e){o.each(e,function(e){this.aCollection=o.filter(this.aCollection,function(t){return e.sEmail!==t.sEmail})},this)},s.prototype.getFirstEmail=function(){return this.aCollection.length>0?this.aCollection[0].getEmail():""},s.prototype.getFirstName=function(){return this.aCollection.length>0?this.aCollection[0].getName():""},s.prototype.getFirstDisplay=function(){return this.aCollection.length>0?this.aCollection[0].getDisplay():""},s.prototype.getDisplay=function(e,t){var i=o.map(this.aCollection,function(i){return e&&t===i.sEmail?e:i.getDisplay(e)});return i.join(", ")},s.prototype.getFull=function(){var e=o.map(this.aCollection,function(e){return e.getFull()});return e.join(", ")},s.prototype.getEmails=function(){var e=o.map(this.aCollection,function(e){return e.getEmail()});return e},e.exports=s},317:function(e,t,i){"use strict";function s(){this.sName="",this.sEmail="",this.sDisplay="",this.sFull="",this.loaded=o.observable(!1),this.found=o.observable(!1)}var o=i(46),n=i(201),r=i(44);s.prototype.parse=function(e){null!==e&&(this.sName=r.pString(e.DisplayName),this.sEmail=r.pString(e.Email),this.sDisplay=this.sName.length>0?this.sName:this.sEmail,this.sFull=n.getFullEmail(this.sName,this.sEmail));
},s.prototype.getEmail=function(){return this.sEmail},s.prototype.getName=function(){return this.sName},s.prototype.getDisplay=function(){return this.sDisplay},s.prototype.getFull=function(){return this.sFull},e.exports=s},318:function(e,t,i){"use strict";var s=i(2),o=i(1),n=i(44),r={};r.showInlinePictures=function(e,t,i,n){var r=function(e){return s.find(t,function(t){return t.CID===e})},a=function(e){return s.find(t,function(t){return t.ContentLocation===e})};"string"!=typeof n&&(n=""),i.length>0&&(o("[data-x-src-cid]",e).each(function(){var e=o(this).attr("data-x-src-cid"),t=r(e);t&&t.ViewLink.length>0&&o(this).attr("src",n+t.ViewLink)}),o("[data-x-style-cid]",e).each(function(){var e="",t=o(this).attr("data-x-style-cid-name"),i=o(this).attr("data-x-style-cid"),s=r(i);s&&s.ViewLink.length>0&&""!==t&&(e=o.trim(o(this).attr("style")),e=""===e?"":";"===e.substr(-1)?e+" ":e+"; ",o(this).attr("style",e+t+": url('"+s.ViewLink+"')"))})),o("[data-x-src-location]",e).each(function(){var e=o(this).attr("data-x-src-location"),t=a(e);t||(t=r(e)),t&&t.ViewLink.length>0&&o(this).attr("src",n+t.ViewLink)})},r.showExternalPictures=function(e){o("[data-x-src]",e).each(function(){o(this).attr("src",o(this).attr("data-x-src")).removeAttr("data-x-src")}),o("[data-x-style-url]",e).each(function(){var e=o.trim(o(this).attr("style"));e=""===e?"":";"===e.substr(-1)?e+" ":e+"; ",o(this).attr("style",e+o(this).attr("data-x-style-url")).removeAttr("data-x-style-url")})},r.joinReplyPrefixesInSubject=function(e,t,i){var r=[t.toUpperCase()],a=[i.toUpperCase()],l=s.union(r,a).join("|"),h="",u=e.split(":"),c=[],d="";return s.each(u,function(e){if(0===d.length){var h=o.trim(e.toUpperCase()),u=s.indexOf(r,h)!==-1,p=s.indexOf(a,h)!==-1,m=1,g=c.length>0?c[c.length-1]:null;if(!u&&!p){var f=new window.RegExp("^\\s?("+l+")\\s?[\\[\\(]([\\d]+)[\\]\\)]$","gi").exec(h);f&&3===f.length&&(u=s.indexOf(r,f[1].toUpperCase())!==-1,p=s.indexOf(a,f[1].toUpperCase())!==-1,m=n.pInt(f[2]))}u?g&&g.prefix===t?g.count+=m:c.push({prefix:t,count:m}):p?g&&g.prefix===i?g.count+=m:c.push({prefix:i,count:m}):d=e}else d+=":"+e}),s.each(c,function(e){h+=1===e.count?e.prefix+": ":e.prefix+"["+e.count+"]: "}),h+=o.trim(d)},e.exports=r},319:function(e,t,i){"use strict";function s(){this.folderName=r.observable(""),this.messageUid=r.observable(""),this.cid=r.observable(""),this.contentLocation=r.observable(""),this.inline=r.observable(!1),this.linked=r.observable(!1),this.mimePartIndex=r.observable(""),this.messagePart=r.observable(null),c.call(this),this.isMessageType=r.computed(function(){return this.mimeType(),this.mimePartIndex(),"message/rfc822"===this.mimeType()},this)}var o=i(2),n=i(1),r=i(46),a=i(43),l=i(44),h=(i(177),i(179)),u=i(196),c=i(320),d=i(308);o.extendOwn(s.prototype,c.prototype),s.prototype.getNewInstance=function(){return new s},s.prototype.getCopy=function(){var e=new s;return e.copyProperties(this),e},s.prototype.copyProperties=function(e){this.fileName(e.fileName()),this.tempName(e.tempName()),this.size(e.size()),this.hash(e.hash()),this.mimeType(e.mimeType()),this.cid(e.cid()),this.contentLocation(e.contentLocation()),this.inline(e.inline()),this.linked(e.linked()),this.thumbnailSrc(e.thumbnailSrc()),this.thumbnailLoaded(e.thumbnailLoaded()),this.statusText(e.statusText()),this.uploaded(e.uploaded()),this.oActionsData=e.oActionsData,this.actions(e.actions()),this.thumbUrlInQueue(e.thumbUrlInQueue())},s.prototype.additionalParse=function(e){this.mimePartIndex(l.pString(e.MimePartIndex)),this.cid(l.pString(e.CID)),this.contentLocation(l.pString(e.ContentLocation)),this.inline(!!e.IsInline),this.linked(!!e.IsLinked)},s.prototype.setMessageData=function(e,t){this.folderName(e),this.messageUid(t)},s.prototype.onGetMessageResponse=function(e,t){var s=t.Parameters,e=e.Result,o=i(314),n=new o;e&&this.oNewWindow&&(n.parse(e,s.AccountID,!1,!0),this.messagePart(n),this.messagePart().viewMessage(this.oNewWindow),this.oNewWindow=void 0)},s.prototype.viewFile=function(){this.isMessageType()?this.viewMessageFile():this.viewCommonFile()},s.prototype.viewMessageFile=function(){var e=null,t='<div style="margin: 30px; text-align: center; font: normal 14px Tahoma;">'+a.i18n("COREWEBCLIENT/INFO_LOADING")+"</div>";e=u.open("",this.fileName()),e&&(this.messagePart()?this.messagePart().viewMessage(e):(n(e.document.body).html(t),this.oNewWindow=e,d.send("GetMessage",{Folder:this.folderName(),Uid:this.messageUid(),Rfc822MimeIndex:this.mimePartIndex()},this.onGetMessageResponse,this)),e.focus())},s.prototype.fillDataAfterUploadComplete=function(e,t){this.cid(l.pString(t)),e&&e.Result&&e.Result.Attachment&&(this.tempName(l.pString(e.Result.Attachment.TempName)),this.mimeType(l.pString(e.Result.Attachment.MimeType)),this.size(l.pInt(e.Result.Attachment.Size)),this.hash(l.pString(e.Result.Attachment.Hash)),this.parseActions(e.Result.Attachment))},s.prototype.parseFromUpload=function(e,t,i){this.setMessageData(t,i),this.fileName(l.pString(e.Name)),this.tempName(e.TempName?l.pString(e.TempName):this.fileName()),this.mimeType(l.pString(e.MimeType)),this.size(l.pInt(e.Size)),this.hash(l.pString(e.Hash)),this.parseActions(e),this.uploadUid(this.hash()),this.uploaded(!0),this.uploadStarted(!1)},s.prototype.parseActions=function(e){this.commonParseActions(e),this.isMessageType()&&(""!==this.folderName()&&""!==this.messageUid()?(this.hasAction("view")||this.actions.unshift("view"),this.otherTemplates.push({name:"MailWebclient_PrintMessageView",data:this.messagePart})):this.actions(o.without(this.actions(),"view"))),h.broadcastEvent("MailWebclient::ParseFile::after",this)},s.prototype.errorFromUpload=function(){this.uploaded(!0),this.uploadError(!0),this.uploadStarted(!1),this.statusText(a.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN"))},e.exports=s},320:function(e,t,i){"use strict";function s(){this.id=r.observable(""),this.index=r.observable(0),this.fileName=r.observable(""),this.tempName=r.observable(""),this.displayName=r.observable(""),this.extension=r.observable(""),this.fileName.subscribe(function(e){this.id(e),this.displayName(e),this.extension(d.getFileExtension(e))},this),this.size=r.observable(0),this.friendlySize=r.computed(function(){return this.size()>0?h.getFriendlySize(this.size()):""},this),this.hash=r.observable(""),this.thumbUrlInQueue=r.observable(""),this.thumbUrlInQueueSubscribtion=this.thumbUrlInQueue.subscribe(function(){this.getInThumbQueue()},this),this.thumbnailSrc=r.observable(""),this.thumbnailLoaded=r.observable(!1),this.thumbnailSessionUid=r.observable(""),this.mimeType=r.observable(""),this.uploadUid=r.observable(""),this.uploaded=r.observable(!1),this.uploadError=r.observable(!1),this.downloading=r.observable(!1),this.isViewMimeType=r.computed(function(){return-1!==n.inArray(this.mimeType(),m)},this),this.bHasHtmlEmbed=!1,this.otherTemplates=r.observableArray([]),this.statusText=r.observable(""),this.statusTooltip=r.computed(function(){return this.uploadError()?this.statusText():""},this),this.progressPercent=r.observable(0),this.visibleProgress=r.observable(!1),this.uploadStarted=r.observable(!1),this.uploadStarted.subscribe(function(){this.uploadStarted()?(this.uploaded(!1),this.visibleProgress(!0),this.progressPercent(20)):(this.progressPercent(100),this.visibleProgress(!1),this.uploaded(!0))},this),this.downloading.subscribe(function(){this.downloading()?this.visibleProgress(!0):(this.visibleProgress(!1),this.progressPercent(0))},this),this.allowDrag=r.observable(!1),this.allowUpload=r.observable(!1),this.allowSharing=r.observable(!1),this.bIsSecure=r.observable(!1),this.sHeaderText="",this.oActionsData={view:{Text:h.i18n("COREWEBCLIENT/ACTION_VIEW_FILE"),Handler:o.bind(function(){this.viewFile()},this)},download:{Text:h.i18n("COREWEBCLIENT/ACTION_DOWNLOAD_FILE"),Handler:o.bind(function(){this.downloadFile()},this),Tooltip:r.computed(function(){var e=h.i18n("COREWEBCLIENT/INFO_CLICK_TO_DOWNLOAD_FILE",{FILENAME:this.fileName(),SIZE:this.friendlySize()});return""===this.friendlySize()&&(e=e.replace(" ()","")),e},this)}},this.allowActions=r.observable(!0),this.iconAction=r.observable("download"),this.cssClasses=r.computed(function(){return this.getCommonClasses().join(" ")},this),this.actions=r.observableArray([]),this.firstAction=r.computed(function(){return this.actions().length>1?this.actions()[0]:""},this),this.secondAction=r.computed(function(){return 1===this.actions().length?this.actions()[0]:this.actions().length>1?this.actions()[1]:""},this),this.subFiles=r.observableArray([]),this.subFilesExpanded=r.observable(!1)}var o=i(2),n=i(1),r=i(46),a=i(179),l=i(315),h=i(43),u=i(44),c=i(177),d=i(213),p=i(196),m=["image/jpeg","image/png","image/gif","text/html","text/plain","text/css","text/rfc822-headers","message/delivery-status","application/x-httpd-php","application/javascript"],g=[];n("html").hasClass("pdf")&&(m.push("application/pdf"),m.push("application/x-pdf")),s.prototype.addAction=function(e,t,i){t?this.actions.unshift(e):this.actions.push(e),this.actions(o.compact(this.actions())),i&&(this.oActionsData[e]=i)},s.prototype.removeAction=function(e){this.actions(o.without(this.actions(),e))},s.prototype.getMainAction=function(){return this.actions()[0]},s.prototype.hasAction=function(e){return o.indexOf(this.actions(),e)!==-1},s.prototype.getActionText=function(e){return this.hasAction(e)&&this.oActionsData[e]&&("string"==typeof this.oActionsData[e].Text||o.isFunction(this.oActionsData[e].Text))?o.isFunction(this.oActionsData[e].Text)?this.oActionsData[e].Text():this.oActionsData[e].Text:""},s.prototype.getActionUrl=function(e){return this.hasAction(e)&&this.oActionsData[e]?this.oActionsData[e].Url||"":""},s.prototype.executeAction=function(e){this.hasAction(e)&&this.oActionsData[e]&&o.isFunction(this.oActionsData[e].Handler)&&this.oActionsData[e].Handler()},s.prototype.getTooltip=function(e){var t=this.hasAction(e)&&this.oActionsData[e]?this.oActionsData[e].Tooltip:"";return"string"==typeof t?t:o.isFunction(t)?t():""},s.prototype.getCommonClasses=function(){var e=[];return(this.allowUpload()&&!this.uploaded()||this.downloading())&&e.push("incomplete"),this.uploadError()?e.push("fail"):e.push("success"),e},s.prototype.parse=function(e){this.fileName(u.pString(e.FileName)),this.tempName(u.pString(e.TempName)),""===this.tempName()&&this.tempName(this.fileName()),this.mimeType(u.pString(e.MimeType)),this.size(e.EstimatedSize?u.pInt(e.EstimatedSize):u.pInt(e.SizeInBytes)),this.hash(u.pString(e.Hash)),this.parseActions(e),this.uploadUid(this.hash()),this.uploaded(!0),n.isFunction(this.additionalParse)&&this.additionalParse(e)},s.prototype.parseActions=function(e){this.commonParseActions(e)},s.prototype.commonParseActions=function(e){this.thumbUrlInQueue(u.pString(e.ThumbnailUrl)),o.each(e.Actions,function(e,t){this.oActionsData[t]||(this.oActionsData[t]={}),this.oActionsData[t].Url=u.pString(e.url),this.actions.push(t)},this)},s.addViewExtensions=function(e){o.isArray(e)&&(g=o.union(g,e))},s.prototype.isViewSupported=function(){return-1!==n.inArray(this.mimeType(),m)||-1!==n.inArray(this.extension(),g)},s.prototype.getInThumbQueue=function(){""===this.thumbUrlInQueue()||this.linked&&(!this.linked||this.linked())||(this.thumbnailSessionUid(""+Date.now()),l.thumbQueue(this.thumbnailSessionUid(),this.thumbUrlInQueue(),this.thumbnailSrc))},s.prototype.downloadFile=function(){var e=this.getActionUrl("download"),t={File:this,CancelDownload:!1};e.length>0&&"#"!==e&&(a.broadcastEvent("AbstractFileModel::FileDownload::before",t),t.CancelDownload||(o.isFunction(t.CustomDownloadHandler)?t.CustomDownloadHandler():c.downloadByUrl(e)))},s.prototype.viewFile=function(e,t){d.calmEvent(t),this.viewCommonFile()},s.prototype.viewCommonFile=function(e){var t=null,i=null;u.isNonEmptyString(e)||(e=c.getAppPath()+this.getActionUrl("view")),e.length>0&&"#"!==e&&(i={sUrl:e,index:this.index(),bBreakView:!1},a.broadcastEvent("AbstractFileModel::FileView::before",i),i.bBreakView||(t=p.open(e,e,!1),t&&t.focus()))},s.prototype.eventDragStart=function(e,t){var i=t.originalEvent||t;return e&&i&&i.dataTransfer&&i.dataTransfer.setData&&i.dataTransfer.setData("DownloadURL",this.generateTransferDownloadUrl()),!0},s.prototype.generateTransferDownloadUrl=function(){var e=this.getActionUrl("download");return"http"!==e.substr(0,4)&&(e=c.getAppPath()+e),this.mimeType()+":"+this.fileName()+":"+e},s.prototype.onUploadSelect=function(e,t,i){i||(this.fileName(u.pString(t.FileName)),this.mimeType(u.pString(t.Type)),this.size(u.pInt(t.Size))),this.uploadUid(e),this.uploaded(!1),this.statusText(""),this.progressPercent(0),this.visibleProgress(!1)},s.prototype.onUploadStart=function(){this.visibleProgress(!0)},s.prototype.onUploadProgress=function(e,t){t>0&&(this.progressPercent(Math.ceil(e/t*100)),this.visibleProgress(!0))},s.prototype.onDownloadProgress=function(e,t){t>0&&(this.progressPercent(Math.ceil(e/t*100)),this.visibleProgress(this.progressPercent()<100))},s.prototype.onUploadComplete=function(e,t,i){var s=!(t&&i&&!i.ErrorCode&&i.Result&&!i.Result.Error),o=i&&i.Result&&"size"===i.Result.Error?h.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE"):h.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN");this.progressPercent(0),this.visibleProgress(!1),this.uploaded(!0),this.uploadError(s),this.statusText(s?o:h.i18n("COREWEBCLIENT/REPORT_UPLOAD_COMPLETE")),s||(this.fillDataAfterUploadComplete(i,e),setTimeout(function(e){return function(){e.statusText("")}}(this),3e3))},s.prototype.fillDataAfterUploadComplete=function(e,t){},s.prototype.onImageLoad=function(e,t){""===this.thumbUrlInQueue()||this.thumbnailLoaded()||(this.thumbnailLoaded(!0),l.thumbQueue(this.thumbnailSessionUid()))},s.prototype.stopDownloading=function(){this.downloading(!1)},s.prototype.startDownloading=function(){this.downloading(!0)},e.exports=s},321:function(e,t,i){"use strict";function s(){this.resultCount=n.observable(-1),this.search=n.observable(""),this.filters=n.observable(""),this.collection=n.observableArray([]),this.threadUids={}}var o=i(2),n=i(46),r=i(306);s.prototype.addThreadUids=function(e,t){-1!==o.indexOf(this.collection(),e)&&(this.threadUids[e]=t)},s.prototype.setUidsAndCount=function(e){"Collection/MessageCollection"===e["@Object"]&&(o.each(e.Uids,function(t,i){this.collection()[i+e.Offset]=""+t},this),this.resultCount(e.MessageResultCount))},s.prototype.getUidsForOffset=function(e,t){for(var i=0,s=this.collection().length,o="",n=0,a=[],l=null;i<s;i++)i>=e&&n<r.MailsPerPage&&(o=this.collection()[i],l=t[o],(l&&!l.deleted()||void 0===o)&&(n++,void 0!==o&&a.push(o)));return a},s.prototype.deleteUids=function(e){for(var t=0,i=this.collection().length,s="",n=[],r=0;t<i;t++)s=this.collection()[t],o.indexOf(e,s)===-1?n.push(s):r++;this.collection(n),this.resultCount(this.resultCount()-r)},e.exports=s},322:function(e,t,i){"use strict";var s=i(2),o=i(179),n=i(45),r=i(307),a=i(308),l=i(306),h=i(309),u={},c=!1;u.prefetchFetchersIdentities=function(){return!(o.isNewTab()||c||!l.AllowFetchers&&!l.AllowIdentities)&&(r.populateFetchersIdentities(),c=!0,!0)},u.prefetchAccountFilters=function(){var e=r.getCurrent();e&&!e.filters()&&l.AllowFilters&&e.requestFilters()},u.prefetchStarredMessageList=function(){var e=h.folderList(),t=e?e.inboxFolder():null,i=null;return t&&!t.hasChanges()&&(i=h.requestMessageList(t.fullName(),1,"",Enums.FolderFilter.Flagged,!1,!1)),i&&i.RequestStarted},u.prefetchUnseenMessageList=function(){var e=h.folderList(),t=e?e.inboxFolder():null,i=null;return t&&!t.hasChanges()&&(i=h.requestMessageList(t.fullName(),1,"",Enums.FolderFilter.Unseen,!1,!1)),i&&i.RequestStarted},u.prefetchNextPage=function(e){var t=h.uidList(),i=s.indexOf(t.collection(),e),o=Math.ceil(i/l.MailsPerPage)+1;this.startPagePrefetch(o-1)},u.prefetchPrevPage=function(e){var t=h.uidList(),i=s.indexOf(t.collection(),e),o=Math.ceil((i+1)/l.MailsPerPage)+1;this.startPagePrefetch(o)},u.startPagePrefetch=function(e){var t=h.folderList().currentFolder(),i=h.uidList(),s=(e-1)*l.MailsPerPage,o=e>0&&s<i.resultCount(),n=null,r=null;return t&&!t.hasChanges()&&o&&(n={folder:t.fullName(),page:e,search:i.search()},t.hasListBeenRequested(n)||(r=h.requestMessageList(n.folder,n.page,n.search,"",!1,!1))),r&&r.RequestStarted},u.startOtherFoldersPrefetch=function(){var e=h.folderList(),t=e.currentFolderFullName(),i=r.getCurrentFetchersAndFiltersFolderNames(),o=e?[e.inboxFolderFullName(),e.sentFolderFullName(),e.draftsFolderFullName(),e.spamFolderFullName()]:[],n=i.length<3?this.getOtherFolderNames(3-i.length):[],a=s.uniq(s.compact(s.union(o,i,n))),l=!1;return s.each(a,s.bind(function(i){l||t===i||(l=this.startFolderPrefetch(e.getFolderByFullName(i)))},this)),l},u.getOtherFolderNames=function(e){var t=h.folderList().inboxFolder(),i=t?t.subfolders():[],o=s.filter(h.folderList().collection(),function(e){return!e.isSystem()},this),n=s.first(s.union(i,o),e);return s.map(n,function(e){return e.fullName()})},u.startFolderPrefetch=function(e){var t=1,i="",s={folder:e?e.fullName():"",page:t,search:i},o=null;return e&&!e.hasListBeenRequested(s)&&(o=h.requestMessageList(s.folder,s.page,s.search,"",!1,!1)),!!o&&o.RequestStarted},u.startThreadListPrefetch=function(){var e=[],t=h.getCurrentFolder();return s.each(h.messages(),function(i){i.threadCount()>0&&s.each(i.threadUids(),function(i){var s=t.oMessages[i];s||t.hasThreadUidBeenRequested(i)||e.push(i)})},this),e.length>0&&(e=e.slice(0,l.MailsPerPage),t.addRequestedThreadUids(e),t.loadThreadMessages(e),!0)},u.startMessagesPrefetch=function(){var e=h.currentAccountId(),t=h.getCurrentFolder(),i=0,o=l.MaxMessagesBodiesSizeToPrefetch,n=[],r=null,u=2048,c=function(e){var r=!e.deleted()&&!e.completelyFilled(),a=!s.find(n,function(t){return t===e.uid()},this),l=!t.hasUidBeenRequested(e.uid());i<o&&r&&a&&l&&(n.push(e.uid()),i+=e.trimmedTextSize()+u)};return!!(t&&t.selected()&&(s.each(h.messages(),c),s.each(t.oMessages,c),n.length>0))&&(t.addRequestedUids(n),r={AccountID:e,Folder:t.fullName(),Uids:n},a.send("GetMessagesBodies",r,this.onGetMessagesBodiesResponse,this),!0)},u.onGetMessagesBodiesResponse=function(e,t){var i=t.Parameters,o=h.getFolderByFullName(i.AccountID,i.Folder);s.isArray(e.Result)&&s.each(e.Result,function(e){o.parseAndCacheMessage(e,!1,!1)})},u.prefetchAccountQuota=function(){var e=r.getCurrent(),t=e&&!e.quotaRecieved();return!(!n.ShowQuotaBar||!t)&&(e.updateQuotaParams(),!0)},e.exports={startMin:function(){var e=!1;return e=u.prefetchFetchersIdentities(),e||(e=u.prefetchAccountFilters()),e||(e=u.prefetchStarredMessageList()),e||(e=u.prefetchAccountQuota()),e},startAll:function(){var e=!1;return e=u.prefetchFetchersIdentities(),e||(e=u.prefetchAccountFilters()),e||(e=u.startMessagesPrefetch()),e||(e=u.startThreadListPrefetch()),e||(e=u.prefetchStarredMessageList()),e||(e=u.startPagePrefetch(h.page()+1)),e||(e=u.startPagePrefetch(h.page()-1)),e||(e=u.prefetchUnseenMessageList()),e||(e=u.prefetchAccountQuota()),e||(e=u.startOtherFoldersPrefetch()),e},prefetchStarredMessageList:function(){u.prefetchStarredMessageList()},startFolderPrefetch:function(e){u.startFolderPrefetch(e)},prefetchNextPage:function(e){u.prefetchNextPage(e)},prefetchPrevPage:function(e){u.prefetchPrevPage(e)}}},323:function(e,t,i){"use strict";var s=i(179),o=i(s.isMobile()||s.isNewTab()?324:325);e.exports=o},324:function(e,t,i){"use strict";var s=i(191),o=i(311),n={};n.composeMessage=function(){s.setHash(o.getCompose())},n.composeMessageFromDrafts=function(e,t){var i=o.getComposeFromMessage("drafts",e,t);s.setHash(i)},n.composeMessageAsReplyOrForward=function(e,t,i){var n=o.getComposeFromMessage(e,t,i);s.setHash(n)},n.composeMessageToAddresses=function(e){var t=o.getComposeWithToField(e);s.setHash(t)},n.composeMessageWithVcard=function(e){var t=["vcard",e];s.goDirectly(o.getCompose(),t)},n.composeMessageWithEml=function(e){var t=o.getComposeWithEmlObject(e.folder(),e.uid(),e);t.shift(),t.shift(),s.goDirectly(o.getCompose(),t)},n.composeMessageWithAttachments=function(e){var t=o.getComposeWithObject("attachments",e);s.goDirectly(o.getCompose(),t)},e.exports=n},325:function(e,t,i){"use strict";function s(){return i(326)}var o=i(184),n=i(311),r={};r.composeMessage=function(){o.showPopup(s())},r.composeMessageFromDrafts=function(e,t){var i=n.getComposeFromMessage("drafts",e,t);i.shift(),o.showPopup(s(),[i])},r.composeMessageAsReplyOrForward=function(e,t,i){var r=n.getComposeFromMessage(e,t,i);r.shift(),o.showPopup(s(),[r])},r.composeMessageToAddresses=function(e){var t=n.getComposeWithToField(e);t.shift(),o.showPopup(s(),[t])},r.composeMessageWithVcard=function(e){var t=["vcard",e];o.showPopup(s(),[t])},r.composeMessageWithEml=function(e){var t=n.getComposeWithEmlObject(e.folder(),e.uid(),e);t.shift(),o.showPopup(s(),[t])},r.composeMessageWithAttachments=function(e){var t=n.getComposeWithObject("attachments",e);t.shift(),o.showPopup(s(),[t])},r.closeComposePopup=function(){o.showPopup(s(),[["close"]])},e.exports=r},326:function(e,t,i){"use strict";function s(){u.call(this),d.call(this),this.minimized=r.observable(!1),this.fPreventBackspace=function(e){var t=e.which===n.ui.keyCode.BACKSPACE,i="INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName,s="DIV"===e.target.tagName&&"true"===n(e.target).attr("contenteditable");!t||i||s||(e.preventDefault(),e.stopPropagation())},this.minimized.subscribe(function(){this.minimized()?this.preventBackspaceOff():this.shown()&&this.preventBackspaceOn()},this),this.minimizedTitle=r.computed(function(){return this.subject()||a.i18n("MAILWEBCLIENT/HEADING_MINIMIZED_NEW_MESSAGE")},this)}var o=i(2),n=i(1),r=i(46),a=i(43),l=i(178),h=i(184),u=i(186),c=i(327),d=i(328);o.extendOwn(s.prototype,u.prototype),o.extendOwn(s.prototype,d.prototype),s.prototype.PopupTemplate="MailWebclient_ComposePopup",s.prototype.preventBackspaceOn=function(){n(document).on("keydown",this.fPreventBackspace)},s.prototype.preventBackspaceOff=function(){n(document).off("keydown",this.fPreventBackspace)},s.prototype.onClose=function(){this.preventBackspaceOff()},s.prototype.onOpen=function(e){if(e=e||[],1===e.length&&"close"===e[0])this.closePopup();else{var t=3===e.length&&"drafts"===e[0]&&e[2]===this.draftUid(),i=this.minimized();this.maximize(),this.shown()?(e.length>0&&!t?this.hasUnsavedChanges()?(this.stopAutosaveTimer(),h.showPopup(c,[o.bind(function(t){switch(t){case Enums.AnotherMessageComposedAnswer.Discard:this.onRoute(e);break;case Enums.AnotherMessageComposedAnswer.SaveAsDraft:this.hasUnsavedChanges()&&this.executeSave(!0,!1),this.onRoute(e);break;case Enums.AnotherMessageComposedAnswer.Cancel:}this.startAutosaveTimer()},this)])):this.onRoute(e):i||this.onRoute(e),this.oHtmlEditor.clearUndoRedo()):this.onRoute(e),this.preventBackspaceOn()}},s.prototype.minimize=function(){this.minimized(!0),this.$popupDom.addClass("minimized")},s.prototype.maximize=function(){this.minimized(!1),this.$popupDom.removeClass("minimized")},s.prototype.saveAndClose=function(){this.hasUnsavedChanges()&&this.saveCommand(),this.closePopup()},s.prototype.cancelPopup=function(){this.hasUnsavedChanges()?this.minimize():this.closePopup()},s.prototype.onEscHandler=function(e){var t=this.oHtmlEditor.hasOpenedPopup(),i=!l.ie&&e.target&&"input"===e.target.tagName.toLowerCase()&&"file"===e.target.type.toLowerCase();i&&e.target.blur(),!h.hasOnlyOneOpenedPopup()||t||i||this.minimize(),t&&this.oHtmlEditor.closeAllPopups()},e.exports=new s},327:function(e,t,i){"use strict";function s(){r.call(this),this.fConfirmCallback=null,this.shown=!1}var o=i(2),n=i(1),r=i(186);o.extendOwn(s.prototype,r.prototype),s.prototype.PopupTemplate="MailWebclient_ConfirmAnotherMessageComposedPopup",s.prototype.onOpen=function(e){this.fConfirmCallback=n.isFunction(e)?e:null,this.shown=!0},s.prototype.onClose=function(){this.shown=!1},s.prototype.onDiscardClick=function(){this.shown&&this.fConfirmCallback&&this.fConfirmCallback(Enums.AnotherMessageComposedAnswer.Discard),this.closePopup()},s.prototype.onSaveAsDraftClick=function(){this.shown&&this.fConfirmCallback&&this.fConfirmCallback(Enums.AnotherMessageComposedAnswer.SaveAsDraft),this.closePopup()},s.prototype.cancelPopup=function(){this.fConfirmCallback&&this.fConfirmCallback(Enums.AnotherMessageComposedAnswer.Cancel),this.closePopup()},s.prototype.onEnterHandler=function(){this.onSaveAsDraftClick()},e.exports=new s},328:function(e,t,i){"use strict";function s(){E.call(this,"MailWebclient"),this.browserTitle=r.computed(function(){return T.getEmail()+" - "+h.i18n("MAILWEBCLIENT/HEADING_COMPOSE_BROWSER_TAB")});var e=this;this.toAddrDom=r.observable(),this.toAddrDom.subscribe(function(){this.initInputosaurus(this.toAddrDom,this.toAddr,this.lockToAddr,"to")},this),this.ccAddrDom=r.observable(),this.ccAddrDom.subscribe(function(){this.initInputosaurus(this.ccAddrDom,this.ccAddr,this.lockCcAddr,"cc")},this),this.bccAddrDom=r.observable(),this.bccAddrDom.subscribe(function(){this.initInputosaurus(this.bccAddrDom,this.bccAddr,this.lockBccAddr,"bcc")},this),this.folderList=M.folderList,this.folderList.subscribe(function(){this.getMessageOnRoute()},this),this.bNewTab=d.isNewTab(),this.bDemo=v.IsDemo,this.sending=r.observable(!1),this.saving=r.observable(!1),this.oHtmlEditor=new x(!1,this),this.visibleBcc=r.observable(!1),this.visibleBcc.subscribe(function(){B.toggleClass("screen-compose-bcc",this.visibleCc()),o.defer(o.bind(function(){n(this.bccAddrDom()).inputosaurus("resizeInput")},this))},this),this.visibleCc=r.observable(!1),this.visibleCc.subscribe(function(){B.toggleClass("screen-compose-cc",this.visibleCc()),o.defer(o.bind(function(){n(this.ccAddrDom()).inputosaurus("resizeInput")},this))},this),this.sendReadingConfirmation=r.observable(!1).extend({reversible:!0}),this.composeUploaderButton=r.observable(null),this.composeUploaderButton.subscribe(function(){this.initUploader()},this),this.composeUploaderDropPlace=r.observable(null),this.composeUploaderBodyDragOver=r.observable(!1),this.composeUploaderDragOver=r.observable(!1),this.allowDragNDrop=r.observable(!1),this.uploaderBodyDragOver=r.computed(function(){return this.allowDragNDrop()&&this.composeUploaderBodyDragOver()},this),this.uploaderDragOver=r.computed(function(){return this.allowDragNDrop()&&this.composeUploaderDragOver()},this),this.selectedImportance=r.observable(Enums.Importance.Normal).extend({reversible:!0}),this.senderAccountId=D.senderAccountId,this.senderList=D.senderList,this.visibleFrom=r.computed(function(){return this.senderList().length>1},this),this.selectedSender=D.selectedSender,this.selectedFetcherOrIdentity=D.selectedFetcherOrIdentity,this.selectedFetcherOrIdentity.subscribe(function(){this.oHtmlEditor.isEditing()||this.oHtmlEditor.clearUndoRedo()},this),this.signature=r.observable(""),this.prevSignature=r.observable(null),r.computed(function(){var e=I.getClearSignature(this.senderAccountId(),this.selectedFetcherOrIdentity());null===this.prevSignature()?(this.prevSignature(e),this.signature(e)):(this.prevSignature(this.signature()),this.signature(e),this.oHtmlEditor.changeSignatureContent(this.signature(),this.prevSignature()))},this),this.lockToAddr=r.observable(!1),this.toAddr=r.observable("").extend({reversible:!0}),this.toAddr.subscribe(function(){this.lockToAddr()||(n(this.toAddrDom()).val(this.toAddr()),n(this.toAddrDom()).inputosaurus("refresh"))},this),this.lockCcAddr=r.observable(!1),this.ccAddr=r.observable("").extend({reversible:!0}),this.ccAddr.subscribe(function(){this.lockCcAddr()||(n(this.ccAddrDom()).val(this.ccAddr()),n(this.ccAddrDom()).inputosaurus("refresh"))},this),this.lockBccAddr=r.observable(!1),this.bccAddr=r.observable("").extend({reversible:!0}),this.bccAddr.subscribe(function(){this.lockBccAddr()||(n(this.bccAddrDom()).val(this.bccAddr()),n(this.bccAddrDom()).inputosaurus("refresh"))},this),this.recipientEmails=r.computed(function(){var e=[this.toAddr(),this.ccAddr(),this.bccAddr()].join(",").split(","),t=[];return o.each(e,function(e){var i=n.trim(e),s=null;""!==i&&(s=a.getEmailParts(i),s.email&&t.push(s.email))}),t},this),this.subject=r.observable("").extend({reversible:!0}),this.plainText=r.observable(!1),this.textBody=r.observable(""),this.textBody.subscribe(function(){this.oHtmlEditor.setText(this.textBody(),this.plainText()),this.oHtmlEditor.commit()},this),this.focusedField=r.observable(),this.oHtmlEditor.textFocused.subscribe(function(){this.oHtmlEditor.textFocused()&&this.focusedField("text")},this),this.subjectFocused=r.observable(!1),this.subjectFocused.subscribe(function(){this.subjectFocused()&&this.focusedField("subject")},this),this.draftUid=r.observable(""),this.draftUid.subscribe(function(){M.editedDraftUid(this.draftUid())},this),this.draftInfo=r.observableArray([]),this.routeType=r.observable(""),this.routeParams=r.observableArray([]),this.inReplyTo=r.observable(""),this.references=r.observable(""),this.bUploadStatus=!1,this.iUploadAttachmentsTimer=0,this.messageUploadAttachmentsStarted=r.observable(!1),this.messageUploadAttachmentsStarted.subscribe(function(t){window.clearTimeout(e.iUploadAttachmentsTimer),t?e.iUploadAttachmentsTimer=window.setTimeout(function(){e.bUploadStatus=!0,b.showLoading(h.i18n("MAILWEBCLIENT/INFO_ATTACHMENTS_LOADING"))},4e3):e.bUploadStatus?e.iUploadAttachmentsTimer=window.setTimeout(function(){e.bUploadStatus=!1,b.hideLoading()},1e3):b.hideLoading()},this),this.attachments=r.observableArray([]),this.attachmentsChanged=r.observable(!1),this.attachments.subscribe(function(){this.attachmentsChanged(!0)},this),this.notUploadedAttachments=r.computed(function(){return o.filter(this.attachments(),function(e){return!e.uploaded()})},this),this.allAttachmentsUploaded=r.computed(function(){return 0===this.notUploadedAttachments().length&&!this.messageUploadAttachmentsStarted()},this),this.notInlineAttachments=r.computed(function(){return o.filter(this.attachments(),function(e){return!e.linked()})},this),this.notInlineAttachments.subscribe(function(){B.toggleClass("screen-compose-attachments",this.notInlineAttachments().length>0)},this),this.allowStartSending=r.computed(function(){return!this.saving()},this),this.allowStartSending.subscribe(function(){this.allowStartSending()&&this.requiresPostponedSending()&&(I.sendPostponedMail(this.draftUid()),this.requiresPostponedSending(!1))},this),this.requiresPostponedSending=r.observable(!1),this.oJua=null,this.isDraftsCleared=r.observable(!1),this.backToListOnSendOrSave=r.observable(!1),this.composeShown=r.computed(function(){return!!this.opened&&this.opened()||!!this.shown&&this.shown()},this),this.toolbarControllers=r.observableArray([]),this.disableHeadersEdit=r.computed(function(){var e=!1;return o.each(this.toolbarControllers(),function(t){e=e||!!t.disableHeadersEdit&&t.disableHeadersEdit()}),e},this),r.computed(function(){var e=!1;o.each(this.toolbarControllers(),function(t){e=e||!!t.disableBodyEdit&&t.disableBodyEdit()}),this.oHtmlEditor.setDisableEdit(e)},this),R.AllowAutosaveInDrafts&&R.AutoSaveIntervalSeconds>0&&(this.iAutosaveInterval=-1,r.computed(function(){var e=this.composeShown()&&!this.sending()&&!this.saving();o.each(this.toolbarControllers(),function(t){e=e&&!(t.disableAutosave&&t.disableAutosave())}),window.clearInterval(this.iAutosaveInterval),e&&(this.iAutosaveInterval=window.setInterval(o.bind(this.executeSave,this,!0),1e3*R.AutoSaveIntervalSeconds))},this)),this.backToListCommand=c.createCommand(this,this.executeBackToList),this.sendCommand=c.createCommand(this,this.executeSend,this.isEnableSending),this.saveCommand=c.createCommand(this,this.executeSaveCommand,this.isEnableSaving),this.messageFields=r.observable(null),this.bottomPanel=r.observable(null),this.sHotkeysHintsViewTemplate=p.mobileDevice?"":"MailWebclient_Compose_HotkeysHintsView",this.sPopupButtonsViewTemplate=d.isNewTab()?"":"MailWebclient_Compose_PopupButtonsView",this.aHotkeys=[{value:"Ctrl+Enter",action:h.i18n("MAILWEBCLIENT/LABEL_SEND_HOTKEY")},{value:"Ctrl+S",action:h.i18n("MAILWEBCLIENT/LABEL_SAVE_HOTKEY")},{value:"Ctrl+Z",action:h.i18n("MAILWEBCLIENT/LABEL_UNDO_HOTKEY")},{value:"Ctrl+Y",action:h.i18n("MAILWEBCLIENT/LABEL_REDO_HOTKEY")},{value:"Ctrl+K",action:h.i18n("MAILWEBCLIENT/LABEL_LINK_HOTKEY")
},{value:"Ctrl+B",action:h.i18n("MAILWEBCLIENT/LABEL_BOLD_HOTKEY")},{value:"Ctrl+I",action:h.i18n("MAILWEBCLIENT/LABEL_ITALIC_HOTKEY")},{value:"Ctrl+U",action:h.i18n("MAILWEBCLIENT/LABEL_UNDERLINE_HOTKEY")}],this.bAllowFiles=!!C,this.ignoreHasUnsavedChanges=r.observable(!1),this.changedInPreviousWindow=r.observable(!1),this.hasUnsavedChanges=r.computed(function(){return!this.ignoreHasUnsavedChanges()&&this.isChanged()&&this.isEnableSaving()},this),this.saveAndCloseTooltip=r.computed(function(){return this.hasUnsavedChanges()?h.i18n("MAILWEBCLIENT/ACTION_SAVE_CLOSE"):h.i18n("MAILWEBCLIENT/ACTION_CLOSE")},this),this.splitterDom=r.observable(),this.headersCompressed=r.observable(!1),this.allowCcBccSwitchers=r.computed(function(){return!this.disableHeadersEdit()&&!this.headersCompressed()},this),this.registerOwnToolbarControllers(),d.broadcastEvent("MailWebclient::ConstructView::after",{Name:this.ViewConstructorName,View:this})}var o=i(2),n=i(1),r=i(46),a=i(201),l=i(315),h=i(43),u=i(44),c=i(213),d=i(179),p=i(178),m=i(271),g=i(42),f=i(191),b=i(183),v=i(45),y=i(196),E=i(194),S=i(184),A=i(190),C=g.run("FilesWebclient","getSelectFilesPopup"),F=i(311),I=i(329),T=i(307),L=i(189),w=i(308),M=i(309),N=i(330),D=i(332),R=i(306),P=i(314),U=i(319),x=i(333),O=d.isNewTab()&&window.opener&&window.opener.MainTabMailMethods,B=n("html");o.extendOwn(s.prototype,E.prototype),s.prototype.ViewTemplate=d.isNewTab()?"MailWebclient_ComposeScreenView":"MailWebclient_ComposeView",s.prototype.ViewConstructorName="CComposeView",s.prototype.isEnableSending=function(){var e=0===this.toAddr().length&&0===this.ccAddr().length&&0===this.bccAddr().length,t=this.folderList()&&0!==this.folderList().iAccountId;return t&&!this.sending()&&!e&&this.allAttachmentsUploaded()},s.prototype.isEnableSaving=function(){var e=this.folderList()&&0!==this.folderList().iAccountId;return this.composeShown()&&e&&!this.sending()&&!this.saving()},s.prototype.initInputosaurus=function(e,t,i,s){e()&&n(e()).length>0&&n(e()).inputosaurus({width:"auto",parseOnBlur:!0,autoCompleteSource:g.run("ContactsWebclient","getSuggestionsAutocompleteComposeCallback")||function(){},autoCompleteDeleteItem:g.run("ContactsWebclient","getSuggestionsAutocompleteDeleteHandler")||function(){},autoCompleteAppendTo:n(e()).closest("td"),change:o.bind(function(e){i(!0),this.setRecipient(t,e.target.value),i(!1)},this),copy:o.bind(function(e){this.inputosaurusBuffer=e},this),paste:o.bind(function(){var e=this.inputosaurusBuffer||"";return this.inputosaurusBuffer="",e},this),focus:o.bind(this.focusedField,this,s),mobileDevice:p.mobileDevice})},s.prototype.changeHeadersCompressed=function(){this.headersCompressed(!this.headersCompressed())},s.prototype.onBind=function(){g.run("SessionTimeoutWeblient","registerFunction",[o.bind(this.executeSave,this,!1)]),d.isMobile()||this.hotKeysBind()},s.prototype.hotKeysBind=function(){(this.$popupDom||this.$viewDom).on("keydown",n.proxy(function(e){if(e&&e.ctrlKey&&!e.altKey&&!e.shiftKey){var t=e.keyCode,i=this.composeShown()&&(!this.minimized||!this.minimized())&&e&&e.ctrlKey;i&&t===Enums.Key.s?(e.preventDefault(),e.returnValue=!1,this.isEnableSaving()&&this.saveCommand()):i&&t===Enums.Key.Enter&&""!==this.toAddr()&&this.sendCommand()}},this))},s.prototype.getMessageOnRoute=function(){var e=F.parseCompose(this.routeParams());""!==this.routeType()&&e.MessageFolderName&&e.MessageUid&&M.getMessage(e.MessageFolderName,e.MessageUid,this.onMessageResponse,this)},s.prototype.onShow=function(){var e=this.focusedField();n(this.splitterDom()).trigger("resize"),n(this.bottomPanel()).trigger("resize"),this.oHtmlEditor.isInitialized()||(this.oHtmlEditor.init(this.textBody(),this.plainText(),"7"),this.oHtmlEditor.commit()),this.initUploader(),this.backToListOnSendOrSave(!1),this.focusedField(e),B.addClass("screen-compose"),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!0)},s.prototype.reset=function(){this.plainText(!1),this.bUploadStatus=!1,window.clearTimeout(this.iUploadAttachmentsTimer),this.messageUploadAttachmentsStarted(!1),this.draftUid(""),this.draftInfo.removeAll(),this.setDataFromMessage(new P),this.isDraftsCleared(!1),this.ignoreHasUnsavedChanges(!1)},s.prototype.onRoute=function(e){var t=F.parseCompose(e);switch(T.changeCurrentAccountByHash(t.AccountHash),this.reset(),this.routeType(t.RouteType),this.routeType()){case Enums.ReplyType.ForwardAsAttach:this.routeParams(e),this.fillDefault(t);case Enums.ReplyType.Reply:case Enums.ReplyType.ReplyAll:case Enums.ReplyType.Resend:case Enums.ReplyType.Forward:case"drafts":this.routeParams(e),0!==this.folderList().iAccountId&&this.getMessageOnRoute();break;default:this.routeParams(e),this.fillDefault(t)}},s.prototype.fillDefault=function(e){var t=I.getSignatureText(this.senderAccountId(),this.selectedFetcherOrIdentity(),!0),i=O?O.getComposedMessage(window.name):null,s=e.ToAddr;i?(this.setMessageDataInNewTab(i),this.changedInPreviousWindow()&&o.defer(o.bind(this.executeSave,this,!0))):""!==t&&this.textBody("<br /><br />"+t+"<br />"),s&&(this.setRecipient(this.toAddr,s.to),s.hasMailto&&(this.subject(s.subject),this.setRecipient(this.ccAddr,s.cc),this.setRecipient(this.bccAddr,s.bcc),""!==s.body&&this.textBody("<div>"+s.body+"</div>"))),"vcard"===this.routeType()&&e.Object&&this.addContactAsAttachment(e.Object),this.routeType()===Enums.ReplyType.ForwardAsAttach&&e.Object&&this.addMessageAsAttachment(e.Object),"attachments"===this.routeType()&&e.Object&&this.addAttachments(e.Object),o.defer(o.bind(function(){this.focusAfterFilling()},this)),this.visibleCc(""!==this.ccAddr()),this.visibleBcc(""!==this.bccAddr()),this.commit(!0)},s.prototype.focusToAddr=function(){n(this.toAddrDom()).inputosaurus("focus")},s.prototype.focusCcAddr=function(){n(this.ccAddrDom()).inputosaurus("focus")},s.prototype.focusBccAddr=function(){n(this.bccAddrDom()).inputosaurus("focus")},s.prototype.focusAfterFilling=function(){switch(this.focusedField()){case"to":this.focusToAddr();break;case"cc":this.visibleCc(!0),this.focusCcAddr();break;case"bcc":this.visibleBcc(!0),this.focusBccAddr();break;case"subject":this.subjectFocused(!0);break;case"text":this.oHtmlEditor.setFocus();break;default:0===this.toAddr().length?this.focusToAddr():0===this.subject().length?this.subjectFocused(!0):this.oHtmlEditor.setFocus()}},s.prototype.onHide=function(){!o.isFunction(this.closePopup)&&this.hasUnsavedChanges()&&this.executeSave(!0),this.headersCompressed(!1),this.routeParams([]),this.subjectFocused(!1),this.focusedField(""),this.messageUploadAttachmentsStarted(!1),B.removeClass("screen-compose").removeClass("screen-compose-cc").removeClass("screen-compose-bcc").removeClass("screen-compose-attachments"),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!1)},s.prototype.setRecipient=function(e,t){e()===t?e.valueHasMutated():e(t)},s.prototype.onMessageResponse=function(e){var t=null;if(null===e)this.setDataFromMessage(new P);else{switch(this.routeType()){case Enums.ReplyType.Reply:case Enums.ReplyType.ReplyAll:D.setFetcherOrIdentityByReplyMessage(e),t=I.getReplyDataFromMessage(e,this.routeType(),this.senderAccountId(),this.selectedFetcherOrIdentity(),!0),this.draftInfo(t.DraftInfo),this.draftUid(t.DraftUid),this.setRecipient(this.toAddr,t.To),this.setRecipient(this.ccAddr,t.Cc),this.setRecipient(this.bccAddr,t.Bcc),this.subject(t.Subject),this.textBody(t.Text),this.attachments(t.Attachments),this.inReplyTo(t.InReplyTo),this.references(t.References);break;case Enums.ReplyType.ForwardAsAttach:t=I.getReplyDataFromMessage(e,this.routeType(),this.senderAccountId(),this.selectedFetcherOrIdentity(),!0),this.draftInfo(t.DraftInfo),this.draftUid(t.DraftUid),this.inReplyTo(t.InReplyTo),this.references(t.References);break;case Enums.ReplyType.Forward:D.setFetcherOrIdentityByReplyMessage(e),t=I.getReplyDataFromMessage(e,this.routeType(),this.senderAccountId(),this.selectedFetcherOrIdentity(),!0),this.draftInfo(t.DraftInfo),this.draftUid(t.DraftUid),this.setRecipient(this.toAddr,t.To),this.setRecipient(this.ccAddr,t.Cc),this.subject(t.Subject),this.textBody(t.Text),this.attachments(t.Attachments),this.inReplyTo(t.InReplyTo),this.references(t.References);break;case Enums.ReplyType.Resend:this.setDataFromMessage(e);break;case"drafts":this.draftUid(e.uid()),this.setDataFromMessage(e)}this.routeType()!==Enums.ReplyType.ForwardAsAttach&&this.attachments().length>0&&this.requestAttachmentsTempName(),this.routeType("")}this.visibleCc(""!==this.ccAddr()),this.visibleBcc(""!==this.bccAddr()),this.commit(!0),o.defer(o.bind(function(){this.focusAfterFilling()},this))},s.prototype.setDataFromMessage=function(e){var t="",i=I.getFirstFetcherOrIdentityByRecipientsOrDefault(e.oFrom.aCollection,e.accountId());D.changeSenderAccountId(e.accountId(),i),t=e.isPlain()?e.textRaw():e.getConvertedHtml(),this.draftInfo(e.draftInfo()),this.inReplyTo(e.inReplyTo()),this.references(e.references()),this.setRecipient(this.toAddr,e.oTo.getFull()),this.setRecipient(this.ccAddr,e.oCc.getFull()),this.setRecipient(this.bccAddr,e.oBcc.getFull()),this.subject(e.subject()),this.attachments(e.attachments()),this.plainText(e.isPlain()),this.textBody(t),this.selectedImportance(e.importance()),this.sendReadingConfirmation(""!==e.readingConfirmationAddressee()),o.each(this.toolbarControllers(),function(t){o.isFunction(t.doAfterPopulatingMessage)&&t.doAfterPopulatingMessage({bDraft:!!e.folderObject()&&e.folderObject().type()===Enums.FolderTypes.Drafts,bPlain:e.isPlain(),sRawText:e.textRaw(),iSensitivity:e.sensitivity()})})},s.prototype.onDataAsAttachmentUpload=function(e,t){var i=t.Parameters,s=e.Result,n=i.Hash,r=o.find(this.attachments(),function(e){return e.hash()===n});this.messageUploadAttachmentsStarted(!1),r&&(s&&s.Attachment?r.parseFromUpload(s.Attachment):r.errorFromUpload())},s.prototype.addAttachments=function(e){o.each(e,o.bind(function(e){var t=new U;t.parseFromUpload(e),this.attachments.push(t)},this))},s.prototype.addFilesAsAttachment=function(e){var t=null,i=[];o.each(e,function(e){t=new U,t.fileName(e.fileName()),t.hash(e.hash()),t.thumbUrlInQueue(e.thumbUrlInQueue()),t.uploadStarted(!0),this.attachments.push(t),i.push(e.hash())},this),i.length>0&&(this.messageUploadAttachmentsStarted(!0),L.send("Files","GetFilesForUpload",{Hashes:i},this.onFilesUpload,this))},s.prototype.onFilesUpload=function(e,t){var i=t.Parameters,s=e.Result,n=i.Hashes;this.messageUploadAttachmentsStarted(!1),o.isArray(s)?o.each(s,function(e){var t=o.find(this.attachments(),function(t){return t.hash()===e.Hash});t&&(t.parseFromUpload(e),t.hash(e.NewHash))},this):o.each(n,function(e){var t=o.find(this.attachments(),function(t){return t.hash()===e});t&&t.errorFromUpload()},this)},s.prototype.addMessageAsAttachment=function(e){var t=new U,i=null;e&&(t.fileName(e.subject()+".eml"),t.uploadStarted(!0),this.attachments.push(t),i={MessageFolder:e.folder(),MessageUid:e.uid(),FileName:t.fileName()},this.messageUploadAttachmentsStarted(!0),w.send("SaveMessageAsTempFile",i,this.onSaveMessageAsTempFile,this))},s.prototype.onSaveMessageAsTempFile=function(e,t){var i=e.Result,s=t.Parameters.FileName,n=null;this.messageUploadAttachmentsStarted(!1),i?(n=o.find(this.attachments(),function(e){return e.fileName()===s&&e.uploadStarted()}),n&&n.parseFromUpload(i,t.Parameters.MessageFolder,t.Parameters.MessageUid)):(n=o.find(this.attachments(),function(e){return e.fileName()===s&&e.uploadStarted()}),n&&n.errorFromUpload())},s.prototype.addContactAsAttachment=function(e){var t=new U,i=null;e&&(t.fileName("contact-"+e.idContact()+".vcf"),t.uploadStarted(!0),this.attachments.push(t),i={ContactId:e.idContact(),Global:e.global()?"1":"0",Name:t.fileName(),SharedWithAll:e.sharedToAll()?"1":"0"},this.messageUploadAttachmentsStarted(!0),w.send("ContactVCardUpload",i,this.onContactVCardUpload,this))},s.prototype.onContactVCardUpload=function(e,t){var i=t.Parameters,s=e.Result,n=null;this.messageUploadAttachmentsStarted(!1),s?(n=o.find(this.attachments(),function(e){return e.fileName()===s.Name&&e.uploadStarted()}),n&&n.parseFromUpload(s)):(n=o.find(this.attachments(),function(e){return e.fileName()===i.Name&&e.uploadStarted()}),n&&n.errorFromUpload())},s.prototype.requestAttachmentsTempName=function(){var e=o.map(this.attachments(),function(e){return e.uploadUid(e.hash()),e.uploadStarted(!0),e.hash()});e.length>0&&(this.messageUploadAttachmentsStarted(!0),w.send("SaveAttachmentsAsTempFiles",{Attachments:e},this.onMessageUploadAttachmentsResponse,this))},s.prototype.onMessageUploadAttachmentsResponse=function(e,t){var i=t.Parameters.Attachments;this.messageUploadAttachmentsStarted(!1),e.Result?o.each(e.Result,o.bind(this.setAttachTepmNameByHash,this)):(o.each(i,function(e){var t=o.find(this.attachments(),function(t){return t.hash()===e});t&&t.errorFromUpload()},this),b.showError(h.i18n("MAILWEBCLIENT/ERROR_UPLOAD_FORWARD_ATTACHMENTS")))},s.prototype.setAttachTepmNameByHash=function(e,t){o.each(this.attachments(),function(i){i.hash()===e&&(i.tempName(t),i.uploadStarted(!1))})},s.prototype.setMessageDataInNewTab=function(e){this.draftInfo(e.draftInfo),this.draftUid(e.draftUid),this.inReplyTo(e.inReplyTo),this.references(e.references),this.setRecipient(this.toAddr,e.toAddr),this.setRecipient(this.ccAddr,e.ccAddr),this.setRecipient(this.bccAddr,e.bccAddr),this.subject(e.subject),this.attachments(o.map(e.attachments,function(e){var t=new U;return t.parse(e),t},this)),this.plainText(e.plainText),this.textBody(e.textBody),this.selectedImportance(e.selectedImportance),this.sendReadingConfirmation(e.sendReadingConfirmation),this.changedInPreviousWindow(e.changedInPreviousWindow),o.each(this.toolbarControllers(),function(t){o.isFunction(t.doAfterApplyingMainTabParameters)&&t.doAfterApplyingMainTabParameters(e)}),D.changeSenderAccountId(e.senderAccountId,e.selectedFetcherOrIdentity),this.focusedField(e.focusedField)},s.prototype.commit=function(e){this.toAddr.commit(),this.ccAddr.commit(),this.bccAddr.commit(),this.subject.commit(),this.selectedImportance.commit(),this.sendReadingConfirmation.commit(),o.each(this.toolbarControllers(),function(e){o.isFunction(e.commit)&&e.commit()}),this.oHtmlEditor.commit(),this.attachmentsChanged(!1),e||this.changedInPreviousWindow(!1)},s.prototype.isChanged=function(){var e=this.toAddr.changed(),t=this.ccAddr.changed(),i=this.bccAddr.changed(),s=this.subject.changed(),n=this.selectedImportance.changed(),r=this.sendReadingConfirmation.changed(),a=!1,l=this.oHtmlEditor.textChanged(),h=this.attachmentsChanged(),u=this.changedInPreviousWindow();return o.each(this.toolbarControllers(),function(e){o.isFunction(e.isChanged)&&(a=a||e.isChanged())}),e||t||i||s||n||r||a||l||h||u},s.prototype.executeBackToList=function(){d.isNewTab()?window.close():this.shown&&this.shown()&&f.setPreviousHash(),this.backToListOnSendOrSave(!1)},s.prototype.onFileUploadSelect=function(e,t){var i;return!l.showErrorIfAttachmentSizeLimit(t.FileName,u.pInt(t.Size))&&(i=new U,i.onUploadSelect(e,t),this.attachments.push(i),!0)},s.prototype.getAttachmentByUid=function(e){return o.find(this.attachments(),function(t){return t.uploadUid()===e})},s.prototype.onFileUploadStart=function(e){var t=this.getAttachmentByUid(e);t&&t.onUploadStart()},s.prototype.onFileUploadProgress=function(e,t,i){var s=this.getAttachmentByUid(e);s&&s.onUploadProgress(t,i)},s.prototype.onFileUploadComplete=function(e,t,i){var s=this.getAttachmentByUid(e);s&&s.onUploadComplete(e,t,i)},s.prototype.onFileRemove=function(e){var t=this.getAttachmentByUid(e);this.oJua&&this.oJua.cancel(e),this.attachments.remove(t)},s.prototype.initUploader=function(){this.composeShown()&&this.composeUploaderButton()&&null===this.oJua&&(this.oJua=new m({action:"?/Api/",name:"jua-uploader",queueSize:2,clickElement:this.composeUploaderButton(),hiddenElementsPosition:v.IsRTL?"right":"left",dragAndDropElement:this.composeUploaderDropPlace(),disableAjaxUpload:!1,disableFolderDragAndDrop:!1,disableDragAndDrop:!1,hidden:o.extendOwn({Module:R.ServerModuleName,Method:"UploadAttachment",Parameters:function(){return JSON.stringify({AccountID:M.currentAccountId()})}},d.getCommonRequestParameters())}),this.oJua.on("onDragEnter",o.bind(this.composeUploaderDragOver,this,!0)).on("onDragLeave",o.bind(this.composeUploaderDragOver,this,!1)).on("onBodyDragEnter",o.bind(this.composeUploaderBodyDragOver,this,!0)).on("onBodyDragLeave",o.bind(this.composeUploaderBodyDragOver,this,!1)).on("onProgress",o.bind(this.onFileUploadProgress,this)).on("onSelect",o.bind(this.onFileUploadSelect,this)).on("onStart",o.bind(this.onFileUploadStart,this)).on("onComplete",o.bind(this.onFileUploadComplete,this)),this.allowDragNDrop(this.oJua.isDragAndDropSupported()))},s.prototype.getSendSaveParameters=function(e){var t=I.convertAttachmentsForSending(this.attachments()),i=null;return o.each(this.oHtmlEditor.getUploadedImagesData(),function(e){t[e.TempName]=[e.Name,e.CID,"1","1"]}),i={AccountID:this.senderAccountId(),FetcherID:this.selectedFetcherOrIdentity()&&this.selectedFetcherOrIdentity().FETCHER?this.selectedFetcherOrIdentity().id():"",IdentityID:this.selectedFetcherOrIdentity()&&!this.selectedFetcherOrIdentity().FETCHER?this.selectedFetcherOrIdentity().id():"",DraftInfo:this.draftInfo(),DraftUid:this.draftUid(),To:this.toAddr(),Cc:this.ccAddr(),Bcc:this.bccAddr(),Subject:this.subject(),Text:this.plainText()?this.oHtmlEditor.getPlainText():this.oHtmlEditor.getText(e),IsHtml:!this.plainText(),Importance:this.selectedImportance(),SendReadingConfirmation:this.sendReadingConfirmation(),Attachments:t,InReplyTo:this.inReplyTo(),References:this.references()},o.each(this.toolbarControllers(),function(e){o.isFunction(e.doAfterPreparingSendMessageParameters)&&e.doAfterPreparingSendMessageParameters(i)}),i},s.prototype.onSendOrSaveMessageResponse=function(e,t){var i=I.onSendOrSaveMessageResponse(e,t,this.requiresPostponedSending()),n=t.Parameters;switch(this.commit(),i.Method){case"SaveMessage":i.Result&&n.DraftUid===this.draftUid()&&(this.draftUid(u.pString(i.NewUid)),this instanceof s&&f.replaceHashDirectly(F.getComposeFromMessage("drafts",n.DraftFolder,this.draftUid()))),this.saving(!1);break;case"SendMessage":i.Result&&this.backToListOnSendOrSave()&&(o.isFunction(this.closePopup)?this.closePopup():this.executeBackToList()),this.sending(!1)}},s.prototype.verifyDataForSending=function(){var e=a.getIncorrectEmailsFromAddressString(this.toAddr()),t=a.getIncorrectEmailsFromAddressString(this.ccAddr()),i=a.getIncorrectEmailsFromAddressString(this.bccAddr()),s=o.union(e,t,i),n=o.map(s,function(e){return h.encodeHtml(e)}),r=h.i18n("MAILWEBCLIENT/ERROR_INPUT_CORRECT_EMAILS")+n.join(", ");return!(s.length>0)||(S.showPopup(A,[r]),!1)},s.prototype.executeSend=function(e){var t=!1,i=o.bind(function(){this.sending(!0),this.requiresPostponedSending(!this.allowStartSending()),I.send("SendMessage",this.getSendSaveParameters(!0),!0,this.onSendOrSaveMessageResponse,this,this.requiresPostponedSending()),this.backToListOnSendOrSave(!0)},this);this.isEnableSending()&&this.verifyDataForSending()&&(o.each(this.toolbarControllers(),function(e){o.isFunction(e.doBeforeSend)&&(t=t||e.doBeforeSend(i))}),t||i())},s.prototype.executeSaveCommand=function(){this.executeSave(!1)},s.prototype.executeSave=function(e,t){if(e=!!e,t=void 0===t||t,!e||!M.disableComposeAutosave()){var i=t?this.onSendOrSaveMessageResponse:I.onSendOrSaveMessageResponse,s=t?this:I,n=o.bind(function(o){o&&(this.saving(t),I.send("SaveMessage",this.getSendSaveParameters(!1),!e,i,s))},this),r=!1;this.isEnableSaving()&&(e&&!this.isChanged()||(e||o.each(this.toolbarControllers(),function(e){o.isFunction(e.doBeforeSave)&&(r=r||e.doBeforeSave(n))},this),r||n(!0)),this.backToListOnSendOrSave(!0))}},s.prototype.changeBccVisibility=function(){this.visibleBcc(!this.visibleBcc()),this.visibleBcc()?this.focusBccAddr():this.focusToAddr()},s.prototype.changeCcVisibility=function(){this.visibleCc(!this.visibleCc()),this.visibleCc()?this.focusCcAddr():this.focusToAddr()},s.prototype.getMessageDataForNewTab=function(){var e=o.map(this.attachments(),function(e){return{"@Object":"Object/Aurora\\Modules\\Mail\\Classes\\Attachment",FileName:e.fileName(),TempName:e.tempName(),MimeType:e.mimeType(),MimePartIndex:e.mimePartIndex(),EstimatedSize:e.size(),CID:e.cid(),ContentLocation:e.contentLocation(),IsInline:e.inline(),IsLinked:e.linked(),Hash:e.hash()}}),t=null;return t={accountId:this.senderAccountId(),draftInfo:this.draftInfo(),draftUid:this.draftUid(),inReplyTo:this.inReplyTo(),references:this.references(),senderAccountId:this.senderAccountId(),selectedFetcherOrIdentity:this.selectedFetcherOrIdentity(),toAddr:this.toAddr(),ccAddr:this.ccAddr(),bccAddr:this.bccAddr(),subject:this.subject(),attachments:e,plainText:this.plainText(),textBody:this.plainText()?this.oHtmlEditor.getPlainText():this.oHtmlEditor.getText(),selectedImportance:this.selectedImportance(),sendReadingConfirmation:this.sendReadingConfirmation(),changedInPreviousWindow:this.isChanged(),focusedField:this.focusedField()},o.each(this.toolbarControllers(),function(e){o.isFunction(e.doAfterPreparingMainTabParameters)&&e.doAfterPreparingMainTabParameters(t)}),t},s.prototype.openInNewWindow=function(){var e="id"+Math.random(),t={},i=null,s=f.buildHashFromArray(F.getCompose());this.ignoreHasUnsavedChanges(!0),t=this.getMessageDataForNewTab(),this.draftUid().length>0&&!this.isChanged()?(s=f.buildHashFromArray(F.getComposeFromMessage("drafts",M.folderList().draftsFolderFullName(),this.draftUid(),!0)),i=y.openTab("?message-newtab"+s)):this.isChanged()?(N.passComposedMessage(e,t),i=y.openTab("?message-newtab"+s,e)):(this.routeParams().length>0&&(s=f.buildHashFromArray(o.union([R.HashModuleName+"-compose"],this.routeParams()))),i=y.openTab("?message-newtab"+s)),this.commit(),o.isFunction(this.closePopup)?this.closePopup():this.executeBackToList()},s.prototype.onShowFilesPopupClick=function(){this.bAllowFiles&&S.showPopup(C,[o.bind(this.addFilesAsAttachment,this)])},s.prototype.registerOwnToolbarControllers=function(){this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_BackButtonView",sId:"back",bOnlyMobile:!0,backToListCommand:this.backToListCommand}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_SendButtonView",sId:"send",bAllowMobile:!0,sendCommand:this.sendCommand}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_SaveButtonView",sId:"save",bAllowMobile:!0,saveCommand:this.saveCommand}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_ImportanceDropdownView",sId:"importance",selectedImportance:this.selectedImportance}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_ConfirmationCheckboxView",sId:"confirmation",sendReadingConfirmation:this.sendReadingConfirmation})},s.prototype.registerToolbarController=function(e){var t=d.isMobile()?e.bOnlyMobile||e.bAllowMobile:!e.bOnlyMobile,i=R.ComposeToolbarOrder.length;t&&(this.toolbarControllers.push(e),this.toolbarControllers(o.sortBy(this.toolbarControllers(),function(e){var t=o.indexOf(R.ComposeToolbarOrder,e.sId);return t!==-1?t:i})),o.isFunction(e.assignComposeExtInterface)&&e.assignComposeExtInterface(this.getExtInterface()))},s.prototype.getExtInterface=function(){return{isHtml:o.bind(function(){return!this.plainText()},this),hasAttachments:o.bind(function(){return this.notInlineAttachments().length>0},this),getPlainText:o.bind(this.oHtmlEditor.getPlainText,this.oHtmlEditor),getFromEmail:o.bind(function(){return T.getEmail(this.senderAccountId())},this),getRecipientEmails:o.bind(function(){return this.recipientEmails()},this),saveSilently:o.bind(this.executeSave,this,!0),setPlainTextMode:o.bind(this.plainText,this,!0),setPlainText:o.bind(function(e){this.textBody(e)},this),setHtmlTextMode:o.bind(this.plainText,this,!1),setHtmlText:o.bind(function(e){this.textBody(e)},this),undoHtml:o.bind(this.oHtmlEditor.undoAndClearRedo,this.oHtmlEditor)}},e.exports=s},329:function(e,t,i){"use strict";function s(e,t,i,s){var o=r.i18n("MAILWEBCLIENT/TEXT_REPLY_MESSAGE",{DATE:e.oDateModel.getDate(),TIME:e.oDateModel.getTime(),SENDER:r.encodeHtml(e.oFrom.getFull())}),n="<br /><br />"+this.getSignatureText(t,i,s)+'<br /><br /><div data-anchor="reply-title">'+o+"</div><blockquote>"+e.getConvertedHtml()+"</blockquote>";return n}function o(e,t,i){var s=new p,o=n.union(e.oTo.aCollection,e.oCc.aCollection,e.oBcc.aCollection),r=n.find(g.collection(),function(e){return e.id()===t},this),a=new d,l=new d;return a.sEmail=r.email(),l.sEmail=i?i.email():"",s.addCollection(o),s.excludeCollection(n.union(e.oFrom.aCollection,[a,l])),s.getFull()}var n=i(2),r=i(43),a=i(44),l=i(181),h=i(179),u=i(191),c=i(183),d=i(317),p=i(316),m=i(318),g=i(307),f=i(308),b=i(309),v=i(306),y=h.isNewTab()&&window.opener&&window.opener.MainTabMailMethods,E={sReplyText:"",sReplyDraftUid:"",oPostponedMailData:null};E.setReplyData=function(e,t){this.sReplyText=e,this.sReplyDraftUid=t},E.send=function(e,t,i,s,o,n){var l=t.AccountID,h=g.getAccount(l),d=b.oFolderListItems[l],p="",m=d?d.sentFolderFullName():"",v=d?d.draftsFolderFullName():"",E=h?h.email():"",S=t.To.indexOf(E)>-1||t.Cc.indexOf(E)>-1||t.Bcc.indexOf(E)>-1;switch(h.bSaveRepliesToCurrFolder&&!S&&a.isNonEmptyArray(t.DraftInfo,3)&&(m=t.DraftInfo[2]),t.Method=e,t.ShowReport=i,e){case"SendMessage":p=r.i18n("COREWEBCLIENT/INFO_SENDING"),t.SentFolder=m,""!==t.DraftUid&&(t.DraftFolder=v,y?(y.removeOneMessageFromCacheForFolder(t.AccountID,t.DraftFolder,t.DraftUid),y.replaceHashWithoutMessageUid(t.DraftUid)):(b.removeOneMessageFromCacheForFolder(t.AccountID,t.DraftFolder,t.DraftUid),u.replaceHashWithoutMessageUid(t.DraftUid)));break;case"SaveMessage":p=r.i18n("MAILWEBCLIENT/INFO_SAVING"),t.DraftFolder=v,b.savingDraftUid(t.DraftUid),y?(y.startMessagesLoadingWhenDraftSaving(t.AccountID,t.DraftFolder),y.replaceHashWithoutMessageUid(t.DraftUid)):(b.startMessagesLoadingWhenDraftSaving(t.AccountID,t.DraftFolder),u.replaceHashWithoutMessageUid(t.DraftUid))}i&&c.showLoading(p),n?this.postponedMailData={Parameters:t,SendMessageResponseHandler:s,SendMessageResponseContext:o}:f.send(e,t,s,o)},E.sendPostponedMail=function(e){var t=this.postponedMailData,i=t.Parameters,s=i.AccountID,o=b.oFolderListItems[s],n=o?o.draftsFolderFullName():"";""!==e&&(i.DraftUid=e,i.DraftFolder=n,y?(y.removeOneMessageFromCacheForFolder(i.AccountID,i.DraftFolder,i.DraftUid),y.replaceHashWithoutMessageUid(i.DraftUid)):(b.removeOneMessageFromCacheForFolder(i.AccountID,i.DraftFolder,i.DraftUid),u.replaceHashWithoutMessageUid(i.DraftUid))),this.postponedMailData&&(f.send(i.Method,i,t.SendMessageResponseHandler,t.SendMessageResponseContext),this.postponedMailData=null)},E.sendReplyMessage=function(e,t,i,s,o,n){var r=null,a=b.currentMessage(),l=[],h=null;a&&(l=a.oTo.aCollection.concat(a.oCc.aCollection),h=this.getFirstFetcherOrIdentityByRecipientsOrDefault(l,a.accountId()),r=this.getReplyDataFromMessage(a,Enums.ReplyType.ReplyAll,a.accountId(),h,!1,t,i),r.AccountID=a.accountId(),h&&(r.FetcherID=h&&h.FETCHER?h.id():"",r.IdentityID=h&&!h.FETCHER?h.id():""),r.Bcc="",r.Importance=Enums.Importance.Normal,r.SendReadingConfirmation=!1,r.IsQuickReply=!0,r.IsHtml=!0,r.Attachments=this.convertAttachmentsForSending(r.Attachments),this.send(e,r,!1,s,o,n))},E.convertAttachmentsForSending=function(e){var t={};return n.each(e,function(e){t[e.tempName()]=[e.fileName(),e.cid(),e.inline()?"1":"0",e.linked()?"1":"0",e.contentLocation()]}),t},E.onSendOrSaveMessageResponse=function(e,t,i){var s,o,a,h=t.Parameters,u=!!e.Result;switch(i||c.hideLoading(),t.Method){case"SaveMessage":u?(h.ShowReport&&!i&&c.showReport(r.i18n("MAILWEBCLIENT/REPORT_MESSAGE_SAVED")),e.Result.NewUid||(v.AllowAutosaveInDrafts=!1)):h.ShowReport&&l.showErrorByCode(e,r.i18n("MAILWEBCLIENT/ERROR_MESSAGE_SAVING"));break;case"SendMessage":u?(h.IsQuickReply?c.showReport(r.i18n("MAILWEBCLIENT/REPORT_MESSAGE_SENT")):y?y.showReport(r.i18n("MAILWEBCLIENT/REPORT_MESSAGE_SENT")):c.showReport(r.i18n("MAILWEBCLIENT/REPORT_MESSAGE_SENT")),n.isArray(h.DraftInfo)&&3===h.DraftInfo.length&&(a=h.DraftInfo[0],o=h.DraftInfo[1],s=h.DraftInfo[2],b.markMessageReplied(h.AccountID,s,o,a))):l.showErrorByCode(e,r.i18n("MAILWEBCLIENT/ERROR_MESSAGE_SENDING")),h.SentFolder&&(y?y.removeMessagesFromCacheForFolder(h.AccountID,h.SentFolder):b.removeMessagesFromCacheForFolder(h.AccountID,h.SentFolder))}return h.DraftFolder&&!i&&(y?y.removeMessagesFromCacheForFolder(h.AccountID,h.DraftFolder):b.removeMessagesFromCacheForFolder(h.AccountID,h.DraftFolder)),{Method:t.Method,Result:u,NewUid:e.Result?e.Result.NewUid:""}},E.getReplyDataFromMessage=function(e,t,i,r,a,l,h){var u={DraftInfo:[],DraftUid:"",To:"",Cc:"",Bcc:"",Subject:"",Attachments:[],InReplyTo:e.messageId(),References:this.getReplyReferences(e)},c=[],d=e.oReplyTo.getFull(),p=e.oTo.getFull();switch((""===d||e.oFrom.getFirstEmail()===e.oReplyTo.getFirstEmail()&&""===e.oReplyTo.getFirstName())&&(d=e.oFrom.getFull()),l&&""!==l||(l=this.sReplyText,this.sReplyText=""),"forward"===t?u.Text=l+this.getForwardMessageBody(e,i,r):"resend"===t?(u.Text=e.getConvertedHtml(),u.Cc=e.cc(),u.Bcc=e.bcc()):u.Text=l+s.call(this,e,i,r,a),h?u.DraftUid=h:(u.DraftUid=this.sReplyDraftUid,this.sReplyDraftUid=""),t){case Enums.ReplyType.Reply:u.DraftInfo=[Enums.ReplyType.Reply,e.uid(),e.folder()],u.To=d,u.Subject=this.getReplySubject(e.subject(),!0),c=n.filter(e.attachments(),function(e){return e.linked()});break;case Enums.ReplyType.ReplyAll:u.DraftInfo=[Enums.ReplyType.ReplyAll,e.uid(),e.folder()],u.To=d,u.Cc=o(e,i,r),u.Subject=this.getReplySubject(e.subject(),!0),c=n.filter(e.attachments(),function(e){return e.linked()});break;case Enums.ReplyType.Resend:u.DraftInfo=[Enums.ReplyType.Resend,e.uid(),e.folder(),e.cc(),e.bcc()],u.To=p,u.Subject=e.subject(),c=e.attachments();break;case Enums.ReplyType.ForwardAsAttach:case Enums.ReplyType.Forward:u.DraftInfo=[Enums.ReplyType.Forward,e.uid(),e.folder()],u.Subject=this.getReplySubject(e.subject(),!1),c=e.attachments()}return n.each(c,function(e){if(e.getCopy){var t=e.getCopy();u.Attachments.push(t)}}),u},E.getReplyReferences=function(e){var t=e.references(),i=e.messageId(),s=t.indexOf(i);return s===-1&&(t+=" "+i),t},E.getClearSignature=function(e,t){var i=g.getAccount(e),s="";return t&&t.accountId()===e&&t.useSignature()?s=t.signature():i&&i.useSignature()&&(s=i.signature()),s},E.getSignatureText=function(e,t,i){var s=this.getClearSignature(e,t);return i?'<div data-anchor="signature">'+s+"</div>":"<div>"+s+"</div>"},E.getFirstFetcherOrIdentityByRecipientsOrDefault=function(e,t){var i=g.getAccount(t),s=this.getAccountFetchersIdentitiesList(i),o=[],r=null;return n.each(e,function(e){if(!r)switch(o=n.filter(s,function(t){return e.sEmail===t.email}),o.length){case 0:break;case 1:r=o[0];break;default:r=n.find(o,function(t){return e.sEmail===t.email&&e.sName===t.name}),r||(r=n.find(o,function(e){return e.isDefault}),r||(r=o[0]))}}),r||(r=n.find(s,function(e){return e.isDefault})),r&&r.result},E.getAccountFetchersIdentitiesList=function(e){var t=[];return e&&(e.fetchers()&&n.each(e.fetchers().collection(),function(e){t.push({email:e.email(),name:e.userName(),isDefault:!1,result:e})}),n.each(e.identities(),function(e){t.push({email:e.email(),name:e.friendlyName(),isDefault:e.isDefault(),result:e})})),t},E.getForwardMessageBody=function(e,t,i){var s=r.encodeHtml(e.oCc.getFull()),o=""!==s?r.i18n("MAILWEBCLIENT/TEXT_FORWARD_MESSAGE_CCPART",{CCADDR:s}):"",n=r.i18n("MAILWEBCLIENT/TEXT_FORWARD_MESSAGE",{FROMADDR:r.encodeHtml(e.oFrom.getFull()),TOADDR:r.encodeHtml(e.oTo.getFull()),CCPART:o,FULLDATE:e.oDateModel.getFullDate(),SUBJECT:r.encodeHtml(e.subject())}),a="<br /><br />"+this.getSignatureText(t,i,!0)+'<br /><br /><div data-anchor="reply-title">'+n+"</div><br /><br />"+e.getConvertedHtml();return a},E.hasReplyAllCcAddrs=function(e){var t=e.accountId(),i=e.oTo.aCollection.concat(e.oCc.aCollection),s=this.getFirstFetcherOrIdentityByRecipientsOrDefault(i,e.accountId()),n=o(e,t,s);return""!==n},E.getReplySubject=function(e,t){var i=r.i18n("MAILWEBCLIENT/TEXT_REPLY_PREFIX"),s=r.i18n("MAILWEBCLIENT/TEXT_FORWARD_PREFIX"),o=t?i:s,n=o+": "+e;
return v.JoinReplyPrefixes&&(n=m.joinReplyPrefixesInSubject(n,i,s)),n},E.getHtmlFromText=function(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\r/g,"").replace(/\n/g,"<br />")},e.exports=E},330:function(e,t,i){"use strict";var s=i(179),o=i(183),n=i(191),r=i(331),a=i(307),l=i(309),h=[],u=[];if(s.isNewTab()){var c={getEditedDraftUid:function(){return l.editedDraftUid()}};window.SlaveTabMailMethods=c,e.exports={}}else{var d={showReport:function(e){o.showReport(e)},getAccountList:function(){return a},getFolderListItems:function(){return l.oFolderListItems},getUidList:function(){return l.uidList()},getComposedMessageAccountId:function(e){var t=h[e];return t?t.accountId:0},getComposedMessage:function(e){var t=h[e];return delete h[e],t},removeOneMessageFromCacheForFolder:function(e,t,i){l.removeOneMessageFromCacheForFolder(e,t,i)},replaceHashWithoutMessageUid:function(e){n.replaceHashWithoutMessageUid(e)},startMessagesLoadingWhenDraftSaving:function(e,t){l.startMessagesLoadingWhenDraftSaving(e,t)},removeMessagesFromCacheForFolder:function(e,t){l.removeMessagesFromCacheForFolder(e,t)},searchMessagesInCurrentFolder:function(e){l.searchMessagesInCurrentFolder(e)},getReplyData:function(e){var t=u[e];return delete u[e],t},deleteMessage:function(e,t){r.deleteMessages([e],t)}};window.MainTabMailMethods=d,e.exports={passReplyData:function(e,t){u[e]=t},passComposedMessage:function(e,t){h[e]=t}}}},331:function(e,t,i){"use strict";var s=i(1),o=i(43),n=i(177),r=i(217),a=i(45),l=i(184),h=i(185),u=i(309),c={};c.deleteMessages=function(e,t){s.isFunction(t)||(t=function(){});var i=u.folderList(),n=i.currentFolderFullName(),r=i.trashFolder(),a=r&&n===r.fullName(),c=i.spamFolder(),d=c&&n===c.fullName(),p=function(i){i&&(u.deleteMessages(e),t())};d?(u.deleteMessages(e),t()):a?l.showPopup(h,[o.i18n("MAILWEBCLIENT/CONFIRM_DELETE_MESSAGES_PLURAL",{},null,e.length),p,"",o.i18n("COREWEBCLIENT/ACTION_DELETE")]):r?(u.moveMessagesToFolder(r.fullName(),e),t()):r||l.showPopup(h,[o.i18n("MAILWEBCLIENT/CONFIRM_MESSAGES_DELETE_NO_TRASH_FOLDER"),p])},c.registerMailto=function(e){!window.navigator||!s.isFunction(window.navigator.registerProtocolHandler)||e&&1===r.getData("MailtoAsked")||(window.navigator.registerProtocolHandler("mailto",n.getAppPath()+"#compose/to/%s",""!==a.SiteName?a.SiteName:"WebMail"),r.setData("MailtoAsked",1))},e.exports=c},332:function(e,t,i){"use strict";function s(){this.senderList=n.observableArray([]),this.senderAccountId=n.observable(l.currentId()),this.selectedFetcherOrIdentity=n.observable(null),this.lockSelectedSender=n.observable(!1),this.selectedSender=n.observable(""),this.selectedSender.subscribe(function(){if(!this.lockSelectedSender()){var e=l.getAccount(this.senderAccountId()),t=this.selectedSender(),i=null;r.isNonEmptyString(t)&&(0===t.indexOf("fetcher")?e.fetchers()&&(t=t.replace("fetcher",""),i=o.find(e.fetchers().collection(),function(e){return e.id()===r.pInt(t)})):i=o.find(e.identities(),function(e){return e.id()===r.pInt(t)})),i&&this.selectedFetcherOrIdentity(i)}},this)}var o=i(2),n=i(46),r=i(44),a=i(329),l=i(307);s.prototype.changeSelectedSender=function(e){if(e){var t=r.pString(e.id());e.FETCHER&&(t="fetcher"+t),o.find(this.senderList(),function(e){return e.id===t})&&(this.lockSelectedSender(!0),this.selectedSender(t),this.selectedFetcherOrIdentity(e),this.lockSelectedSender(!1))}},s.prototype.changeSenderAccountId=function(e,t){var i=!1;this.senderAccountId()!==e&&(l.hasAccountWithId(e)?(this.senderAccountId(e),i=!0):l.hasAccountWithId(this.senderAccountId())||(this.senderAccountId(l.currentId()),i=!0)),(i||0===this.senderList().length)&&(this.fillSenderList(t),i=!0),!i&&t&&this.changeSelectedSender(t)},s.prototype.fillSenderList=function(e){var t=[],i=l.getAccount(this.senderAccountId());i&&(o.isArray(i.identities())&&o.each(i.identities(),function(e){t.push({fullEmail:e.fullEmail(),id:r.pString(e.id())})},this),i.identitiesSubscribtion||(i.identitiesSubscribtion=i.identities.subscribe(function(t){this.fillSenderList(e),this.changeSelectedSender(i.getDefaultIdentity())},this)),i.fetchers()?o.each(i.fetchers().collection(),function(e){var i=e.fullEmail();e.isOutgoingEnabled()&&i.length>0&&t.push({fullEmail:i,id:"fetcher"+e.id()})},this):i.fetchersSubscribtion||(i.fetchersSubscribtion=i.fetchers.subscribe(function(){this.fillSenderList(e)},this))),this.senderList(t),this.changeSelectedSender(e)},s.prototype.setFetcherOrIdentityByReplyMessage=function(e){var t=e.oTo.aCollection.concat(e.oCc.aCollection),i=a.getFirstFetcherOrIdentityByRecipientsOrDefault(t,e.accountId());i&&this.changeSelectedSender(i)},e.exports=new s},333:function(e,t,i){"use strict";function s(e,t){this.oParent=t,this.creaId="creaId"+(""+Math.random()).replace(".",""),this.textFocused=r.observable(!1),this.workareaDom=r.observable(),this.uploaderAreaDom=r.observable(),this.editorUploaderBodyDragOver=r.observable(!1),this.htmlEditorDom=r.observable(),this.toolbarDom=r.observable(),this.colorPickerDropdownDom=r.observable(),this.insertLinkDropdownDom=r.observable(),this.insertImageDropdownDom=r.observable(),this.isFWBold=r.observable(!1),this.isFSItalic=r.observable(!1),this.isTDUnderline=r.observable(!1),this.isTDStrikeThrough=r.observable(!1),this.isEnumeration=r.observable(!1),this.isBullets=r.observable(!1),this.isEnable=r.observable(!0),this.isEnable.subscribe(function(){this.oCrea&&this.oCrea.setEditable(this.isEnable())},this),this.bInsertImageAsBase64=e,this.bAllowFileUpload=!(e&&void 0===window.File),this.bAllowInsertImage=y.AllowInsertImage,this.lockFontSubscribing=r.observable(!1),this.bAllowImageDragAndDrop=!c.ie10AndAbove,this.aFonts=["Arial","Arial Black","Courier New","Tahoma","Times New Roman","Verdana"],this.sDefaultFont=y.DefaultFontName,this.correctFontFromSettings(),this.selectedFont=r.observable(""),this.selectedFont.subscribe(function(){!this.oCrea||this.lockFontSubscribing()||this.inactive()||this.oCrea.fontName(this.selectedFont())},this),this.iDefaultSize=y.DefaultFontSize,this.selectedSize=r.observable(0),this.selectedSize.subscribe(function(){!this.oCrea||this.lockFontSubscribing()||this.inactive()||this.oCrea.fontSize(this.selectedSize())},this),this.visibleInsertLinkPopup=r.observable(!1),this.linkForInsert=r.observable(""),this.linkFocused=r.observable(!1),this.visibleLinkPopup=r.observable(!1),this.linkPopupDom=r.observable(null),this.linkHrefDom=r.observable(null),this.linkHref=r.observable(""),this.visibleLinkHref=r.observable(!1),this.visibleImagePopup=r.observable(!1),this.visibleImagePopup.subscribe(function(){this.onImageOut()},this),this.imagePopupTop=r.observable(0),this.imagePopupLeft=r.observable(0),this.imageSelected=r.observable(!1),this.tooltipText=r.observable(""),this.tooltipPopupTop=r.observable(0),this.tooltipPopupLeft=r.observable(0),this.visibleInsertImagePopup=r.observable(!1),this.imageUploaderButton=r.observable(null),this.aUploadedImagesData=[],this.imagePathFromWeb=r.observable(""),this.visibleFontColorPopup=r.observable(!1),this.oFontColorPickerView=new E(l.i18n("MAILWEBCLIENT/LABEL_TEXT_COLOR"),this.setTextColorFromPopup,this),this.oBackColorPickerView=new E(l.i18n("MAILWEBCLIENT/LABEL_BACKGROUND_COLOR"),this.setBackColorFromPopup,this),this.inactive=r.observable(!1),this.sPlaceholderText="",this.bAllowChangeInputDirection=p.IsRTL||y.AllowChangeInputDirection,this.disableEdit=r.observable(!1),this.textChanged=r.observable(!1)}var o=i(2),n=i(1),r=i(46),a=i(201),l=i(43),h=i(44),u=i(179),c=i(178),d=i(271),p=i(45),m=i(184),g=i(190),f=i(319),b=i(334),v=i(309),y=i(306),E=i(335);s.prototype.ViewTemplate="MailWebclient_HtmlEditorView",s.prototype.setInactive=function(e){this.inactive(e),this.inactive()?this.setPlaceholder():this.removePlaceholder()},s.prototype.setPlaceholder=function(){var e=this.removeAllTags(this.getText());""!==e&&"&nbsp;"!==e||(this.setText("<span>"+this.sPlaceholderText+"</span>"),this.oCrea&&this.oCrea.setBlur())},s.prototype.removePlaceholder=function(){var e=this.oCrea?this.removeAllTags(this.oCrea.getText(!1)):"";e===this.sPlaceholderText&&(this.setText(""),this.oCrea&&this.oCrea.setFocus(!0))},s.prototype.hasOpenedPopup=function(){return this.visibleInsertLinkPopup()||this.visibleLinkPopup()||this.visibleImagePopup()||this.visibleInsertImagePopup()||this.visibleFontColorPopup()},s.prototype.setDisableEdit=function(e){this.disableEdit(!!e)},s.prototype.correctFontFromSettings=function(){var e=this.sDefaultFont,t=!1;o.each(this.aFonts,function(i){i.toLowerCase()===e.toLowerCase()&&(e=i,t=!0)}),t?this.sDefaultFont=e:this.aFonts.push(e)},s.prototype.showLinkPopup=function(e){var t=n(this.workareaDom()),i=t.closest(".panel.compose"),s=t.position(),o=e.position(),r=e.height(),a=Math.round(o.left+s.left),l=Math.round(o.top+r+s.top);this.linkHref(e.attr("href")||e.text()),n(this.linkPopupDom()).css({left:a,top:l}),n(this.linkHrefDom()).css({left:a,top:l}),c.firefox||1!==i.length||n(this.linkPopupDom()).css({"max-width":i.width()-a-40+"px","white-space":"pre-line","word-wrap":"break-word"}),this.visibleLinkPopup(!0)},s.prototype.hideLinkPopup=function(){this.visibleLinkPopup(!1)},s.prototype.showChangeLink=function(){this.visibleLinkHref(!0),this.hideLinkPopup()},s.prototype.changeLink=function(){this.oCrea.changeLink(this.linkHref()),this.hideChangeLink()},s.prototype.hideChangeLink=function(){this.visibleLinkHref(!1)},s.prototype.showImagePopup=function(e,t){var i=n(this.workareaDom()),s=i.position(),o=i.offset();this.imagePopupLeft(Math.round(t.pageX+s.left-o.left)),this.imagePopupTop(Math.round(t.pageY+s.top-o.top)),this.visibleImagePopup(!0)},s.prototype.hideImagePopup=function(){this.visibleImagePopup(!1)},s.prototype.resizeImage=function(e){var t={width:"auto",height:"auto"};switch(e){case Enums.HtmlEditorImageSizes.Small:t.width="300px";break;case Enums.HtmlEditorImageSizes.Medium:t.width="600px";break;case Enums.HtmlEditorImageSizes.Large:t.width="1200px";break;case Enums.HtmlEditorImageSizes.Original:t.width="auto"}this.oCrea.changeCurrentImage(t),this.visibleImagePopup(!1)},s.prototype.onImageOver=function(e){if("IMG"===e.target.nodeName&&!this.visibleImagePopup()){this.imageSelected(!0),this.tooltipText(l.i18n("MAILWEBCLIENT/ACTION_CLICK_TO_EDIT_IMAGE"));var t=this,i=n(this.workareaDom());i.bind("mousemove.image",function(e){var s=i.position(),o=i.offset();t.tooltipPopupTop(Math.round(e.pageY+s.top-o.top)),t.tooltipPopupLeft(Math.round(e.pageX+s.left-o.left))})}return!0},s.prototype.onImageOut=function(e){if(this.imageSelected()){this.imageSelected(!1);var t=n(this.workareaDom());t.unbind("mousemove.image")}return!0},s.prototype.commit=function(){this.textChanged(!1)},s.prototype.init=function(e,t,i,s){this.sPlaceholderText=s||"",this.oCrea?(this.oCrea.$container=n("#"+this.oCrea.oOptions.creaId),0===this.oCrea.$container.children().length&&this.oCrea.start(this.isEnable())):(n(document.body).on("click",o.bind(function(e){var t=n(e.target).parents("span.dropdown_helper");0===t.length&&this.closeAllPopups(!0)},this)),this.initEditorUploader(),this.oCrea=new b({creaId:this.creaId,fontNameArray:this.aFonts,defaultFontName:this.sDefaultFont,defaultFontSize:this.iDefaultSize,isRtl:p.IsRTL,enableDrop:!1,onChange:o.bind(this.textChanged,this,!0),onCursorMove:o.bind(this.setFontValuesFromText,this),onFocus:o.bind(this.onCreaFocus,this),onBlur:o.bind(this.onCreaBlur,this),onUrlIn:o.bind(this.showLinkPopup,this),onUrlOut:o.bind(this.hideLinkPopup,this),onImageSelect:o.bind(this.showImagePopup,this),onImageBlur:o.bind(this.hideImagePopup,this),onItemOver:c.mobileDevice||u.isMobile()?null:o.bind(this.onImageOver,this),onItemOut:c.mobileDevice||u.isMobile()?null:o.bind(this.onImageOut,this),openInsertLinkDialog:o.bind(this.insertLink,this),onUrlClicked:!0}),this.oCrea.start(this.isEnable())),this.oCrea.setTabIndex(i),this.clearUndoRedo(),this.setText(e,t),this.setFontValuesFromText(),this.aUploadedImagesData=[],this.selectedFont(this.sDefaultFont),this.selectedSize(this.iDefaultSize)},s.prototype.isInitialized=function(){return!!this.oCrea},s.prototype.setFocus=function(){this.oCrea&&this.oCrea.setFocus(!1)},s.prototype.changeSignatureContent=function(e,t){this.oCrea&&this.oCrea.changeSignatureContent(e,t)},s.prototype.setFontValuesFromText=function(){this.lockFontSubscribing(!0),this.isFWBold(this.oCrea.getIsBold()),this.isFSItalic(this.oCrea.getIsItalic()),this.isTDUnderline(this.oCrea.getIsUnderline()),this.isTDStrikeThrough(this.oCrea.getIsStrikeThrough()),this.isEnumeration(this.oCrea.getIsEnumeration()),this.isBullets(this.oCrea.getIsBullets()),this.selectedFont(this.oCrea.getFontName()),this.selectedSize(""+this.oCrea.getFontSizeInNumber()),this.lockFontSubscribing(!1)},s.prototype.isUndoAvailable=function(){return!!this.oCrea&&this.oCrea.isUndoAvailable()},s.prototype.getPlainText=function(){return this.oCrea?this.oCrea.getPlainText():""},s.prototype.getText=function(e){var t=this.oCrea?this.oCrea.getText(e):"";return""!==this.sPlaceholderText&&this.removeAllTags(t)===this.sPlaceholderText?"":t},s.prototype.setText=function(e,t){this.oCrea&&(t?this.oCrea.setPlainText(e):this.oCrea.setText(e),this.inactive()&&""===e&&this.setPlaceholder())},s.prototype.undoAndClearRedo=function(){this.oCrea&&(this.oCrea.undo(),this.oCrea.clearRedo())},s.prototype.clearUndoRedo=function(){this.oCrea&&this.oCrea.clearUndoRedo()},s.prototype.isEditing=function(){return!!this.oCrea&&this.oCrea.bEditing},s.prototype.removeAllTags=function(e){return e.replace(/<style>.*<\/style>/g,"").replace(/<[^>]*>/g,"")},s.prototype.onCreaFocus=function(){this.oCrea&&(this.closeAllPopups(),this.textFocused(!0))},s.prototype.onCreaBlur=function(){this.oCrea&&this.textFocused(!1)},s.prototype.onEscHandler=function(){m.hasOpenedMaximizedPopups()||this.closeAllPopups()},s.prototype.closeAllPopups=function(e){e=!!e,e||this.visibleLinkPopup(!1),this.visibleInsertLinkPopup(!1),this.visibleImagePopup(!1),this.visibleInsertImagePopup(!1),this.visibleFontColorPopup(!1)},s.prototype.insertHtml=function(e){this.oCrea&&(this.oCrea.isFocused()||this.oCrea.setFocus(!0),this.oCrea.insertHtml(e,!1))},s.prototype.insertLink=function(e,t){this.inactive()||this.visibleInsertLinkPopup()||(t.stopPropagation(),this.linkForInsert(this.oCrea.getSelectedText()),this.closeAllPopups(),this.visibleInsertLinkPopup(!0),this.linkFocused(!0))},s.prototype.insertLinkFromPopup=function(e,t){this.linkForInsert().length>0&&(a.isCorrectEmail(this.linkForInsert())?this.oCrea.insertEmailLink(this.linkForInsert()):this.oCrea.insertLink(this.linkForInsert())),this.closeInsertLinkPopup(e,t)},s.prototype.closeInsertLinkPopup=function(e,t){this.visibleInsertLinkPopup(!1),t&&t.stopPropagation()},s.prototype.textColor=function(e,t){this.inactive()||(this.closeAllPopups(),this.visibleFontColorPopup()||(t.stopPropagation(),this.visibleFontColorPopup(!0),this.oFontColorPickerView.onShow(),this.oBackColorPickerView.onShow()))},s.prototype.colorToHex=function(e){if("#"===e.substr(0,1))return e;for(var t=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(e),i=h.pInt(t[2]),s=h.pInt(t[3]),o=h.pInt(t[4]),n=o|s<<8|i<<16,r=n.toString(16);r.length<6;)r="0"+r;return t[1]+"#"+r},s.prototype.setTextColorFromPopup=function(e){this.oCrea.textColor(this.colorToHex(e)),this.closeAllPopups()},s.prototype.setBackColorFromPopup=function(e){this.oCrea.backgroundColor(this.colorToHex(e)),this.closeAllPopups()},s.prototype.insertImage=function(e,t){return this.inactive()||!y.AllowInsertImage||this.visibleInsertImagePopup()||(t.stopPropagation(),this.imagePathFromWeb(""),this.closeAllPopups(),this.visibleInsertImagePopup(!0),this.initUploader()),!0},s.prototype.insertWebImageFromPopup=function(e,t){y.AllowInsertImage&&this.imagePathFromWeb().length>0&&this.oCrea.insertImage(this.imagePathFromWeb()),this.closeInsertImagePopup(e,t)},s.prototype.insertComputerImageFromPopup=function(e,t){var i=new f,s="",o=!1;i.parse(t),s=i.getActionUrl("view"),y.AllowInsertImage&&s.length>0&&(o=this.oCrea.insertImage(s),o&&(n(this.oCrea.$editableArea).find('img[src="'+s+'"]').attr("data-x-src-cid",e),t.CID=e,this.aUploadedImagesData.push(t))),this.closeInsertImagePopup()},s.prototype.getUploadedImagesData=function(){return this.aUploadedImagesData},s.prototype.closeInsertImagePopup=function(e,t){this.visibleInsertImagePopup(!1),t&&t.stopPropagation()},s.prototype.initUploader=function(){this.imageUploaderButton()&&!this.oJua&&(this.oJua=new d({action:"?/Api/",name:"jua-uploader",queueSize:2,clickElement:this.imageUploaderButton(),hiddenElementsPosition:p.IsRTL?"right":"left",disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!0,hidden:o.extendOwn({Module:y.ServerModuleName,Method:"UploadAttachment",Parameters:function(){return JSON.stringify({AccountID:v.currentAccountId()})}},u.getCommonRequestParameters())}),this.bInsertImageAsBase64?this.oJua.on("onSelect",o.bind(this.onEditorDrop,this)):this.oJua.on("onSelect",o.bind(this.onFileUploadSelect,this)).on("onComplete",o.bind(this.onFileUploadComplete,this)))},s.prototype.initEditorUploader=function(){if(y.AllowInsertImage&&this.uploaderAreaDom()&&!this.editorUploader){var e=null,t=null;this.oParent&&this.oParent.composeUploaderDragOver&&this.oParent.onFileUploadProgress&&this.oParent.onFileUploadStart&&this.oParent.onFileUploadComplete?(e=o.bind(function(){this.editorUploaderBodyDragOver(!0),this.oParent.composeUploaderDragOver(!0)},this),t=o.bind(function(){this.editorUploaderBodyDragOver(!1),this.oParent.composeUploaderDragOver(!1)},this),this.editorUploader=new d({action:"?/Api/",name:"jua-uploader",queueSize:1,dragAndDropElement:this.bAllowImageDragAndDrop?this.uploaderAreaDom():null,disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!this.bAllowImageDragAndDrop,hidden:o.extendOwn({Module:y.ServerModuleName,Method:"UploadAttachment",Parameters:function(){return JSON.stringify({AccountID:v.currentAccountId()})}},u.getCommonRequestParameters())}),this.editorUploader.on("onDragEnter",o.bind(this.oParent.composeUploaderDragOver,this.oParent,!0)).on("onDragLeave",o.bind(this.oParent.composeUploaderDragOver,this.oParent,!1)).on("onBodyDragEnter",e).on("onBodyDragLeave",t).on("onProgress",o.bind(this.oParent.onFileUploadProgress,this.oParent)).on("onSelect",o.bind(this.onEditorDrop,this)).on("onStart",o.bind(this.oParent.onFileUploadStart,this.oParent)).on("onComplete",o.bind(this.oParent.onFileUploadComplete,this.oParent))):(e=o.bind(this.editorUploaderBodyDragOver,this,!0),t=o.bind(this.editorUploaderBodyDragOver,this,!1),this.editorUploader=new d({queueSize:1,dragAndDropElement:this.bAllowImageDragAndDrop?this.uploaderAreaDom():null,disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!this.bAllowImageDragAndDrop}),this.editorUploader.on("onBodyDragEnter",e).on("onBodyDragLeave",t).on("onSelect",o.bind(this.onEditorDrop,this)))}},s.prototype.isDragAndDropSupported=function(){return!!this.editorUploader&&this.editorUploader.isDragAndDropSupported()},s.prototype.onEditorDrop=function(e,t){var i=null,s=null,o=this,n=!1,r=""+Math.random(),a="";if(t&&t.File&&"string"==typeof t.File.type)if(y.AllowInsertImage&&0===t.File.type.indexOf("image/"))s=t.File,y.ImageUploadSizeLimit>0&&s.size>y.ImageUploadSizeLimit?m.showPopup(g,[l.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE")]):(i=new window.FileReader,n=this.oCrea.isFocused(),n||this.oCrea.setFocus(!0),a=s.name+"_"+r,this.oCrea.insertHtml('<img id="'+a+'" src="./static/styles/images/wait.gif" />',!0),n||this.oCrea.fixFirefoxCursorBug(),i.onload=function(e){o.oCrea.changeImageSource(a,e.target.result)},i.readAsDataURL(s));else{if(this.oParent&&this.oParent.onFileUploadSelect)return this.oParent.onFileUploadSelect(e,t),!0;c.ie10AndAbove||m.showPopup(g,[l.i18n("MAILWEBCLIENT/ERROR_NOT_IMAGE_CHOOSEN")])}return!1},s.prototype.isFileImage=function(e){if("string"==typeof e.Type)return-1!==e.Type.indexOf("image");var t=e.FileName.lastIndexOf("."),i=e.FileName.substr(t+1),s=["jpg","jpeg","gif","tif","tiff","png"];return-1!==n.inArray(i,s)},s.prototype.onFileUploadSelect=function(e,t){return this.isFileImage(t)?(this.closeInsertImagePopup(),!0):(m.showPopup(g,[l.i18n("MAILWEBCLIENT/ERROR_NOT_IMAGE_CHOOSEN")]),!1)},s.prototype.onFileUploadComplete=function(e,t,i){var s="";i&&i.Result?i.Result.Error?(s="size"===i.Result.Error?l.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE"):l.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN"),m.showPopup(g,[s])):(this.oCrea.setFocus(!0),this.insertComputerImageFromPopup(e,i.Result.Attachment)):m.showPopup(g,[l.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN")])},s.prototype.undo=function(){return this.inactive()||this.oCrea.undo(),!1},s.prototype.redo=function(){return this.inactive()||this.oCrea.redo(),!1},s.prototype.bold=function(){return this.inactive()||(this.oCrea.bold(),this.isFWBold(!this.isFWBold())),!1},s.prototype.italic=function(){return this.inactive()||(this.oCrea.italic(),this.isFSItalic(!this.isFSItalic())),!1},s.prototype.underline=function(){return this.inactive()||(this.oCrea.underline(),this.isTDUnderline(!this.isTDUnderline())),!1},s.prototype.strikeThrough=function(){return this.inactive()||(this.oCrea.strikeThrough(),this.isTDStrikeThrough(!this.isTDStrikeThrough())),!1},s.prototype.numbering=function(){return this.inactive()||(this.oCrea.numbering(),this.isBullets(!1),this.isEnumeration(!this.isEnumeration())),!1},s.prototype.bullets=function(){return this.inactive()||(this.oCrea.bullets(),this.isEnumeration(!1),this.isBullets(!this.isBullets())),!1},s.prototype.removeFormat=function(){return this.inactive()||this.oCrea.removeFormat(),!1},s.prototype.setRtlDirection=function(){return this.inactive()||this.oCrea.setRtlDirection(),!1},s.prototype.setLtrDirection=function(){return this.inactive()||this.oCrea.setLtrDirection(),!1},e.exports=s},334:function(e,t,i){"use strict";function s(e){this.oOptions=o.extend({creaId:"creaId",fontNameArray:["Tahoma"],defaultFontName:"Tahoma",defaultFontSize:3,dropableArea:null,isRtl:!1,onChange:function(){},onCursorMove:function(){},onFocus:function(){},onBlur:function(){},onUrlIn:function(){},onUrlOut:function(){},onImageSelect:function(){},onImageBlur:function(){},onItemOver:null,onItemOut:null,openInsertLinkDialog:function(){},onUrlClicked:!1},void 0===e?{}:e)}var o=i(2),n=i(1),r=i(44),a=i(178);s.prototype.oOptions={},s.prototype.$container=null,s.prototype.$editableArea=null,s.prototype.aEditableAreaHtml=[],s.prototype.iUndoRedoPosition=0,s.prototype.bEditable=!1,s.prototype.bFocused=!1,s.prototype.bEditing=!1,s.prototype.aSizes=[{inNumber:1,inPixels:10},{inNumber:2,inPixels:13},{inNumber:3,inPixels:16},{inNumber:4,inPixels:18},{inNumber:5,inPixels:24},{inNumber:6,inPixels:32},{inNumber:7,inPixels:48}],s.prototype.bInUrl=!1,s.prototype.oCurrLink=null,s.prototype.oCurrImage=null,s.prototype.bInImage=!1,s.prototype.sBasicFontName="",s.prototype.sBasicFontSize="",s.prototype.sBasicDirection="",s.prototype.start=function(e){function t(e){var t=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/;return t.test(e)}function i(e){return!!e.match(/^[A-Z0-9\"!#\$%\^\{\}`~&'\+\-=_\.]+@[A-Z0-9\.\-]+$/i)}this.$container=n("#"+this.oOptions.creaId),this.$editableArea=n("<div></div>").addClass("crea-content-editable").prop("contentEditable","true").appendTo(this.$container);var s=this;this.$editableArea.on("focus",function(){s.bFocused=!0}),this.$editableArea.on("blur",function(){s.bFocused=!1}),this.$editableArea.on("click","img",function(e){var t=n(this);s.bInImage=!0,s.oCurrImage=t,s.oOptions.onImageSelect(t,e),e.stopPropagation()}),this.$editableArea.on("click",function(e){s.bInImage=!1,s.oCurrImage=null,s.oOptions.onImageBlur()}),null!==s.oOptions.onItemOver&&this.$editableArea.on("mouseover",function(e){s.oOptions.onItemOver(e)}),null!==s.oOptions.onItemOver&&this.$editableArea.on("mouseout",function(e){s.oOptions.onItemOut(e)}),this.$editableArea.on("cut paste",function(){s.bEditing=!0,s.editableSave(),o.defer(function(){s.editableSave()})}),this.$editableArea.on("paste",function(e){if(e=e.originalEvent||e,e.clipboardData){var o,n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("text/html");s.pasteImage(e)?e.preventDefault():t(n)?(e.preventDefault(),s.execCom("insertHTML",'<a href="'+n+'">'+n+"</a>")):i(n)?(e.preventDefault(),s.execCom("insertHTML",'<a href="mailto:'+n+'">'+n+"</a>")):""!==r&&(e.preventDefault(),o=r.split(/<!--StartFragment-->|<!--EndFragment-->/gi),3===o.length&&(r=o[1]),r=s.replacePToBr(r),s.execCom("insertHTML",r))}}),this.$editableArea.on("keydown",function(e){var o=e.keyCode||e.which||e.charCode||0,n=e.ctrlKey||e.metaKey,r=e.altKey,a=e.shiftKey,l="";if(s.bEditing=!0,a&&n&&o===Enums.Key.z||n&&o===Enums.Key.y)e.preventDefault(),s.editableRedo();else if(n&&!r&&o===Enums.Key.z)e.preventDefault(),s.editableUndo();else if(!n||o!==Enums.Key.k&&o!==Enums.Key.b&&o!==Enums.Key.i&&o!==Enums.Key.u)r||a||n||o!==Enums.Key.Del&&o!==Enums.Key.Backspace||s.editableSave();else switch(e.preventDefault(),o){case Enums.Key.k:l=s.getSelectedText(),t(l)?s.insertLink(l):i(l)?s.insertLink("mailto:"+l):s.oOptions.openInsertLinkDialog();break;case Enums.Key.b:s.bold();break;case Enums.Key.i:s.italic();break;case Enums.Key.u:s.underline()}}),this.$editableArea.on("keyup",function(e){var t=e.keyCode||e.which||e.charCode||0,i=e.ctrlKey||e.metaKey,o=e.altKey,n=e.shiftKey;o||n||i||(t===Enums.Key.Space||t===Enums.Key.Enter||t===Enums.Key.Del||t===Enums.Key.Backspace?s.editableSave():s.oOptions.onChange())}),this.initContentEditable(),this.setEditable(e)},s.prototype.clearUndoRedo=function(){this.aEditableAreaHtml=[],this.iUndoRedoPosition=0,this.bEditing=!1},s.prototype.isUndoAvailable=function(){return this.iUndoRedoPosition>0},s.prototype.clearRedo=function(){this.aEditableAreaHtml=this.aEditableAreaHtml.slice(0,this.iUndoRedoPosition+1)},s.prototype.editableSave=function(){var e=this.$editableArea.html(),t=o.last(this.aEditableAreaHtml),i=t?t[0]:"";e!==i&&(this.clearRedo(),this.aEditableAreaHtml.push([e,this.getCaretPos(this.$editableArea[0])]),this.iUndoRedoPosition=this.aEditableAreaHtml.length-1,this.oOptions.onChange())},s.prototype.editableUndo=function(){var e=this.$editableArea.html(),t=this.aEditableAreaHtml[this.iUndoRedoPosition],i=t?t[0]:"";e!==i&&this.editableSave(),this.iUndoRedoPosition>0&&(this.iUndoRedoPosition--,this.$editableArea.html(this.aEditableAreaHtml[this.iUndoRedoPosition]),this.setCaretPos(this.$editableArea[0],this.aEditableAreaHtml[this.iUndoRedoPosition][1]))},s.prototype.editableRedo=function(){this.iUndoRedoPosition<this.aEditableAreaHtml.length-1&&(this.iUndoRedoPosition++,this.$editableArea.html(this.aEditableAreaHtml[this.iUndoRedoPosition]),this.setCaretPos(this.$editableArea[0],this.aEditableAreaHtml[this.iUndoRedoPosition]?this.aEditableAreaHtml[this.iUndoRedoPosition][1]:{}))},s.prototype.getCaretPos=function(e){var t=null,i={},s={},o=0,n={};return window.getSelection&&document.createRange?(t=window.getSelection(),t.rangeCount>0&&(i=t.getRangeAt(0),s=i.cloneRange(),s.selectNodeContents(e),s.setEnd(i.startContainer,i.startOffset),o=(""+s).length,n={start:o,end:o+(""+i).length})):document.selection&&document.body.createTextRange&&(i=document.selection.createRange(),s=document.body.createTextRange(),s.moveToElementText(e),"function"==typeof s.setEndPoint&&s.setEndPoint("EndToStart",i),o=s.text.length,n={start:o,end:o+i.text.length}),n},s.prototype.setCaretPos=function(e,t){if(window.getSelection&&document.createRange){var i=[e],s={},o={},n=!1,r=!1,a=0,l=0,h=0,u=document.createRange();for(u.setStart(e,0),u.collapse(!0),s=i.pop();!r&&s;){if(3===s.nodeType)l=a+s.length,!n&&t.start>=a&&t.start<=l&&(u.setStart(s,t.start-a),n=!0),n&&t.end>=a&&t.end<=l&&(u.setEnd(s,t.end-a),r=!0),a=l;else for(h=s.childNodes.length;h--;)i.push(s.childNodes[h]);s=i.pop()}o=window.getSelection(),o.removeAllRanges(),o.addRange(u)}else if(document.selection&&document.body.createTextRange){var c=document.body.createTextRange();c.moveToElementText(e),c.collapse(!0),c.moveEnd("character",t.end),c.moveStart("character",t.start),c.select()}},s.prototype.setTabIndex=function(e){e&&this.$editableArea.attr("tabindex",e)},s.prototype.initContentEditable=function(){this.$editableArea.bind({mousemove:o.bind(this.storeSelectionPosition,this),mouseup:o.bind(this.onCursorMove,this),keydown:o.bind(this.onButtonPressed,this),keyup:o.bind(this.onCursorMove,this),click:o.bind(this.onClickWith,this),focus:this.oOptions.onFocus,blur:this.oOptions.onBlur}),window.File&&window.FileReader&&window.FileList&&this.oOptions.enableDrop&&this.$editableArea.bind({dragover:o.bind(this.onDragOver,this),dragleave:o.bind(this.onDragLeave,this),drop:o.bind(this.onFileSelect,this)});var e=this,t=o.debounce(function(){e.oCurrLink=null,e.bInUrl=!1,e.oOptions.onUrlOut()},300);n("html, body").on("scroll",t)},s.prototype.onCursorMove=function(e){var t=-1;window.event?t=window.event.keyCode:e&&(t=e.which),13===t&&this.breakQuotes(e),17===t&&this.$editableArea.find("a").css("cursor","inherit"),8===t&&this.uniteWithNextQuote(e),46===t&&a.chrome&&this.uniteWithPrevQuote(e),this.storeSelectionPosition(),this.oOptions.onCursorMove()},s.prototype.onClickWith=function(e){e.ctrlKey&&"A"===e.target.nodeName&&window.open(e.target.href,"_blank"),this.checkAnchorNode()},s.prototype.onButtonPressed=function(e){var t=-1;window.event?t=window.event.keyCode:e&&(t=e.which),17===t&&this.$editableArea.find("a").css("cursor","pointer")},s.prototype.onFileSelect=function(e){if(e=(e&&e.originalEvent?e.originalEvent:e)||window.event){e.stopPropagation(),e.preventDefault();var t=null,i=null,s=e.files||(e.dataTransfer?e.dataTransfer.files:null),o=this;s&&1===s.length&&this.checkIsImage(s[0])&&(i=s[0],t=new window.FileReader,t.onload=function(){return function(e){o.insertImage(e.target.result)}}(),t.readAsDataURL(i))}},s.prototype.onDragLeave=function(){this.$editableArea.removeClass("editorDragOver")},s.prototype.onDragOver=function(e){e.stopPropagation(),e.preventDefault(),this.$editableArea.addClass("editorDragOver")},s.prototype.pasteImage=function(e){var t=e.clipboardData&&e.clipboardData.items,i=this,s=!1;return window.File&&window.FileReader&&window.FileList&&t&&o.each(t,function(e){if(i.checkIsImage(e)&&e.getAsFile){var t=null,o=e.getAsFile();o&&(t=new window.FileReader,t.onload=function(){return function(e){i.insertImage(e.target.result)}}(),t.readAsDataURL(o),s=!0)}}),s},s.prototype.checkIsImage=function(e){return e&&e.type&&0===e.type.indexOf("image/")},s.prototype.setPlainText=function(e){"string"!=typeof e&&(e=""),this.$editableArea&&(this.$editableArea.empty().text(e).css("white-space","pre"),this.editableSave())},s.prototype.setText=function(e){if("string"!=typeof e&&(e=""),this.$editableArea){0===e.length&&(e="<br />");var t=n(e),i=n(e),s=i.children(),o=s.first(),r=1===i.length&&"font-wrapper"===i.data("crea"),a=1===i.length&&1===s.length&&"body"===i.data("xDivType")&&"font-wrapper"===o.data("crea");r?(this.setBasicStyles(i.css("font-family"),i.css("font-size"),i.css("direction")),t=i.contents()):a?(this.setBasicStyles(o.css("font-family"),o.css("font-size"),o.css("direction")),t=o.contents()):this.setBasicStyles(this.oOptions.defaultFontName,this.convertFontSizeToPixels(this.oOptions.defaultFontSize),this.oOptions.isRtl?"rtl":"ltr"),this.$editableArea.empty().append(t).css("white-space","normal"),this.editableSave()}},s.prototype.setBasicStyles=function(e,t,i){this.sBasicFontName=e,this.sBasicFontSize=t,this.sBasicDirection=i,this.$editableArea.css({"font-family":this.getFontNameWithFamily(this.sBasicFontName),"font-size":this.sBasicFontSize,direction:this.sBasicDirection})},s.prototype.replacePToBr=function(e){return e.replace(/<\/p>/gi,"<br />").replace(/<p [^>]*>/gi,"").replace(/<p>/gi,"")},s.prototype.getPlainText=function(){var e="";return this.$editableArea&&(e=this.$editableArea.html().replace(/<style[^>]*>[^<]*<\/style>/gi,"\n").replace(/<br *\/{0,1}>/gi,"\n").replace(/<\/p>/gi,"\n").replace(/<a [^>]*href="([^"]*?)"[^>]*>(.*?)<\/a>/gi,"$2 ($1)").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"')),
e},s.prototype.getText=function(e){var t=null,i="";return this.$editableArea&&this.$editableArea.length>0&&(e&&(t=this.$editableArea.find('div[data-anchor="signature"]'),t.removeAttr("data-anchor")),i=this.$editableArea.html(),i=this.replacePToBr(i),i='<div data-crea="font-wrapper" style="font-family: '+this.sBasicFontName+"; font-size: "+this.sBasicFontSize+"; direction: "+this.sBasicDirection+'">'+i+"</div>"),i},s.prototype.changeSignatureContent=function(e,t){var i,s,o,r,a,l,h,u=this.$editableArea.find('div[data-anchor="signature"]'),c=n(e).closest('div[data-crea="font-wrapper"]'),d=n(t).closest('div[data-crea="font-wrapper"]');if(u.length>0)o=u.html(),""===t?u.html(o+e):o.indexOf(t)!==-1?u.html(o.replace(t,e)):o.indexOf(e)!==-1||(i=0===c.length||0===d.length?t:d.html(),s=0===c.length||0===d.length?e:c.html(),o.indexOf(i)!==-1?u.html(o.replace(i,e)):o.indexOf(s)!==-1||u.html(o+e));else{l=t;try{r=this.$editableArea.find('*:contains("'+l+'")')}catch(e){r=n("")}if(0===r.length&&d.length>0){l=d.html();try{r=this.$editableArea.find('*:contains("'+l+'")')}catch(e){r=n("")}}r.length>0&&(r=n(r[0]),a=r.closest("blockquote")),a&&0===a.length?r.html(r.html().replace(l,e)):(u=this.$editableArea.find('div[data-anchor="reply-title"]'),h=u.length>0?n(u[0]).closest("blockquote"):u,(0===u.length||h.length>0)&&(u=this.$editableArea.find("blockquote")),u.length>0?n(u[0]).before(n('<br /><div data-anchor="signature">'+e+"</div><br />")):this.$editableArea.append(n('<br /><div data-anchor="signature">'+e+"</div><br />")))}this.editableSave()},s.prototype.isFocused=function(){return this.bFocused},s.prototype.setFocus=function(e){var t=this.$editableArea.contents(),i=3,s=null,r="";this.$editableArea.focus(),e&&o.isArray(this.aRanges)&&this.aRanges.length>0?this.restoreSelectionPosition():t.length>0&&(t[0].nodeType===i?s=n(t[0]):(s=n(document.createTextNode("")),n(t[0]).before(s)),r=s.text(),this.setCursorPosition(s[0],r.length))},s.prototype.setBlur=function(){this.$editableArea.blur()},s.prototype.setEditable=function(e){e?this.enableContentEditable():this.disableContentEditable()},s.prototype.disableContentEditable=function(){this.bEditable=!1,this.$editableArea.prop("contentEditable","false")},s.prototype.enableContentEditable=function(){this.$editableArea.prop("contentEditable","true"),setTimeout(o.bind(function(){this.bEditable=!0},this),0)},s.prototype.fixFirefoxCursorBug=function(){a.firefox&&(this.disableContentEditable(),setTimeout(o.bind(function(){this.enableContentEditable()},this),0))},s.prototype.setRtlDirection=function(){this.setBasicStyles(this.sBasicFontName,this.sBasicFontSize,"rtl")},s.prototype.setLtrDirection=function(){this.setBasicStyles(this.sBasicFontName,this.sBasicFontSize,"ltr")},s.prototype.pasteHtmlAtCaret=function(e){var t,i;if(window.getSelection){if(t=window.getSelection(),t.getRangeAt&&t.rangeCount){i=t.getRangeAt(0),i.deleteContents();var s=document.createElement("div");s.innerHTML=e;for(var o,n,r=document.createDocumentFragment();o=s.firstChild;)n=r.appendChild(o);i.insertNode(r),n&&(i=i.cloneRange(),i.setStartAfter(n),i.collapse(!0),t.removeAllRanges(),t.addRange(i))}}else document.selection&&"Control"!==document.selection.type&&(i=document.selection.createRange(),i&&i.pasteHTML&&i.pasteHTML(e))},s.prototype.execCom=function(e,t,i){var s,o=!1;return this.bEditable&&(this.editableSave(),a.opera&&this.restoreSelectionPosition(),"insertHTML"===e&&a.ie?this.pasteHtmlAtCaret(t):o=void 0===t?window.document.execCommand(e):window.document.execCommand(e,!1,t),a.chrome&&(this.storeSelectionPosition(),"insertHTML"===e&&this.aRanges.length>0&&(s=this.aRanges[0],s.setEnd(s.startContainer,s.startOffset),this.restoreSelectionPosition())),i||this.editableSave()),o},s.prototype.insertHtml=function(e,t){this.execCom("insertHTML",e,t)},s.prototype.changeImageSource=function(e,t){this.$editableArea.find('img[id="'+e+'"]').attr("src",t),this.editableSave()},s.prototype.insertEmailLink=function(e){this.restoreSelectionPosition(),""===this.getSelectedText()?this.execCom("insertHTML",'<a href="mailto:'+e+'">'+e+"</a>"):this.insertLink("mailto:"+e)},s.prototype.insertLink=function(e){if(e=this.normaliseURL(e),this.restoreSelectionPosition(e),""===this.getSelectedText()&&a.ie)this.execCom("insertHTML",'<a href="'+e+'">'+e+"</a>");else{var t=a.ie8AndBelow?"CreateLink":"createlink";this.execCom(t,e)}this.changeFocusLink(e)},s.prototype.removeLink=function(){var e=a.ie8AndBelow?"Unlink":"unlink";this.execCom(e)},s.prototype.insertImage=function(e){var t=a.ie8AndBelow?"InsertImage":"insertimage";return this.isFocused()?this.restoreSelectionPosition():this.setFocus(!0),this.execCom(t,e)},s.prototype.numbering=function(){this.execCom("InsertOrderedList")},s.prototype.bullets=function(){this.execCom("InsertUnorderedList")},s.prototype.horizontalLine=function(){this.execCom("InsertHorizontalRule")},s.prototype.getFontNameWithFamily=function(e){var t="";switch(e){case"Arial":case"Arial Black":case"Tahoma":case"Verdana":t=", sans-serif";break;case"Courier New":t=", monospace";break;case"Times New Roman":t=", serif"}return e+t},s.prototype.fontName=function(e){var t=!this.aRanges;this.setFocus(!0),this.execCom("FontName",this.getFontNameWithFamily(e)),t&&this.setBasicStyles(e,this.sBasicFontSize,this.sBasicDirection)},s.prototype.fontSize=function(e){var t=!this.aRanges;this.setFocus(!0),this.execCom("FontSize",e),t&&this.setBasicStyles(this.sBasicFontName,this.convertFontSizeToPixels(e),this.sBasicDirection)},s.prototype.bold=function(){this.execCom("Bold"),this.$editableArea.focus()},s.prototype.italic=function(){this.execCom("Italic"),this.$editableArea.focus()},s.prototype.underline=function(){this.execCom("Underline"),this.$editableArea.focus()},s.prototype.strikeThrough=function(){this.execCom("StrikeThrough"),this.$editableArea.focus()},s.prototype.undo=function(){this.editableUndo()},s.prototype.redo=function(){this.editableRedo()},s.prototype.alignLeft=function(){this.execCom("JustifyLeft")},s.prototype.center=function(){this.execCom("JustifyCenter")},s.prototype.alignRight=function(){this.execCom("JustifyRight")},s.prototype.justify=function(){this.execCom("JustifyFull")},s.prototype.textColor=function(e){this.execCom("ForeColor",e),this.$editableArea.focus()},s.prototype.backgroundColor=function(e){var t=a.ie?"BackColor":"hilitecolor";this.execCom(t,e),this.$editableArea.focus()},s.prototype.removeFormat=function(){this.execCom("removeformat"),this.$editableArea.focus()},s.prototype.getFontName=function(){if(this.bEditable){var e=window.document.queryCommandValue("FontName"),t=this.sBasicFontName,i="";"string"==typeof e&&(e=e.replace(/'/g,""),n.each(this.oOptions.fontNameArray,function(t,s){(e.indexOf(s)>-1||e.indexOf(s.toLowerCase())>-1)&&(i=s)}),""!==i&&(t=i))}return t},s.prototype.getIsBold=function(){if(this.bEditable)var e=window.document.queryCommandState("bold");return e},s.prototype.getIsItalic=function(){if(this.bEditable)var e=window.document.queryCommandState("italic");return e},s.prototype.getIsUnderline=function(){if(this.bEditable)var e=window.document.queryCommandState("underline");return e},s.prototype.getIsEnumeration=function(){if(this.bEditable)var e=window.document.queryCommandState("insertOrderedList");return e},s.prototype.getIsBullets=function(){if(this.bEditable)var e=window.document.queryCommandState("insertUnorderedList");return e},s.prototype.getIsStrikeThrough=function(){if(this.bEditable)var e=window.document.queryCommandState("StrikeThrough");return e},s.prototype.convertFontSizeToPixels=function(e){var t=0;return n.each(this.aSizes,function(i,s){0===t&&e<=s.inNumber&&(t=s.inPixels)}),t+"px"},s.prototype.convertFontSizeToNumber=function(e){var t=r.pInt(e),i=0;return t>0&&n.each(this.aSizes,function(e,s){0===i&&t<=s.inPixels&&(i=s.inNumber)}),i},s.prototype.getFontSizeInNumber=function(){var e="",t=0;return this.bEditable&&(e=window.document.queryCommandValue("FontSize"),t=r.pInt(e)),(isNaN(t)||t<=0)&&(t=this.convertFontSizeToNumber(this.sBasicFontSize)),t},s.prototype.changeLink=function(e){var t=this.normaliseURL(e),i=n(this.oCurrLink);this.oCurrLink&&(i.attr("href")===i.text()&&i.text(t),"A"===this.oCurrLink.tagName?i.attr("href",t):i.parent().attr("href",t),this.oCurrLink=null,this.bInUrl=!1)},s.prototype.removeCurrentLink=function(){if(this.oCurrLink&&document.createRange&&window.getSelection){var e=document.createRange(),t=window.getSelection();e.selectNodeContents(this.oCurrLink),t.removeAllRanges(),t.addRange(e),this.removeLink(),this.oCurrLink=null,this.bInUrl=!1,this.oOptions.onUrlOut()}},s.prototype.changeFocusLink=function(e){var t=null,i=null;a.firefox&&window.getSelection&&(t=window.getSelection(),i=t.focusNode?t.focusNode.parentElement:null,i&&"A"===i.tagName&&n(i).attr("href",e))},s.prototype.removeCurrentImage=function(){this.oCurrImage&&(this.oCurrImage.remove(),this.oCurrImage=null,this.bInImage=!1,this.oOptions.onImageBlur())},s.prototype.changeCurrentImage=function(e){if(this.oCurrImage&&void 0!==e){var t=this.oCurrImage;n.each(e,function(e,i){t.css(e,i)})}},s.prototype.showImageTooltip=function(e){if(this.oCurrImage&&void 0!==e){var t=this.oCurrImage;n.each(e,function(e,i){t.css(e,i)})}},s.prototype.normaliseURL=function(e){return e.search(/^https?:\/\/|^mailto:|^tel:/g)!==-1?e:"http://"+e},s.prototype.getSelectedText=function(){var e="",t=null;return window.getSelection&&(t=window.getSelection(),t.rangeCount>0&&(e=""+t.getRangeAt(0))),e},s.prototype.storeSelectionPosition=function(){var e=this.getSelectionRanges();o.isArray(e)&&e.length>0&&(this.aRanges=e)},s.prototype.editableIsActive=function(){return!(!n(document.activeElement).hasClass("crea-content-editable")&&!n(document.activeElement).children().first().hasClass("crea-content-editable"))},s.prototype.getSelectionRanges=function(){var e=[];if(window.getSelection&&this.editableIsActive())for(var t=window.getSelection(),i=null,s=0,o=t.rangeCount;s<o;s++)i=t.getRangeAt(s),e.push(i);return e},s.prototype.checkAnchorNode=function(){if(window.getSelection&&this.editableIsActive()){var e=window.getSelection(),t=null;e.anchorNode&&(e.anchorNode.parentElement||e.anchorNode.parentNode)&&(t=e.anchorNode.parentElement||e.anchorNode.parentNode,"A"===t.tagName||"A"===t.parentNode.tagName||"A"===t.parentElement.tagName?this.bInUrl&&t===this.oCurrLink?this.bInUrl&&t===this.oCurrLink&&(this.oCurrLink=null,this.bInUrl=!1,this.oOptions.onUrlOut()):(this.oCurrLink=t,this.bInUrl=!0,this.oOptions.onUrlIn(n(t))):this.bInUrl&&(this.oCurrLink=null,this.bInUrl=!1,this.oOptions.onUrlOut()))}},s.prototype.restoreSelectionPosition=function(e){var t="",i=null,s=null,n=null;t=this.setSelectionRanges(this.aRanges),window.getSelection&&o.isArray(this.aRanges)&&(e=void 0!==e?e:"",a.firefox&&""===t&&""!==e&&(window.getSelection&&window.getSelection().getRangeAt?(i=window.getSelection(),i.getRangeAt&&i.rangeCount>0&&(s=i.getRangeAt(0),n=s.createContextualFragment(e),s.insertNode(n))):document.selection&&document.selection.createRange&&document.selection.createRange().pasteHTML(e)))},s.prototype.setSelectionRanges=function(e){var t=null,i=null,s=0,n=0,r="";if(window.getSelection&&o.isArray(e))for(n=e.length,t=window.getSelection(),a.ie10AndAbove||t.removeAllRanges();s<n;s++)i=e[s],i&&(t.addRange(i),r+=""+i);return r},s.prototype.uniteWithNextQuote=function(){var e=window.getSelection?window.getSelection():null,t=e?e.focusNode:null,i=t?this.getLastBlockQuote(t):null,s=i?n(i).next():null,o=s&&s.length>0&&"BLOCKQUOTE"===s[0].tagName?s[0]:null,r=[],a=0,l=0,h=null;if(i&&o){for(n("<br />").appendTo(i),r=n(o).contents(),l=r.length,a=0;a<l;a++)h=r[a],n(h).appendTo(i);n(o).remove()}},s.prototype.uniteWithPrevQuote=function(){var e=window.getSelection?window.getSelection():null,t=e?e.focusNode:null,i=t?this.getLastBlockQuote(t):null;this.getPrevAndUnite(i),this.getPrevAndUnite(i)},s.prototype.getPrevAndUnite=function(e){var t=e?n(e).prev():null,i=t&&t.length>0&&"BLOCKQUOTE"===t[0].tagName?t[0]:null,s=[],o=0,r=0,a=null;if(e&&i){for(n("<br />").prependTo(e),s=n(i).contents(),r=s.length,o=r-1;o>0;o--)a=s[o],n(a).prependTo(e);n(i).remove()}},s.prototype.getLastBlockQuote=function(e){for(var t=e,i=null;t&&t.parentNode;)"BLOCKQUOTE"===t.tagName&&(i=t),t=t.parentNode;return i},s.prototype.breakQuotes=function(e){var t=window.getSelection?window.getSelection():null,i=t?t.focusNode:null,s=i?this.getLastBlockQuote(i):null;i&&s&&this.breakBlocks(i,s,t.focusOffset)},s.prototype.setCursorPosition=function(e,t){if(document.createRange&&window.getSelection){var i=document.createRange(),s=window.getSelection();s.removeAllRanges(),i.setStart(e,t),i.setEnd(e,t),i.collapse(!0),s.addRange(i),this.aRanges=[i]}},s.prototype.cloneNode=function(e){var t=null,i="";try{t=n(e).clone()}catch(s){i=e.tagName,t=n("<"+i+"></"+i+">")}return t},s.prototype.breakBlocks=function(e,t,i){for(var s=e,o=null,r=[],a=0,l=0,h=null,u=!0,c=null,d=null,p=null,m=null,g=!1,f=!0,b=null;f&&s.parentNode;){for(p=c,m=d,c=this.cloneNode(s).empty(),d=this.cloneNode(s).empty(),r=n(s).contents(),l=r.length,u=!0,null===o&&(o=r[i]),0===l&&(c=null),a=0;a<l;a++)h=r[a],h===o?(null===p?a===i&&"BR"===h.tagName||n(h).appendTo(d):(p.html().length>0&&p.appendTo(c),m.appendTo(d)),u=!1):u?n(h).appendTo(c):n(h).appendTo(d);g=t===s,g&&(f=!1),o=s,s=s.parentNode}null!==c&&null!==d&&(c.insertBefore(n(t)),b=n("<span>&nbsp;</span>").insertBefore(n(t)),n("<br>").insertBefore(n(t)),d.insertBefore(n(t)),n(t).remove(),this.setCursorPosition(b[0],0))},e.exports=s},335:function(e,t,i){"use strict";function s(e,t,i){this.aGreyColors=["rgb(0, 0, 0)","rgb(68, 68, 68)","rgb(102, 102, 102)","rgb(153, 153, 153)","rgb(204, 204, 204)","rgb(238, 238, 238)","rgb(243, 243, 243)","rgb(255, 255, 255)"],this.aBrightColors=["rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],this.aColorLines=[["rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)"],["rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)"],["rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)"],["rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)"],["rgb(153, 0, 0)","rgb(180, 95, 6)","rgb(191, 144, 0)","rgb(56, 118, 29)","rgb(19, 79, 92)","rgb(11, 83, 148)","rgb(53, 28, 117)","rgb(116, 27, 71)"],["rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]],this.caption=e,this.pickHandler=t,this.pickContext=i,this.colorPickerDom=n.observable(null)}var o=i(2),n=i(46),r=i(1);s.prototype.ViewTemplate="MailWebclient_ColorPickerView",s.prototype.onShow=function(){r(this.colorPickerDom()).find("span.color-item").on("click",o.bind(function(e){e.stopPropagation(),this.setColorFromPopup(r(e.target).data("color"))},this))},s.prototype.setColorFromPopup=function(e){this.pickHandler.call(this.pickContext,e)},e.exports=s},336:function(e,t,i){"use strict";function s(e){d=i(179),u=i(308),this.id=n.observable(l.pInt(e.AccountID)),this.email=n.observable(l.pString(e.Email)),this.friendlyName=n.observable(l.pString(e.FriendlyName)),this.incomingLogin=n.observable(l.pString(e.IncomingLogin)),this.signature=n.observable(l.pString(e.Signature)),this.useSignature=n.observable(!!e.UseSignature),this.serverId=n.observable(l.pInt(e.ServerId)),this.oServer=new b(e.Server),this.useToAuthorize=n.observable(!!e.UseToAuthorize),this.canBeUsedToAuthorize=n.observable(!!e.CanBeUsedToAuthorize),this.useThreading=n.observable(!!e.UseThreading),this.useThreading.subscribe(function(){this.requireCache(),y.clearMessagesCache(this.id())},this),this.bSaveRepliesToCurrFolder=!!e.SaveRepliesToCurrFolder,this.isCurrent=n.observable(!1),this.isEdited=n.observable(!1),this.hash=n.computed(function(){return h.getHash(this.id()+this.email())},this),this.passwordSpecified=n.observable(!0),this.extensions=n.observableArray([]),this.fetchers=n.observable(null),this.identities=n.observable(null),this.autoresponder=n.observable(null),this.forward=n.observable(null),this.filters=n.observable(null),this.quota=n.observable(0),this.usedSpace=n.observable(0),this.quotaRecieved=n.observable(!1),this.fullEmail=n.computed(function(){return r.getFullEmail(this.friendlyName(),this.email())},this),this.extensionsRequested=n.observable(!0),this.bDefault=E.AllowDefaultAccountForUser&&this.email()===d.getUserPublicId()}var o=i(2),n=i(46),r=i(201),a=i(43),l=i(44),h=i(213),u=null,c=i(181),d=null,p=i(45),m=i(184),g=i(185),f=i(337),b=i(339),v=null,y=null,E=i(306);s.prototype.threadingIsAvailable=function(){return this.oServer.bEnableThreading&&this.useThreading()},s.prototype.updateFromServer=function(e){this.email(l.pString(e.Email)),this.friendlyName(l.pString(e.FriendlyName)),this.incomingLogin(l.pString(e.IncomingLogin)),this.serverId(l.pInt(e.ServerId)),this.oServer=new b(e.Server),this.useToAuthorize(!!e.UseToAuthorize),this.useThreading(!!e.UseThreading),this.bSaveRepliesToCurrFolder=!!e.SaveRepliesToCurrFolder},s.prototype.requireAccounts=function(){null===v&&(v=i(307))},s.prototype.requireCache=function(){null===y&&(y=i(309))},s.prototype.onGetQuotaResponse=function(e,t){o.isArray(e.Result)&&1<e.Result.length&&(this.quota(l.pInt(e.Result[1])),this.usedSpace(l.pInt(e.Result[0])),this.requireCache(),y.quotaChangeTrigger(!y.quotaChangeTrigger())),this.quotaRecieved(!0)},s.prototype.updateQuotaParams=function(){p.ShowQuotaBar&&u.send("GetQuota",{AccountID:this.id()},this.onGetQuotaResponse,this)},s.prototype.onGetExtensionsResponse=function(e,t){var i=!!e.Result,s=i?e.Result.Extensions:[];i&&(this.setExtensions(s),this.extensionsRequested(!0))},s.prototype.setExtensions=function(e){o.isArray(e)&&this.extensions(e)},s.prototype.extensionExists=function(e){return o.indexOf(this.extensions(),e)!==-1},s.prototype.updateFriendlyName=function(e){this.friendlyName(e)},s.prototype.changeAccount=function(){this.requireAccounts(),v.changeCurrentAccount(this.id(),!0)},s.prototype.getDefaultIdentity=function(){return o.find(this.identities()||[],function(e){return e.isDefault()})},s.prototype.getFetchersIdentitiesEmails=function(){var e=this.fetchers()?this.fetchers().collection():[],t=this.identities()||[],i=[];return o.each(e,function(e){i.push(e.email())}),o.each(t,function(e){i.push(e.email())}),i},s.prototype.remove=function(){var e=o.bind(this.confirmedRemove,this);this.bDefault||m.showPopup(g,[a.i18n("MAILWEBCLIENT/CONFIRM_REMOVE_ACCOUNT"),e,this.email()])},s.prototype.confirmedRemove=function(e){e&&u.send("DeleteAccount",{AccountID:this.id()},this.onAccountDeleteResponse,this)},s.prototype.onAccountDeleteResponse=function(e,t){if(e.Result){var s=i(323);o.isFunction(s.closeComposePopup)&&s.closeComposePopup(),this.requireAccounts(),v.deleteAccount(this.id())}else c.showErrorByCode(e,a.i18n("MAILWEBCLIENT/ERROR_REMOVE_ACCOUNT"))},s.prototype.requestFilters=function(){u.send("GetFilters",{AccountID:this.id()},this.onGetFiltersResponse,this)},s.prototype.onGetFiltersResponse=function(e,t){var i=new f;e.Result&&i.parse(this.id(),e.Result),this.filters(i)},e.exports=s},337:function(e,t,i){"use strict";function s(){this.iAccountId=0,this.collection=n.observableArray([])}var o=i(2),n=i(46),r=i(338);s.prototype.parse=function(e,t){var i=0,s=t.length,n=null;if(this.iAccountId=e,o.isArray(t))for(s=t.length;i<s;i++)n=new r(e),n.parse(t[i]),this.collection.push(n)},e.exports=s},338:function(e,t,i){"use strict";function s(e){this.iAccountId=e,this.enable=o.observable(!0).extend({reversible:!0}),this.field=o.observable("").extend({reversible:!0}),this.condition=o.observable("").extend({reversible:!0}),this.filter=o.observable("").extend({reversible:!0}),this.action=o.observable("").extend({reversible:!0}),this.folder=o.observable("").extend({reversible:!0})}var o=i(46),n=i(44);s.prototype.parse=function(e){this.enable(!!e.Enable),this.field(n.pInt(e.Field)),this.condition(n.pInt(e.Condition)),this.filter(n.pString(e.Filter)),this.action(n.pInt(e.Action)),this.folder(n.pString(e.FolderFullName)),this.commit()},s.prototype.revert=function(){this.enable.revert(),this.field.revert(),this.condition.revert(),this.filter.revert(),this.action.revert(),this.folder.revert()},s.prototype.commit=function(){this.enable.commit(),this.field.commit(),this.condition.commit(),this.filter.commit(),this.action.commit(),this.folder.commit()},s.prototype.toString=function(){var e=[this.enable(),this.field(),this.condition(),this.filter(),this.action(),this.folder()];return e.join(":")},e.exports=s},339:function(e,t,i){"use strict";function s(e){this.iId=e?o.pInt(e.EntityId)||o.pInt(e.ServerId):0,this.sName=e?o.pString(e.Name):"",this.sIncomingServer=e?o.pString(e.IncomingServer):"",this.iIncomingPort=e?o.pInt(e.IncomingPort):143,this.bIncomingUseSsl=!!e&&!!e.IncomingUseSsl,this.sOutgoingServer=e?o.pString(e.OutgoingServer):"",this.iOutgoingPort=e?o.pInt(e.OutgoingPort):25,this.bOutgoingUseSsl=!!e&&!!e.OutgoingUseSsl,this.sDomains=e?o.pString(e.Domains):"",this.sSmtpAuthType=e?o.pString(e.SmtpAuthType):window.Enums.SmtpAuthType.UseUserCredentials,this.sSmtpLogin=e?o.pString(e.SmtpLogin):"",this.sSmtpPassword=e?o.pString(e.SmtpPassword):"",this.bEnableSieve=!!e&&!!e.EnableSieve,this.iSievePort=e&&e.SievePort?o.pInt(e.SievePort):4190,this.bEnableThreading=!!e&&!!e.EnableThreading,this.bUseFullEmailAddressAsLogin=!e||!!e.UseFullEmailAddressAsLogin}var o=i(44);e.exports=s},340:function(e,t,i){"use strict";function s(){this.collection=n.observableArray([])}var o=i(2),n=i(46),r=i(341);s.prototype.parse=function(e){var t=o.map(e,function(e){var t=new r;return t.parse(e),t});this.collection(t)},s.prototype.hasFetcher=function(e){return!!this.getFetcher(e)},s.prototype.getFetcher=function(e){var t=o.find(this.collection(),function(t){return t.id()===e});return t||null},e.exports=s},341:function(e,t,i){"use strict";function s(){this.FETCHER=!0,this.id=o.observable(0),this.accountId=o.observable(0),this.hash=o.computed(function(){return a.getHash(this.accountId()+"fetcher"+this.id())},this),this.isEnabled=o.observable(!1),this.isLocked=o.observable(!1).extend({autoResetToFalse:1e3}),this.email=o.observable(""),this.userName=o.observable(""),this.folder=o.observable(""),this.useSignature=o.observable(!1),this.signature=o.observable(""),this.incomingServer=o.observable(""),this.incomingPort=o.observable(0),this.incomingUseSsl=o.observable(!1),this.incomingLogin=o.observable(""),this.leaveMessagesOnServer=o.observable(""),this.isOutgoingEnabled=o.observable(!1),this.outgoingServer=o.observable(""),this.outgoingPort=o.observable(0),this.outgoingUseSsl=o.observable(!1),this.outgoingUseAuth=o.observable(!1),this.fullEmail=o.computed(function(){return n.getFullEmail(this.userName(),this.email())},this)}var o=i(46),n=i(201),r=i(44),a=i(213);s.prototype.parse=function(e){this.id(r.pInt(e.IdFetcher)),this.accountId(r.pInt(e.IdAccount)),this.isEnabled(!!e.IsEnabled),this.isLocked(!!e.IsLocked),this.email(r.pString(e.Email)),this.userName(r.pString(e.Name)),this.folder(r.pString(e.Folder)),this.useSignature(!!e.SignatureOptions),this.signature(r.pString(e.Signature)),this.incomingServer(r.pString(e.IncomingServer)),this.incomingPort(r.pInt(e.IncomingPort)),this.incomingUseSsl(!!e.IncomingUseSsl),this.incomingLogin(r.pString(e.IncomingLogin)),this.leaveMessagesOnServer(!!e.LeaveMessagesOnServer),this.isOutgoingEnabled(!!e.IsOutgoingEnabled),this.outgoingServer(r.pString(e.OutgoingServer)),this.outgoingPort(r.pInt(e.OutgoingPort)),this.outgoingUseSsl(!!e.OutgoingUseSsl),this.outgoingUseAuth(!!e.OutgoingUseAuth)},e.exports=s},342:function(e,t,i){"use strict";function s(){this.bAccountPart=!1,this.isDefault=o.observable(!1),this.email=o.observable(""),this.friendlyName=o.observable(""),this.fullEmail=o.computed(function(){return n.getFullEmail(this.friendlyName(),this.email())},this),this.accountId=o.observable(-1),this.id=o.observable(-1),this.signature=o.observable(""),this.useSignature=o.observable(!1),this.hash=o.computed(function(){return a.getHash(this.accountId()+"identity"+this.id())},this)}var o=i(46),n=i(201),r=i(44),a=i(213);s.prototype.parse=function(e){"Object/Aurora\\Modules\\Mail\\Classes\\Identity"===e["@Object"]&&(this.bAccountPart=!!e.AccountPart,this.isDefault(!!e.Default),this.email(r.pString(e.Email)),this.friendlyName(r.pString(e.FriendlyName)),this.accountId(r.pInt(e.IdAccount)),this.id(r.pInt(e.EntityId)),this.signature(r.pString(e.Signature)),this.useSignature(!!e.UseSignature))},e.exports=s},349:function(e,t,i){"use strict";var s=i(2),o=i(183),n={};n.checkIfFieldsEmpty=function(e,t){var i=s.find(e,function(e){return""===e()});return!i||(t&&o.showError(t),i.focused(!0),!1)},e.exports=n},350:function(e,t,i){"use strict";function s(e,t){this.servers=r.observableArray([]),this.serversRetrieved=r.observable(!1),this.serverOptions=r.observableArray([{Name:a.i18n("MAILWEBCLIENT/LABEL_CONFIGURE_SERVER_MANUALLY"),Id:0}]),this.selectedServerId=r.observable(0),this.oLastEditableServer=new c,this.iEditedServerId=0,this.selectedServerId.subscribe(function(){var e=this.selectedServerId(),t=o.find(this.servers(),function(t){return t.iId===e});t?(this.oIncoming.isEnabled()&&(this.oLastEditableServer=new c(this.getParametersForSave())),this.name(t.sName),this.oIncoming.set(t.sIncomingServer,t.iIncomingPort,t.bIncomingUseSsl),this.oIncoming.isEnabled(this.bAdminEdit),this.oOutgoing.set(t.sOutgoingServer,t.iOutgoingPort,t.bOutgoingUseSsl),this.oOutgoing.isEnabled(this.bAdminEdit),this.outgoingUseAuth(t.sSmtpAuthType===window.Enums.SmtpAuthType.UseUserCredentials),this.outgoingUseAuth.enable(this.bAdminEdit),this.domains(t.sDomains),this.smtpAuthType(t.sSmtpAuthType),this.smtpLogin(t.sSmtpLogin),this.smtpPassword(t.sSmtpPassword),this.enableSieve(t.bEnableSieve),this.sievePort(t.iSievePort),this.enableThreading(t.bEnableThreading),this.useFullEmailAddressAsLogin(t.bUseFullEmailAddressAsLogin)):(this.name(this.oLastEditableServer.sName),this.oIncoming.set(this.oLastEditableServer.sIncomingServer,this.oLastEditableServer.iIncomingPort,this.oLastEditableServer.bIncomingUseSsl),this.oIncoming.isEnabled(!0),this.oOutgoing.set(this.oLastEditableServer.sOutgoingServer,this.oLastEditableServer.iOutgoingPort,this.oLastEditableServer.bOutgoingUseSsl),this.oOutgoing.isEnabled(!0),this.outgoingUseAuth(this.oLastEditableServer.sSmtpAuthType===window.Enums.SmtpAuthType.UseUserCredentials),this.outgoingUseAuth.enable(!0),this.domains(""),this.smtpAuthType(window.Enums.SmtpAuthType.UseUserCredentials),this.smtpLogin(""),this.smtpPassword(""),this.enableSieve(!1),this.sievePort(4190),this.enableThreading(!0),this.useFullEmailAddressAsLogin(!0)),this.setCurrentValues()},this),this.name=r.observable(""),this.name.focused=r.observable(!1),this.bAdminEdit=t,this.oIncoming=new d(143,993,e+"_incoming",a.i18n("MAILWEBCLIENT/LABEL_IMAP_SERVER"),t?this.name:null),this.oOutgoing=new d(25,465,e+"_outgoing",a.i18n("MAILWEBCLIENT/LABEL_SMTP_SERVER"),this.oIncoming.server),this.outgoingUseAuth=r.observable(!0),this.outgoingUseAuth.enable=r.observable(!0),this.domains=r.observable(""),this.name.focused.subscribe(function(){this.name.focused()||""!==this.domains()||this.domains(this.name())},this),this.smtpAuthType=r.observable(window.Enums.SmtpAuthType.UseUserCredentials),this.smtpLogin=r.observable(""),this.smtpPassword=r.observable(""),this.enableSieve=r.observable(!1),this.sievePort=r.observable(4190),this.enableThreading=r.observable(!0),this.useFullEmailAddressAsLogin=r.observable(!0),this.currentValues=r.observable(""),this.aRequiredFields=[this.oIncoming.server,this.oIncoming.port,this.oOutgoing.server,this.oOutgoing.port],t&&this.aRequiredFields.unshift(this.name)}var o=i(2),n=i(1),r=i(46),a=i(43),l=i(44),h=i(349),u=i(308),c=i(339),d=i(351);s.prototype.ViewTemplate="MailWebclient_Settings_ServerPairPropertiesView",s.prototype.init=function(e){this.serversRetrieved()||this.requestServers(),this.setServer(e?new c:this.oLastEditableServer)},s.prototype.setServer=function(e){this.oLastEditableServer=e,this.setServerId(e.iId)},s.prototype.setServerId=function(e){if(this.serversRetrieved()){var t=0===this.selectedServerId();this.selectedServerId(0),this.selectedServerId(e),t&&0===e&&this.selectedServerId.valueHasMutated()}else this.iEditedServerId=e},s.prototype.requestServers=function(){this.serversRetrieved(!1),u.send("GetServers",{},function(e){if(o.isArray(e.Result)){var t=[{Name:a.i18n("MAILWEBCLIENT/LABEL_CONFIGURE_SERVER_MANUALLY"),Id:0}];o.each(e.Result,function(e){t.push({Name:e.Name,Id:l.pInt(e.EntityId)})}),this.servers(o.map(e.Result,function(e){return new c(e)})),this.serverOptions(t),this.serversRetrieved(!0),this.iEditedServerId&&(this.setServerId(this.iEditedServerId),this.iEditedServerId=0)}},this)},s.prototype.clear=function(){this.oIncoming.clear(),this.oOutgoing.clear(),this.outgoingUseAuth(!0)},s.prototype.setCurrentValues=function(){var e=this.bAdminEdit?[this.selectedServerId(),this.name()]:[],t=[this.oIncoming.port(),this.oIncoming.server(),this.oIncoming.ssl(),this.oOutgoing.port(),this.oOutgoing.server(),this.oOutgoing.ssl(),this.outgoingUseAuth(),this.domains(),this.smtpAuthType(),this.smtpLogin(),this.smtpPassword(),this.enableSieve(),this.sievePort(),this.enableThreading(),this.useFullEmailAddressAsLogin()];this.currentValues(e.concat(t).join(":"))},s.prototype.getCurrentValues=function(){return this.setCurrentValues(),[this.currentValues()]},s.prototype.getSmtpAuthType=function(){return this.bAdminEdit||this.smtpAuthType()===window.Enums.SmtpAuthType.UseSpecifiedCredentials?this.smtpAuthType():this.outgoingUseAuth()?window.Enums.SmtpAuthType.UseUserCredentials:window.Enums.SmtpAuthType.NoAuthentication},s.prototype.getParametersForSave=function(){var e=this.selectedServerId(),t=this.oLastEditableServer.iId,i=this.getSmtpAuthType();return 0!==e||o.find(this.servers(),function(e){return t===e.iId})||(e=t),{ServerId:e,Name:this.bAdminEdit?this.name():this.oIncoming.server(),IncomingServer:this.oIncoming.server(),IncomingPort:this.oIncoming.getIntPort(),IncomingUseSsl:this.oIncoming.ssl(),OutgoingServer:this.oOutgoing.server(),OutgoingPort:this.oOutgoing.getIntPort(),OutgoingUseSsl:this.oOutgoing.ssl(),Domains:this.domains(),SmtpAuthType:i,SmtpLogin:i===window.Enums.SmtpAuthType.UseSpecifiedCredentials?n.trim(this.smtpLogin()):"",SmtpPassword:i===window.Enums.SmtpAuthType.UseSpecifiedCredentials?n.trim(this.smtpPassword()):"",EnableSieve:this.enableSieve(),SievePort:this.sievePort(),EnableThreading:this.enableThreading(),UseFullEmailAddressAsLogin:this.useFullEmailAddressAsLogin()}},s.prototype.validateBeforeSave=function(){return h.checkIfFieldsEmpty(this.aRequiredFields,a.i18n("MAILWEBCLIENT/ERROR_REQUIRED_FIELDS_EMPTY"))},e.exports=s},351:function(e,t,i){"use strict";function s(e,t,i,s,r){this.server=n.observable(""),this.server.focused=n.observable(!1),this.label=s,this.defaultPort=n.observable(e),this.defaultSslPort=n.observable(t),this.port=n.observable(e),this.port.focused=n.observable(!1),this.ssl=n.observable(!1),this.isEnabled=n.observable(!0),this.id=i,o.isFunction(r)&&r.focused.subscribe(function(){r.focused()||""!==this.server()||this.server(r())},this),this.ssl.subscribe(function(){var e=a.pInt(this.port());this.ssl()?e===this.defaultPort()&&this.port(this.defaultSslPort()):e===this.defaultSslPort()&&this.port(this.defaultPort())},this)}var o=i(1),n=i(46),r=i(2),a=i(44);s.prototype.set=function(e,t,i){this.server(e),this.ssl(i),this.port(t)},s.prototype.clear=function(){this.server(""),this.ssl(!1),this.port(this.defaultPort())},s.prototype.getIntPort=function(){
return a.pInt(this.port())},s.prototype.parentSave=function(e,t){e.focused&&e.focused(!1);var i=r.find(t,function(e){return r.isFunction(e.save)});i&&i.save()},e.exports=s},374:function(e,t,i){"use strict";function s(){u.call(this,p.ServerModuleName),this.visible=n.observable(!0),this.oServerPairPropertiesView=new m("server_edit",!0),this.servers=this.oServerPairPropertiesView.servers,this.servers.subscribe(function(){var e=o.find(this.servers(),o.bind(function(e){return e.iId===this.editedServerId()},this));e||this.routeServerList(),this.serversRetrieved()||this.revert()},this),this.serversRetrieved=this.oServerPairPropertiesView.serversRetrieved,this.createMode=n.observable(!1),this.editedServerId=n.observable(0),this.updateSavedState(),this.oServerPairPropertiesView.currentValues.subscribe(function(){this.updateSavedState()},this)}var o=i(2),n=i(46),r=i(43),a=i(44),l=i(308),h=i(42),u=h.run("AdminPanelWebclient","getAbstractSettingsFormViewClass"),c=i(184),d=i(185),p=i(306),m=i(350);o.extendOwn(s.prototype,u.prototype),s.prototype.ViewTemplate="MailWebclient_Settings_ServersAdminSettingsPaneView",s.prototype.routeCreateServer=function(){h.run("AdminPanelWebclient","setAddHash",[["create"]])},s.prototype.routeEditServer=function(e){h.run("AdminPanelWebclient","setAddHash",[[e]])},s.prototype.routeServerList=function(){h.run("AdminPanelWebclient","setAddHash",[[]])},s.prototype.onRouteChild=function(e){var t=a.isNonEmptyArray(e)&&"create"===e[0],i=!t&&a.isNonEmptyArray(e)?a.pInt(e[0]):0;this.createMode(t),this.editedServerId(i),this.oServerPairPropertiesView.init(t),this.revert()},s.prototype.deleteServer=function(e){var t=o.bind(function(t){t&&l.send("DeleteServer",{ServerId:e},function(e){this.oServerPairPropertiesView.requestServers()},this)},this),i=o.find(this.servers(),o.bind(function(t){return t.iId===e},this));i&&c.showPopup(d,[r.i18n("MAILWEBCLIENT/CONFIRM_REMOVE_SERVER"),t,i.sName])},s.prototype.save=function(){if(this.oServerPairPropertiesView.validateBeforeSave()){var e=this.createMode()?"CreateServer":"UpdateServer";this.isSaving(!0),l.send(e,this.getParametersForSave(),function(e){this.isSaving(!1),this.oServerPairPropertiesView.requestServers(),this.createMode()&&this.routeServerList()},this)}},s.prototype.getCurrentValues=function(){return this.oServerPairPropertiesView.getCurrentValues()},s.prototype.revertGlobalValues=function(){this.oServerPairPropertiesView.setServerId(this.editedServerId())},s.prototype.getParametersForSave=function(){return this.oServerPairPropertiesView.getParametersForSave()},s.prototype.setAccessLevel=function(e,t){this.visible(""===e)},e.exports=new s}});